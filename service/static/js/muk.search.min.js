var es={specialChars:["\\","+","-","=","&&","||",">","<","!","(",")","{","}","[","]","^",'"',"~","*","?",":","/"],specialCharsSubSet:["\\","+","-","=","&&","||",">","<","!","(",")","{","}","[","]","^","~","?",":","/"],characterPairs:['"'],distanceUnits:["km","mi","miles","in","inch","yd","yards","kilometers","mm","millimeters","cm","centimeters","m","meters"],aggregationFactory:function(a,b){var c={terms:es.newTermsAggregation,range:es.newRangeAggregation,geo_distance:es.newGeoDistanceAggregation,date_histogram:es.newDateHistogramAggregation,stats:es.StatsAggregation,cardinality:es.CardinalityAggregation};if(c[a])return c[a](b)},filterFactory:function(a,b){var c={query_string:es.newQueryString,term:es.newTermFilter,terms:es.newTermsFilter,range:es.newRangeFilter,geo_distance_range:es.newGeoDistanceRangeFilter};if(c[a])return c[a](b)},newQuery:function(a){return a||(a={}),new es.Query(a)},Query:function(a){this.filtered=a.filtered||!0,this.size=void 0!==a.size&&a.size,this.from=a.from||!1,this.fields=a.fields||[],this.aggs=a.aggs||[],this.must=a.must||[],this.queryString=!1,this.sort=[],this.source=a.source||!1,this.should=a.should||[],this.mustNot=a.mustNot||[],this.partialFields=a.partialFields||!1,this.scriptFields=a.scriptFields||!1,this.minimumShouldMatch=a.minimumShouldMatch||!1,this.partialFields=a.partialFields||!1,this.scriptFields=a.scriptFields||!1,this.facets=a.facets||[],this.getSize=function(){return void 0!==this.size&&this.size!==!1?this.size:10},this.getFrom=function(){return this.from?this.from:0},this.addField=function(a){$.inArray(a,this.fields)===-1&&this.fields.push(a)},this.setQueryString=function(a){var b=a;a instanceof es.QueryString||(b=$.isPlainObject(a)?es.newQueryString(a):es.newQueryString({queryString:a})),this.queryString=b},this.getQueryString=function(){return this.queryString},this.removeQueryString=function(){this.queryString=!1},this.setSortBy=function(a){this.sort=[];var b=a;$.isArray(a)||(b=[a]);for(var c=0;c<b.length;c++)this.addSortBy(b[c])},this.addSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a));for(var c=0;c<this.sort.length;c++){var d=this.sort[c];if(d.field===b.field)return}this.sort.push(b)},this.prependSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a)),this.removeSortBy(b),this.sort.unshift(b)},this.removeSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a));for(var c=[],d=0;d<this.sort.length;d++){var e=this.sort[d];e.field===b.field&&c.push(d)}c=c.sort().reverse();for(var d=0;d<c.length;d++)this.sort.splice(c[d],1)},this.getSortBy=function(){return this.sort},this.setSource=function(a,b){},this.addFacet=function(){},this.removeFacet=function(){},this.clearFacets=function(){},this.getAggregation=function(a){for(var b=a.name,c=0;c<this.aggs.length;c++){var d=this.aggs[c];if(d.name===b)return d}},this.addAggregation=function(a,b){if(b)this.removeAggregation(a.name);else for(var c=0;c<this.aggs.length;c++)if(this.aggs[c].name===a.name)return;this.aggs.push(a)},this.removeAggregation=function(a){for(var b=[],c=0;c<this.aggs.length;c++)this.aggs[c].name===a&&b.push(c);b=b.sort().reverse();for(var c=0;c<b.length;c++)this.aggs.splice(b[c],1)},this.clearAggregations=function(){this.aggs=[]},this.listAggregations=function(){return this.aggs},this.addMust=function(a){var b=this.listMust(a);0===b.length&&this.must.push(a)},this.listMust=function(a){return this.listFilters({boolType:"must",template:a})},this.removeMust=function(a){for(var b=[],c=0;c<this.must.length;c++){var d=this.must[c];d.matches(a)&&b.push(c)}b=b.sort().reverse();for(var c=0;c<b.length;c++)this.must.splice(b[c],1);return b.length},this.clearMust=function(){},this.addShould=function(){},this.listShould=function(){},this.removeShould=function(){},this.clearShould=function(){},this.addMustNot=function(){},this.listMustNot=function(){},this.removeMustNot=function(){},this.removeMustNot=function(){},this.hasFilters=function(){return this.must.length>0||this.should.length>0||this.mustNot.length>0},this.listFilters=function(a){var b=a.boolType||"must",c=a.template||!1,d=[];if("must"===b?d=this.must:"should"===b?d=this.should:"must_not"===b&&(d=this.mustNot),!c)return d;for(var e=[],f=0;f<d.length;f++){var g=d[f];g.matches(c)&&e.push(g)}return e},this.merge=function(a){if(this.filtered=a.filtered,a.size&&(this.size=a.size),a.from&&(this.from=a.from),a.fields&&a.fields.length>0)for(var b=0;b<a.fields.length;b++)this.addField(a.fields[b]);for(var c=a.listAggregations(),b=0;b<c.length;b++)this.addAggregation(c[b],!0);for(var d=a.listMust(),b=0;b<d.length;b++)this.addMust(d[b]);a.getQueryString()&&this.setQueryString(a.getQueryString());var e=a.getSortBy();if(e&&e.length>0){e.reverse();for(var b=0;b<e.length;b++)this.prependSortBy(e[b])}},this.objectify=function(a){a||(a={});var b=void 0===a.include_query_string||a.include_query_string,c=void 0===a.include_filters||a.include_filters,d=void 0===a.include_paging||a.include_paging,e=void 0===a.include_sort||a.include_sort,f=void 0===a.include_fields||a.include_fields,g=void 0===a.include_aggregations||a.include_aggregations,h=(void 0===a.include_facets||a.include_facets,{}),i={},j={};if(this.queryString&&b&&$.extend(i,this.queryString.objectify()),c&&this.must.length>0){for(var k=[],l=0;l<this.must.length;l++){var m=this.must[l];k.push(m.objectify())}j.must=k}if(this.filtered&&this.hasFilters()?(0==Object.keys(i).length&&(i.match_all={}),h.query={filtered:{filter:{bool:j},query:i}}):(this.hasFilters()&&(i.bool=j),0==Object.keys(i).length&&(i.match_all={}),h.query=i),d&&(void 0!==this.size&&this.size!==!1&&(h.size=this.size),this.from&&(h.from=this.from)),this.sort.length>0&&e){h.sort=[];for(var l=0;l<this.sort.length;l++)h.sort.push(this.sort[l].objectify())}if(this.fields.length>0&&f&&(h.fields=this.fields),this.aggs.length>0&&g){h.aggs={};for(var l=0;l<this.aggs.length;l++){var n=this.aggs[l];$.extend(h.aggs,n.objectify())}}return h},es.Query.prototype.toString=function(){return JSON.stringify(this.objectify())},this.parse=function(a){function b(a,b){if(a.must)for(var c=0;c<a.must.length;c++){var d=Object.keys(a.must[c])[0],e=es.filterFactory(d,{raw:a.must[c]});e&&b.addMust(e)}}function c(a,b){for(var c=Object.keys(a),d=0;d<c.length;d++){var e=c[d],f=es.filterFactory(e,{raw:a[e]});f&&"query_string"===e&&b.setQueryString(f)}}if(a.query)if(a.query.filtered){this.filtered=!0;var d=a.query.filtered.filter.bool;d&&b(d,this);var e=a.query.filtered.query;c(e,this)}else{var e=a.query;c(e,this)}if(a.size&&(this.size=a.size),a.from&&(this.from=a.from),a.fields&&(this.fields=a.fields),a.sort)for(var f=0;f<a.sort.length;f++){var g=a.sort[f];this.addSortBy(es.newSort({raw:g}))}if(a.aggs||a.aggregations)for(var h=a.aggs?a.aggs:a.aggregations,i=Object.keys(h),f=0;f<i.length;f++){var j=i[f],k=h[j],l=Object.keys(k)[0],m={};m[j]=k;var n=es.aggregationFactory(l,{raw:m});n&&this.addAggregation(n)}},a.queryString&&this.setQueryString(a.queryString),a.sort&&this.setSortBy(a.sort),a.raw&&this.parse(a.raw)},newQueryString:function(a){return a||(a={}),new es.QueryString(a)},QueryString:function(a){this.queryString=a.queryString||!1,this.defaultField=a.defaultField||!1,this.defaultOperator=a.defaultOperator||"OR",this.fuzzify=a.fuzzify||!1,this.escapeSet=a.escapeSet||es.specialCharsSubSet,this.pairs=a.pairs||es.characterPairs,this.unEscapeSet=a.unEscapeSet||es.specialChars,this.objectify=function(){var a=this._escape(this._fuzzify(this.queryString)),b={query_string:{query:a}};return this.defaultOperator&&(b.query_string.default_operator=this.defaultOperator),this.defaultField&&(b.query_string.default_field=this.defaultField),b},this.parse=function(a){a.query_string&&(a=a.query_string),this.queryString=this._unescape(a.query),a.default_operator&&(this.defaultOperator=a.default_operator),a.default_field&&(this.defaultField=a.default_field)},this._fuzzify=function(a){if(!this.fuzzify||"*"!==this.fuzzify&&"~"!==this.fuzzify)return a;if(a.indexOf("*")!==-1||a.indexOf("~")!==-1||a.indexOf(":")!==-1)return a;for(var b="",c=a.split(" "),d=0;d<c.length;d++){var e=c[d];e.length>0&&(e+=this.fuzzify,"*"==this.fuzzify&&(e="*"+e),b+=e+" ")}return b},this._escapeRegExp=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},this._replaceAll=function(a,b,c){return a.replace(new RegExp(this._escapeRegExp(b),"g"),c)},this._unReplaceAll=function(a,b){return a.replace(new RegExp("\\\\("+this._escapeRegExp(b)+")","g"),"$1")},this._paired=function(a,b){var c=a.match(new RegExp(this._escapeRegExp(b),"g"))||[];return c.length%2===0},this._escape=function(a){for(var b=this.escapeSet.slice(0),c=0;c<this.pairs.length;c++){var d=this.pairs[c];this._paired(a,d)||b.push(d)}for(var c=0;c<b.length;c++){var d=b[c];a=this._replaceAll(a,d,"\\"+d)}return a},this._unescape=function(a){for(var b=0;b<this.unEscapeSet.length;b++){var c=this.unEscapeSet[b];a=this._unReplaceAll(a,c)}return a},a.raw&&this.parse(a.raw)},newSort:function(a){return a||(a={}),new es.Sort(a)},Sort:function(a){this.field=a.field||"_score",this.order=a.order||"desc",this.objectify=function(){var a={};return a[this.field]={order:this.order},a},this.parse=function(a){this.field=Object.keys(a)[0],a[this.field].order&&(this.order=a[this.field].order)},a.raw&&this.parse(a.raw)},newAggregation:function(a){return a||(a={}),new es.Aggregation(a)},Aggregation:function(a){this.name=a.name,this.aggs=a.aggs||[],this.addAggregation=function(a){for(var b=0;b<this.aggs.length;b++)if(this.aggs[b].name===a.name)return;this.aggs.push(a)},this.removeAggregation=function(){},this.clearAggregations=function(){},this._make_aggregation=function(a,b){var c={};if(c[this.name]={},c[this.name][a]=b,this.aggs.length>0){c[this.name].aggs={};for(var d=0;d<this.aggs.length;d++)$.extend(c[this.name].aggs,this.aggs[d].objectify())}return c},this._parse_wrapper=function(a,b){this.name=Object.keys(a)[0];var c=a[this.name][b],d=a[this.name].aggs?a[this.name].aggs:a[this.name].aggregations;if(d)for(var e=Object.keys(d),f=0;f<e.length;f++){var g=e[f],h=d[e[f]],i=Object.keys(h)[0],j={};j[g]=h;var k=es.aggregationFactory(i,{raw:j});k&&this.addAggregation(k)}return c}},newTermsAggregation:function(a){return a||(a={}),es.TermsAggregation.prototype=es.newAggregation(a),new es.TermsAggregation(a)},TermsAggregation:function(a){this.field=a.field||!1,this.size=a.size||10,this.orderBy="_count",a.orderBy&&(this.orderBy=a.orderBy,"_"!==this.orderBy[0]&&(this.orderBy="_"+this.orderBy)),this.orderDir=a.orderDir||"desc",this.setOrdering=function(a,b){this.orderBy=a,"_"!==this.orderBy[0]&&(this.orderBy="_"+this.orderBy),this.orderDir=b},this.objectify=function(){var a={field:this.field,size:this.size,order:{}};return a.order[this.orderBy]=this.orderDir,this._make_aggregation("terms",a)},this.parse=function(a){var b=this._parse_wrapper(a,"terms");this.field=b.field,b.size&&(this.size=b.size),b.order&&(this.orderBy=Object.keys(b.order)[0],this.orderDir=b.order[this.orderBy])},a.raw&&this.parse(a.raw)},newCardinalityAggregation:function(a){return a||(a={}),es.CardinalityAggregation.prototype=es.newAggregation(a),new es.CardinalityAggregation(a)},CardinalityAggregation:function(a){this.field=es.getParam(a.field,!1),this.objectify=function(){var a={field:this.field};return this._make_aggregation("cardinality",a)},this.parse=function(a){var b=this._parse_wrapper(a,"cardinality");this.field=b.field},a.raw&&this.parse(a.raw)},newRangeAggregation:function(a){return a||(a={}),es.RangeAggregation.prototype=es.newAggregation(a),new es.RangeAggregation(a)},RangeAggregation:function(a){this.field=a.field||!1,this.ranges=a.ranges||[],this.objectify=function(){var a={field:this.field,ranges:this.ranges};return this._make_aggregation("range",a)},this.parse=function(a){var b=this._parse_wrapper(a,"range");this.field=b.field,this.ranges=b.ranges},a.raw&&this.parse(a.raw)},newGeoDistanceAggregation:function(a){return a||(a={}),es.GeoDistanceAggregation.prototype=es.newAggregation(a),new es.GeoDistanceAggregation(a)},GeoDistanceAggregation:function(a){this.field=a.field||!1,this.lat=a.lat||!1,this.lon=a.lon||!1,this.unit=a.unit||"m",this.distance_type=a.distance_type||"sloppy_arc",this.ranges=a.ranges||[],this.objectify=function(){var a={field:this.field,origin:{lat:this.lat,lon:this.lon},unit:this.unit,distance_type:this.distance_type,ranges:this.ranges};return this._make_aggregation("geo_distance",a)},this.parse=function(a){var b=this._parse_wrapper(a,"range");this.field=b.field;var c=b.origin;c.lat&&(this.lat=c.lat),c.lon&&(this.lon=c.lon),b.unit&&(this.unit=b.unit),b.distance_type&&(this.distance_type=b.distance_type),this.ranges=b.ranges},a.raw&&this.parse(a.raw)},newStatsAggregation:function(a){return a||(a={}),es.StatsAggregation.prototype=es.newAggregation(a),new es.StatsAggregation(a)},StatsAggregation:function(a){this.field=a.field||!1,this.objectify=function(){var a={field:this.field};return this._make_aggregation("stats",a)},this.parse=function(a){},a.raw&&this.parse(a.raw)},newDateHistogramAggregation:function(a){return a||(a={}),es.DateHistogramAggregation.prototype=es.newAggregation(a),new es.DateHistogramAggregation(a)},DateHistogramAggregation:function(a){this.field=a.field||!1,this.interval=a.interval||"month",this.format=a.format||!1,this.objectify=function(){var a={field:this.field,interval:this.interval};return this.format&&(a.format=this.format),this._make_aggregation("date_histogram",a)},this.parse=function(a){var b=this._parse_wrapper(a,"date_histogram");this.field=b.field,b.interval&&(this.interval=b.interval),b.format&&(this.format=b.format)},a.raw&&this.parse(a.raw)},newFilter:function(a){return a||(a={}),new es.Filter(a)},Filter:function(a){this.field=a.field,this.type_name=a.type_name,this.matches=function(a){return a.type_name===this.type_name&&(!a.field||a.field===this.field)},this.objectify=function(){},this.parse=function(){}},newTermFilter:function(a){return a||(a={}),a.type_name="term",es.TermFilter.prototype=es.newFilter(a),new es.TermFilter(a)},TermFilter:function(a){this.value=a.value||!1,this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);return!!b&&(!a.value||a.value===this.value)},this.objectify=function(){var a={term:{}};return a.term[this.field]=this.value,a},this.parse=function(a){a.term&&(a=a.term),this.field=Object.keys(a)[0],this.value=a[this.field]},a.raw&&this.parse(a.raw)},newTermsFilter:function(a){return a||(a={}),a.type_name="terms",es.TermsFilter.prototype=es.newFilter(a),new es.TermsFilter(a)},TermsFilter:function(a){this.values=a.values||!1,this.execution=a.execution||!1,this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);if(!b)return!1;if(a.values){if(a.values.length!==this.values.length)return!1;for(var c=0;c<a.values.length;c++)if($.inArray(a.values[c],this.values)===-1)return!1}return!0},this.objectify=function(){var a=this.values||[],b={terms:{}};return b.terms[this.field]=a,this.execution&&(b.terms.execution=this.execution),b},this.parse=function(a){a.terms&&(a=a.terms),this.field=Object.keys(a)[0],this.values=a[this.field],a.execution&&(this.execution=a.execution)},this.add_term=function(a){this.values||(this.values=[]),$.inArray(a,this.values)===-1&&this.values.push(a)},this.has_term=function(a){return!!this.values&&$.inArray(a,this.values)>=0},this.remove_term=function(a){if(this.values){var b=$.inArray(a,this.values);b>=0&&this.values.splice(b,1)}},this.has_terms=function(){return this.values!==!1&&this.values.length>0},this.term_count=function(){return this.values===!1?0:this.values.length},this.clear_terms=function(){this.values=!1},a.raw&&this.parse(a.raw)},newRangeFilter:function(a){return a||(a={}),a.type_name="range",es.RangeFilter.prototype=es.newFilter(a),new es.RangeFilter(a)},RangeFilter:function(a){this.lt=es.getParam(a.lt,!1),this.lte=es.getParam(a.lte,!1),this.gte=es.getParam(a.gte,!1),this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);return!!b&&((!a.lt||a.lt===this.lt)&&((!a.lte||a.lte===this.lte)&&(!a.gte||a.gte===this.gte)))},this.objectify=function(){var a={range:{}};return a.range[this.field]={},this.lte!==!1&&(a.range[this.field].lte=this.lte),this.lt!==!1&&this.lte===!1&&(a.range[this.field].lt=this.lt),this.gte!==!1&&(a.range[this.field].gte=this.gte),a},this.parse=function(a){a.range&&(a=a.range),this.field=Object.keys(a)[0],void 0!==a[this.field].lte&&a[this.field].lte!==!1&&(this.lte=a[this.field].lte),void 0!==a[this.field].lt&&a[this.field].lt!==!1&&(this.lt=a[this.field].lt),void 0!==a[this.field].gte&&a[this.field].gte!==!1&&(this.gte=a[this.field].gte)},a.raw&&this.parse(a.raw)},newGeoDistanceRangeFilter:function(a){return a||(a={}),a.type_name="geo_distance_range",es.GeoDistanceRangeFilter.prototype=es.newFilter(a),new es.GeoDistanceRangeFilter(a)},GeoDistanceRangeFilter:function(a){this.lt=a.lt||!1,this.gte=a.gte||!1,this.lat=a.lat||!1,this.lon=a.lon||!1,this.unit=a.unit||"m",this.objectify=function(){var a={geo_distance_range:{}};return a.geo_distance_range[this.field]={lat:this.lat,lon:this.lon},this.lt&&(a.geo_distance_range.lt=this.lt+this.unit),this.gte&&(a.geo_distance_range.gte=this.gte+this.unit),a},this.parse=function(a){function b(a,b){return a.indexOf(b,a.length-b.length)!==-1}function c(a){for(var c=!1,d=0;d<es.distanceUnits.length;d++){var e=es.distanceUnits[d];b(a,e)&&(a=a.substring(0,a.length-e.length),c=a.substring(a.length-e.length))}return[a,c]}a.geo_distance_range&&(a=a.geo_distance_range),this.field=Object.keys(a)[0],this.lat=a[this.field].lat,this.lon=a[this.field].lon;var d=a[this.field].lt,e=a[this.field].gte;if(d){d=d.trim();var f=c(d);this.lt=f[0],this.unit=f[1]}if(e){e=e.trim();var f=c(e);this.gte=f[0],this.unit=f[1]}},a.raw&&this.parse(a.raw)},newResult:function(a){return a||(a={}),new es.Result(a)},Result:function(a){this.data=a.raw,this.buckets=function(a){return this.data.aggregations[a].buckets},this.aggregation=function(a){return this.data.aggregations[a]},this.results=function(){var a=[];if(this.data.hits&&this.data.hits.hits)for(var b=0;b<this.data.hits.hits.length;b++){var c=this.data.hits.hits[b];"_source"in c?a.push(c._source):"fields"in c&&a.push(c.fields)}return a},this.total=function(){return!(!this.data.hits||!this.data.hits.total)&&parseInt(this.data.hits.total)}},doQuery:function(a){var b=a.success,c=a.complete,d=a.search_url,e=a.queryobj,f=a.datatype,g=JSON.stringify(e);$.ajax({type:"get",url:d,data:{source:g},dataType:f,success:es.querySuccess(b),complete:c})},querySuccess:function(a){return function(b){var c=es.newResult({raw:b});a(c)}},getParam:function(a,b){return void 0!==a?a:b}};!function(a){a.fn.bindWithDelay=function(b,c,d,e,f){function g(){var b=a.extend(!0,{},arguments[0]),c=function(){h=null,d.apply(i,[b])};f||clearTimeout(h),f&&h||(h=setTimeout(c,e))}var h=null,i=this;return a.isFunction(c)&&(f=e,e=d,d=c,c=void 0),this.bind(b,c,g)}}(jQuery);var muk={activeEdges:{},yearRanges:function(a,b){for(var c=Object.keys(a),d=moment(),e={},f=0;f<c.length;f++){var g=c[f],h=a[g],i=moment(d.year()+"-"+h,"YYYY-MM-DD"),j=!1,k=!1;d<=i?(j=moment(i).subtract(1,"day"),k=moment(i).subtract(1,"year")):(j=moment(i).add(1,"year").subtract(1,"day"),k=moment(i));for(var l=Object.keys(b),m=0;m<l.length;m++){var n=l[m],o=b[n],p=n+g;0===o?e[p]=[k,j]:e[p]=[moment(k).subtract(o,"year"),moment(j).subtract(o,"year")]}}return e},toIntFormat:function(){return edges.numFormat({decimalPlaces:0,thousandsSeparator:","})},toGBPIntFormat:function(){return edges.numFormat({prefix:"£",decimalPlaces:0,thousandsSeparator:","})}},edges={newEdge:function(a){return a||(a={}),new edges.Edge(a)},Edge:function(a){this.selector=a.selector||"body",this.search_url=edges.getParam(a.search_url,!1),this.datatype=a.datatype||"jsonp",this.preflightQueries=edges.getParam(a.preflightQueries,!1),this.baseQuery=a.baseQuery||!1,this.openingQuery=a.openingQuery||es.newQuery(),this.secondaryQueries=edges.getParam(a.secondaryQueries,!1),this.initialSearch=edges.getParam(a.initialSearch,!0),this.staticFiles=edges.getParam(a.staticFiles,[]),this.manageUrl=a.manageUrl||!1,this.urlQuerySource=a.urlQuerySource||"source",this.template=a.template||!1,this.components=a.components||[],this.renderPacks=a.renderPacks||[edges.bs3,edges.nvd3,edges.highcharts,edges.google,edges.d3],this.urlQuery=!1,this.urlParams={},this.shortUrl=!1,this.currentQuery=!1,this.result=!1,this.preflightResults={},this.realisedSecondaryQueries={},this.secondaryResults={},this.searching=!1,this.context=!1,this.static={},this.resources={},this.errorLoadingStatic=[],this.startup=function(){if(this.context=$(this.selector),this.context.trigger("edges:pre-init"),this.manageUrl){var a=this.getUrlParams();this.urlQuerySource in a&&(this.urlQuery=es.newQuery({raw:a[this.urlQuerySource]}),delete a[this.urlQuerySource]),this.urlParams=a}this.template&&this.template.draw(this);for(var b=0;b<this.components.length;b++){var c=this.components[b];c.init(this)}this.draw();var d=edges.objClosure(this,"startupPart2");this.loadStaticsAsync(d)},this.startupPart2=function(){var a=edges.objClosure(this,"startupPart3");this.runPreflightQueries(a)},this.startupPart3=function(){var a=this.openingQuery;this.urlQuery&&(a=this.urlQuery,this.urlQuery=!1);for(var b=0;b<this.components.length;b++){var c=this.components[b];c.contrib(a)}this.pushQuery(a),this.context.trigger("edges:post-init"),this.cycle()},this.doQuery=function(){this.cycle()},this.cycle=function(){if(!this.searching)if(this.searching=!0,this.shortUrl=!1,this.context.trigger("edges:pre-query"),this.manageUrl&&this.updateUrl(),this.search_url){var a=edges.objClosure(this,"cyclePart2");this.doPrimaryQuery(a)}else this.cyclePart2()},this.cyclePart2=function(){var a=edges.objClosure(this,"cyclePart3");this.runSecondaryQueries(a)},this.cyclePart3=function(){this.synchronise(),this.context.trigger("edges:pre-render"),this.draw(),this.context.trigger("edges:post-render"),this.searching=!1},this.synchronise=function(){for(var a=0;a<this.components.length;a++){var b=this.components[a];b.synchronise()}},this.draw=function(){for(var a=0;a<this.components.length;a++){var b=this.components[a];b.draw(this)}},this.reset=function(){this.context.trigger("edges:pre-reset");for(var a=this.cloneOpeningQuery(),b=0;b<this.components.length;b++){var c=this.components[b];c.contrib(a)}this.pushQuery(a),this.context.trigger("edges:post-reset"),this.cycle()},this.cloneQuery=function(){return!!this.currentQuery&&$.extend(!0,{},this.currentQuery)},this.pushQuery=function(a){this.baseQuery&&a.merge(this.baseQuery),this.currentQuery=a},this.cloneBaseQuery=function(){return this.baseQuery?$.extend(!0,{},this.baseQuery):es.newQuery()},this.cloneOpeningQuery=function(){return this.openingQuery?$.extend(!0,{},this.openingQuery):es.newQuery()},this.doPrimaryQuery=function(a){var b={callback:a};es.doQuery({search_url:this.search_url,queryobj:this.currentQuery.objectify(),datatype:this.datatype,success:edges.objClosure(this,"querySuccess",["result"],b),error:edges.objClosure(this,"queryFail",b)})},this.queryFail=function(a){var b=a.context;this.context.trigger("edges:query-fail"),b()},this.querySuccess=function(a){this.result=a.result;var b=a.callback;this.context.trigger("edges:query-success"),b()},this.runPreflightQueries=function(a){if(!this.preflightQueries||0==Object.keys(this.preflightQueries).length)return void a();this.context.trigger("edges:pre-preflight");for(var b=[],c=Object.keys(this.preflightQueries),d=0;d<c.length;d++){var e=c[d];b.push({id:e,query:this.preflightQueries[e]})}var f=this,g=edges.newAsyncGroup({list:b,action:function(a){var b=a.entry,c=a.success_callback,d=a.error_callback;es.doQuery({search_url:f.search_url,queryobj:b.query.objectify(),datatype:f.datatype,success:c,error:d})},successCallbackArgs:["result"],success:function(a){var b=a.result,c=a.entry;f.preflightResults[c.id]=b},errorCallbackArgs:["result"],error:function(a){f.context.trigger("edges:error-preflight")},carryOn:function(){f.context.trigger("edges:post-preflight"),a()}});g.process()},this.runSecondaryQueries=function(a){if(this.realisedSecondaryQueries={},!this.secondaryQueries||0==Object.keys(this.secondaryQueries).length)return void a();var b=[];for(var c in this.secondaryQueries){var d={};d.query=this.secondaryQueries[c](this),d.id=c,b.push(d),this.realisedSecondaryQueries[c]=d.query}var e=this,f=edges.newAsyncGroup({list:b,action:function(a){var b=a.entry,c=a.success_callback;a.error_callback;es.doQuery({search_url:e.search_url,queryobj:b.query.objectify(),datatype:e.datatype,success:c,complete:!1})},successCallbackArgs:["result"],success:function(a){var b=a.result,c=a.entry;e.secondaryResults[c.id]=b},errorCallbackArgs:["result"],error:function(a){},carryOn:function(){a()}});f.process()},this.getComponent=function(a){for(var b=a.id,c=0;c<this.components.length;c++){var d=this.components[c];if(d.id===b)return d}return!1},this.category=function(a){for(var b=[],c=0;c<this.components.length;c++){var d=this.components[c];d.category===a&&b.push(d)}return b},this.getRenderPackObject=function(a,b){for(var c=0;c<this.renderPacks.length;c++){var d=this.renderPacks[c];if(d&&d.hasOwnProperty(a))return d[a](b)}},this.jq=function(a){return $(a,this.context)},this.getUrlParams=function(){var a={},b=window.location.href,c=!1;b.indexOf("#")>-1&&(c=b.slice(b.indexOf("#")),b=b.substring(0,b.indexOf("#")));for(var d=b.slice(b.indexOf("?")+1).split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(2===f.length){var g=decodeURIComponent(f[1]);"["!=g[0]&&"{"!=g[0]||(g=g.replace(/^"/,"").replace(/"$/,""),g=JSON.parse(g)),a[f[0]]=g}}return c&&(a["#"]=c),a},this.urlQueryArg=function(a){a||(a={include_query_string:!0,include_filters:!0,include_paging:!0,include_sort:!0,include_fields:!1,include_aggregations:!1,include_facets:!1});var b=JSON.stringify(this.currentQuery.objectify(a)),c={};return c[this.urlQuerySource]=encodeURIComponent(b),c},this.fullQueryArgs=function(){var a=$.extend(!0,{},this.urlParams);return $.extend(a,this.urlQueryArg()),a},this.fullUrlQueryString=function(){return this._makeUrlQuery(this.fullQueryArgs())},this._makeUrlQuery=function(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++){var e=b[d],f=a[e];c.push(e+"="+f)}return c.join("&")},this.fullUrl=function(){var a=this.fullQueryArgs(),b="";a["#"]&&(b="#"+a["#"],delete a["#"]);var c=window.location.toString(),d=c.split("?"),e=d[0]+"?"+this._makeUrlQuery(a)+b;return e},this.updateUrl=function(){if("pushState"in window.history){var a="?"+this.fullUrlQueryString();window.history.pushState("","",a)}},this.loadStaticsAsync=function(a){if(!this.staticFiles||0==this.staticFiles.length)return this.context.trigger("edges:post-load-static"),void a();var b=this,c=edges.newAsyncGroup({list:this.staticFiles,action:function(a){var b=a.entry,c=a.success_callback,d=a.error_callback,e=(b.id,b.url),f=edges.getParam(b.datatype,"text");$.ajax({type:"get",url:e,dataType:f,success:c,error:d})},successCallbackArgs:["data"],success:function(a){var c=a.data,d=a.entry;if(d.processor){var e=d.processor({data:c});b.resources[d.id]=e,d.opening&&d.opening({resource:e})}b.static[d.id]=c},errorCallbackArgs:["data"],error:function(a){b.errorLoadingStatic.push(a.entry.id),b.context.trigger("edges:error-load-static")},carryOn:function(){b.context.trigger("edges:post-load-static"),a()}});c.process()},this.startup()},newAsyncGroup:function(a){return a||(a={}),new edges.AsyncGroup(a)},AsyncGroup:function(a){this.list=a.list,this.successCallbackArgs=a.successCallbackArgs,this.errorCallbackArgs=a.errorCallbackArgs;var b=a.action,c=a.success,d=a.carryOn,e=a.error;this.functions={action:b,success:c,carryOn:d,error:e},this.checkList=[],this.finished=!1,this.construct=function(a){for(var b=0;b<this.list.length;b++)this.checkList.push(0)},this.process=function(a){0==this.list.length&&this.functions.carryOn();for(var b=0;b<this.list.length;b++){var c={index:b},d=edges.objClosure(this,"_actionSuccess",this.successCallbackArgs,c),e=edges.objClosure(this,"_actionError",this.successCallbackArgs,c),f=!1;this.functions.action({entry:this.list[b],success_callback:d,error_callback:e,complete_callback:f})}},this._actionSuccess=function(a){var b=a.index;delete a.index,a.entry=this.list[b],this.functions.success(a),this.checkList[b]=1,this._isComplete()&&this._finalise()},this._actionError=function(a){var b=a.index;delete a.index,a.entry=this.list[b],this.functions.error(a),this.checkList[b]=-1,this._isComplete()&&this._finalise()},this._actionComplete=function(a){},this._isComplete=function(){return $.inArray(0,this.checkList)===-1},this._finalise=function(){this.finished||(this.finished=!0,this.functions.carryOn())},this.construct()},newRenderer:function(a){return a||(a={}),new edges.Renderer(a)},Renderer:function(a){this.component=a.component||!1,this.init=function(a){this.component=a},this.draw=function(a){}},newComponent:function(a){return a||(a={}),new edges.Component(a)},Component:function(a){this.id=a.id,this.renderer=a.renderer,this.category=a.category||"none",this.defaultRenderer=a.defaultRenderer||"newRenderer",this.init=function(a){this.edge=a,this.context=this.edge.jq("#"+this.id),this.renderer||(this.renderer=this.edge.getRenderPackObject(this.defaultRenderer)),this.renderer&&this.renderer.init(this)},this.draw=function(){this.renderer&&this.renderer.draw()},this.contrib=function(a){},this.synchronise=function(){},this.jq=function(a){return this.edge.jq(a)}},newSelector:function(a){return a||(a={}),edges.Selector.prototype=edges.newComponent(a),new edges.Selector(a)},Selector:function(a){this.field=a.field,this.display=a.display||this.field,this.active=a.active||!0,this.disabled=a.disabled||!1,this.category=a.category||"selector"},newTemplate:function(a){return a||(a={}),new edges.Template(a)},Template:function(a){this.draw=function(a){}},objClosure:function(a,b,c,d){return function(){if(c){for(var e={},f=0;f<c.length;f++)arguments.length>f&&(e[c[f]]=arguments[f]);d&&(e=$.extend(e,d)),a[b](e)}else{var g=Array.prototype.slice,h=g.apply(arguments);d&&h.push(d),a[b].apply(a,h)}}},eventClosure:function(a,b,c){return function(d){c&&!c(d)||(d.preventDefault(),a[b](this))}},css_classes:function(a,b,c){var d=a+"-"+b;return c&&(d+=" "+d+"-"+c.component.id),d},css_class_selector:function(a,b,c){var d="."+a+"-"+b;return c&&(d+=d+"-"+c.component.id),d},css_id:function(a,b,c){var d=a+"-"+b;return c&&(d+="-"+c.component.id),d},css_id_selector:function(a,b,c){return"#"+edges.css_id(a,b,c)},on:function(a,b,c,d,e,f){c.component&&c.component.id?b=b+"."+c.component.id:c.namespace&&(b=b+"."+c.namespace);var g=edges.eventClosure(c,d,f);e?c.component?c.component.jq(a).bindWithDelay(b,g,e):c.edge?c.edge.jq(a).bindWithDelay(b,g,e):console.log("attempt to bindWithDelay on caller which has neither inner component or edge"):c.component?c.component.jq(a).on(b,g):c.edge?c.edge.jq(a).on(b,g):console.log("attempt to bindWithDelay on caller which has neither inner component or edge")},escapeHtml:function(a,b){if(void 0===b&&(b=""),void 0===a||null==a)return b;try{return"function"!=typeof a.replace?a:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}catch(a){return b}},objVal:function(a,b,c){void 0===c&&(c=!1);for(var d=a.split("."),e=b,f=0;f<d.length;f++){var g=d[f];if(!(g in e))return c;e=e[g]}return e},getParam:function(a,b){return void 0!==a?a:b},safeId:function(a){return a.replace(/&/g,"_").replace(/</g,"_").replace(/>/g,"_").replace(/"/g,"_").replace(/'/g,"_").replace(/\./gi,"_").replace(/\:/gi,"_").replace(/\s/gi,"_")},numFormat:function(a){var b=edges.getParam(a.prefix,""),c=edges.getParam(a.zeroPadding,!1),d=edges.getParam(a.decimalPlaces,!1),e=edges.getParam(a.thousandsSeparator,!1),f=edges.getParam(a.decimalSeparator,"."),g=edges.getParam(a.suffix,"");return function(a){a=parseFloat(a),a=d!==!1?a.toFixed(d):a.toString();var h=a.split(".");if(c!==!1){for(var i=c-h[0].length,j="",k=0;k<i;k++)j+="0";h[0]=j+h[0]}return e!==!1&&(h[0]=h[0].replace(/\B(?=(\d{3})+(?!\d))/g,e)),
1==h.length?b+h[0]+g:b+h[0]+f+h[1]+g}}};$.extend(!0,edges,{bs3:{newSearchBoxRenderer:function(a){return a||(a={}),edges.bs3.SearchBoxRenderer.prototype=edges.newRenderer(a),new edges.bs3.SearchBoxRenderer(a)},SearchBoxRenderer:function(a){this.searchButton=edges.getParam(a.searchButton,!1),this.searchButtonText=edges.getParam(a.searchButtonText,!1),this.clearButton=edges.getParam(a.clearButton,!0),this.searchPlaceholder=edges.getParam(a.searchPlaceholder,"Search"),this.freetextSubmitDelay=edges.getParam(a.freetextSubmitDelay,500),this.namespace="edges-bs3-search-box",this.draw=function(){function a(a){var b=a.keyCode?a.keyCode:a.which;return 13===b}var b=this.component,c=edges.css_classes(this.namespace,"search",this),d=edges.css_classes(this.namespace,"field",this),e=edges.css_classes(this.namespace,"reset",this),f=edges.css_classes(this.namespace,"text",this),g=edges.css_classes(this.namespace,"search-button",this),h=edges.css_id(this.namespace,"text",this),i="";if(b.fieldOptions&&b.fieldOptions.length>0){i+='<select class="form-control '+d+'" style="width: 120px">',i+='<option value="">search all</option>';for(var j=0;j<b.fieldOptions.length;j++){var k=b.fieldOptions[j];i+='<option value="'+k.field+'">'+edges.escapeHtml(k.display)+"</option>"}i+="</select>"}var l="";this.clearButton&&(l='<span class="input-group-btn">                         <button type="button" class="btn btn-danger '+e+'" title="Clear all search parameters and start again">                             <span class="glyphicon glyphicon-remove"></span>                         </button>                     </span>');var m="";if(this.searchButton){var n='<span class="glyphicon glyphicon-white glyphicon-search"></span>';this.searchButtonText!==!1&&(n=this.searchButtonText),m='<span class="input-group-btn">                         <button type="button" class="btn btn-info '+g+'">                             '+n+"                         </button>                     </span>"}var o='<div class="'+c+'"><div class="form-inline">                         <div class="form-group">                             <div class="input-group">                                 '+l+i+'                                <input type="text" id="'+h+'" class="form-control '+f+'" name="q" value="" placeholder="'+this.searchPlaceholder+'"/>                                 '+m+"                             </div>                         </div>                     </div></div>",p='<div class="row"><div class="col-md-12">{{SEARCH}}</div></div>';if(p=p.replace(/{{SEARCH}}/g,o),b.context.html(p),b.fieldOptions&&b.fieldOptions.length>0&&this.setUISearchField(),this.setUISearchText(),b.fieldOptions&&b.fieldOptions.length>0){var q=edges.css_class_selector(this.namespace,"field",this);edges.on(q,"change",this,"changeSearchField")}var r=edges.css_class_selector(this.namespace,"text",this);if(this.freetextSubmitDelay>-1?edges.on(r,"keyup",this,"setSearchText",this.freetextSubmitDelay):edges.on(r,"keyup",this,"setSearchText",!1,a),this.clearButton){var s=edges.css_class_selector(this.namespace,"reset",this);edges.on(s,"click",this,"clearSearch")}if(this.searchButton){var t=edges.css_class_selector(this.namespace,"search-button",this);edges.on(t,"click",this,"doSearch")}},this.setUISearchField=function(){if(this.component.searchField){var a=edges.css_class_selector(this.namespace,"field",this),b=this.component.jq(a);b.val(this.component.searchField)}},this.setUISearchText=function(){if(this.component.searchString){var a=edges.css_class_selector(this.namespace,"text",this),b=this.component.jq(a);b.val(this.component.searchString)}},this.changeSearchField=function(a){var b=this.component.jq(a).val();this.component.setSearchField(b)},this.setSearchText=function(a){var b=this.component.jq(a).val();this.component.setSearchText(b)},this.clearSearch=function(a){this.component.clearSearch()},this.doSearch=function(a){var b=edges.css_id_selector(this.namespace,"text",this),c=this.component.jq(b).val();this.component.setSearchText(c)}}}}),$.extend(edges,{newNumericRangeEntry:function(a){return a||(a={}),edges.NumericRangeEntry.prototype=edges.newSelector(a),new edges.NumericRangeEntry(a)},NumericRangeEntry:function(a){this.lower=edges.getParam(a.lower,!1),this.upper=edges.getParam(a.upper,!1),this.increment=edges.getParam(a.increment,1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newNumericRangeEntryRenderer"),this.from=!1,this.to=!1,this.init=function(a){if(edges.newSelector().init.call(this,a),!this.lower||!this.upper){var b=this.edge.cloneBaseQuery();b.clearAggregations(),b.size=0,b.addAggregation(es.newStatsAggregation({name:this.id,field:this.field})),es.doQuery({search_url:this.edge.search_url,queryobj:b.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"querySuccess",["result"]),error:edges.objClosure(this,"queryFail")})}},this.synchronise=function(){if(this.from=this.lower,this.to=this.upper,this.edge.currentQuery)for(var a=this.edge.currentQuery.listMust(es.newRangeFilter({field:this.field})),b=0;b<a.length;b++)this.to=a[b].lte,this.from=a[b].gte},this.querySuccess=function(a){var b=a.result,c=b.aggregation(this.id);this.lower===!1&&(this.lower=c.min),this.upper===!1&&(this.upper=c.max),this.draw()},this.queryFail=function(a){this.lower===!1&&(this.lower=0),this.upper===!1&&(this.upper=0)},this.selectRange=function(a,b){var c=this.edge.cloneQuery();c.removeMust(es.newRangeFilter({field:this.field})),a===this.lower&&b===this.upper||c.addMust(es.newRangeFilter({field:this.field,gte:a,lte:b})),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()}},newMultiDateRangeEntry:function(a){return a||(a={}),edges.MultiDateRangeEntry.prototype=edges.newComponent(a),new edges.MultiDateRangeEntry(a)},MultiDateRangeEntry:function(a){this.display=edges.getParam(a.display,!1),this.fields=edges.getParam(a.fields,[]),this.earliest=edges.getParam(a.earliest,{}),this.latest=edges.getParam(a.latest,{}),this.autoLookupRange=edges.getParam(a.autoLookupRange,!1),this.category=edges.getParam(a.category,"selector"),this.defaultEarliest=edges.getParam(a.defaultEarliest,new Date(0)),this.defaultLatest=edges.getParam(a.defaultLatest,new Date),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newMultiDateRangeRenderer"),this.currentField=!1,this.fromDate=!1,this.toDate=!1,this.touched=!1,this.dateOptions={},this.init=function(a){Object.getPrototypeOf(this).init.call(this,a),this.currentField=this.fields[0].field,this.lastField=!1,this.autoLookupRange?(a.secondaryQueries===!1&&(a.secondaryQueries={}),a.secondaryQueries["multidaterange_"+this.id]=this.getSecondaryQueryFunction()):this.loadDates()},this.synchronise=function(){if(this.currentField=!1,this.fromDate=!1,this.toDate=!1,this.autoLookupRange)for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,c=this.edge.secondaryResults["multidaterange_"+this.id].aggregation(b),d=this.defaultEarliest,e=this.defaultLatest;null!==c.min&&(d=new Date(c.min)),null!==c.max&&(e=new Date(c.max)),this.dateOptions[b]={earliest:d,latest:e}}for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,f=this.edge.currentQuery.listMust(es.newRangeFilter({field:b}));if(f.length>0){this.currentField=b;var g=f[0];this.fromDate=g.gte,this.toDate=g.lt}}!this.currentField&&this.fields.length>0&&(this.currentField=this.fields[0].field)},this.currentEarliest=function(){return!!this.currentField&&(this.dateOptions[this.currentField]?this.dateOptions[this.currentField].earliest:void 0)},this.currentLatest=function(){return!!this.currentField&&(this.dateOptions[this.currentField]?this.dateOptions[this.currentField].latest:void 0)},this.changeField=function(a){this.lastField=this.currentField,a!==this.currentField&&(this.touched=!0,this.currentField=a)},this.setFrom=function(a){a!==this.fromDate&&(this.touched=!0,this.fromDate=a)},this.setTo=function(a){a!==this.toDate&&(this.touched=!0,this.toDate=a)},this.triggerSearch=function(){if(this.touched){this.touched=!1;for(var a=this.edge.cloneQuery(),b=0,c=0;c<this.fields.length;c++){var d=this.fields[c].field;b+=a.removeMust(es.newRangeFilter({field:d}))}var e=this.currentField&&(this.toDate||this.fromDate),f=b>0||e;if(!f)return!1;if(e){var g={field:this.currentField};this.toDate&&(g.lt=this.toDate),this.fromDate&&(g.gte=this.fromDate),a.addMust(es.newRangeFilter(g))}return this.edge.pushQuery(a),this.edge.doQuery(),!0}},this.loadDates=function(){for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,c=this.defaultEarliest,d=this.defaultLatest,e=this.earliest[b],f=this.latest[b];e&&(c=e()),f&&(d=f()),this.dateOptions[b]={earliest:c,latest:d}}},this.getSecondaryQueryFunction=function(){var a=this;return function(b){for(var c=b.cloneQuery(),d=0;d<a.fields.length;d++){var e=a.fields[d];c.removeMust(es.newRangeFilter({field:e.field}))}c.clearAggregations();for(var d=0;d<a.fields.length;d++){var e=a.fields[d].field;c.addAggregation(es.newStatsAggregation({name:e,field:e}))}return c.size=0,c.from=0,c}}}}),$.extend(!0,edges,{bs3:{newFacetFilterSetterRenderer:function(a){return a||(a={}),edges.bs3.FacetFilterSetterRenderer.prototype=edges.newRenderer(a),new edges.bs3.FacetFilterSetterRenderer(a)},FacetFilterSetterRenderer:function(a){this.open=edges.getParam(a.open,!1),this.togglable=edges.getParam(a.togglable,!0),this.showCount=edges.getParam(a.showCount,!0),this.facetTitle=edges.getParam(a.facetTitle,"Untitled"),this.intro=edges.getParam(a.intro,!1),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.namespace="edges-bs3-facet-filter-setter",this.draw=function(){for(var a=this.component,b=this.namespace,c=edges.css_classes(b,"filter",this),d=edges.css_classes(b,"value",this),e=edges.css_classes(b,"filter-remove",this),f=edges.css_classes(b,"facet",this),g=edges.css_classes(b,"header",this),h=edges.css_classes(this.namespace,"body",this),i=edges.css_classes(this.namespace,"intro",this),j=edges.css_classes(b,"count",this),k=edges.css_id(b,"toggle",this),l=edges.css_id(b,"results",this),m="",n=0;n<a.filters.length;n++){var o=a.filters[n],p=o.id,q=o.display,r=a.filter_counts[p],s=a.active_filters[p];void 0===r&&(r=0),m+='<div class="'+c+'">',s?(m+="<strong>"+edges.escapeHtml(q),this.showCount&&(m+=" ("+r+")"),m+='&nbsp;<a href="#" class="'+e+'" data-filter="'+edges.escapeHtml(p)+'">',m+='<i class="glyphicon glyphicon-black glyphicon-remove"></i></a>',m+="</strong>"):(m+='<a href="#" class="'+d+'" data-filter="'+edges.escapeHtml(p)+'">'+edges.escapeHtml(q)+"</a>",this.showCount&&(m+=' <span class="'+j+'">('+r+")</span>")),m+="</div>"}var t=this.headerLayout({toggleId:k}),u="";this.intro!==!1&&(u='<div class="'+i+'">'+this.intro+"</div>");var v='<div class="'+f+'">                        <div class="'+g+'"><div class="row">                             <div class="col-md-12">                                '+t+'                            </div>                        </div></div>                        <div class="'+h+'">                            <div class="row" style="display:none" id="'+l+'">                                <div class="col-md-12">                                    '+u+"                                    {{FILTERS}}                                </div>                            </div></div>                        </div>";v=v.replace(/{{FILTERS}}/g,m),a.context.html(v),this.setUIOpen();var w=edges.css_class_selector(b,"value",this),x=edges.css_class_selector(b,"filter-remove",this),y=edges.css_id_selector(b,"toggle",this);edges.on(w,"click",this,"filterSelected"),edges.on(y,"click",this,"toggleOpen"),edges.on(x,"click",this,"removeFilter")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d=this.facetTitle;return this.togglable&&(d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+d+"</a>"),d}if("right"===this.layout){var d="";return d=this.togglable?'<a href="#" id="'+b+'">'+this.facetTitle+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>':this.facetTitle}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"results",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.filterSelected=function(a){var b=this.component.jq(a).attr("data-filter");this.component.addFilter(b)},this.removeFilter=function(a){var b=this.component.jq(a).attr("data-filter");this.component.removeFilter(b)},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()}}}}),$.extend(edges,{newFilterSetter:function(a){return a||(a={}),edges.FilterSetter.prototype=edges.newComponent(a),new edges.FilterSetter(a)},FilterSetter:function(a){this.filters=edges.getParam(a.filters,[]),this.aggregations=edges.getParam(a.aggregations,[]),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newFilterSetterRenderer"),this.filter_counts={},this.active_filters={},this.contrib=function(a){for(var b=0;b<this.aggregations.length;b++)a.addAggregation(this.aggregations[b])},this.synchronise=function(){for(var a=0;a<this.filters.length;a++){var b=this.filters[a];if(b.agg_name&&b.bucket_field&&b.bucket_value){var c=this.edge.result.aggregation(b.agg_name);if(c){for(var d=b.bucket_field,e=b.bucket_value,f=0,g=c.buckets,h=0;h<g.length;h++){var i=g[h];if(i[d]&&i[d]==e){f=i.doc_count;break}}this.filter_counts[b.id]=f}}}for(var a=0;a<this.filters.length;a++){var b=this.filters[a];if(b.must){for(var j=b.must.length,k=0,l=0;l<b.must.length;l++){var m=b.must[l],n=this.edge.currentQuery.listMust(m);n.length>0&&(k+=1)}k===j?this.active_filters[b.id]=!0:this.active_filters[b.id]=!1}}},this.addFilter=function(a){for(var b=!1,c=0;c<this.filters.length;c++)if(this.filters[c].id===a){b=this.filters[c];break}if(b&&b.must){for(var d=this.edge.cloneQuery(),c=0;c<b.must.length;c++){var e=b.must[c];d.addMust(e)}d.from=0,this.edge.pushQuery(d),this.edge.doQuery()}},this.removeFilter=function(a){for(var b=!1,c=0;c<this.filters.length;c++)if(this.filters[c].id===a){b=this.filters[c];break}if(b&&b.must){for(var d=this.edge.cloneQuery(),c=0;c<b.must.length;c++){var e=b.must[c];d.removeMust(e)}d.from=0,this.edge.pushQuery(d),this.edge.doQuery()}}},newFullSearchController:function(a){return a||(a={}),edges.FullSearchController.prototype=edges.newComponent(a),new edges.FullSearchController(a)},FullSearchController:function(a){this.fuzzify=a.fuzzify||!1,this.sortOptions=a.sortOptions||!1,this.fieldOptions=a.fieldOptions||!1,this.urlShortener=a.urlShortener||!1,this.defaultOperator=a.defaultOperator||"OR",this.defaultRenderer=a.defaultRenderer||"newFullSearchControllerRenderer",this.searchField=!1,this.searchString=!1,this.sortBy=!1,this.sortDir="desc",this.shortUrl=!1,this.synchronise=function(){if(this.searchString=!1,this.searchField=!1,this.sortBy=!1,this.sortDir="desc",this.edge.currentQuery){var a=this.edge.currentQuery.getQueryString();a&&(this.searchString=a.queryString,this.searchField=a.defaultField);var b=this.edge.currentQuery.getSortBy();b.length>0&&(this.sortBy=b[0].field,this.sortDir=b[0].order)}},this.setSort=function(a){var b=a.dir,c=a.field;void 0!==b&&b!==!1||(b="desc");var d=this.edge.cloneQuery();d.setSortBy(es.newSort({field:c,order:b})),d.from=0,this.edge.pushQuery(d),this.edge.doQuery()},this.changeSortDir=function(){var a="asc"===this.sortDir?"desc":"asc",b=this.sortBy?this.sortBy:"_score",c=this.edge.cloneQuery();c.setSortBy(es.newSort({field:b,order:a})),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this.setSortBy=function(a){var b=this.edge.cloneQuery();a&&""!==a||(a="_score"),b.setSortBy(es.newSort({field:a,order:this.sortDir})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.setSearchField=function(a){if(this.searchField=a,this.searchString&&""!==this.searchString){var b=this.edge.cloneQuery();b.setQueryString(es.newQueryString({queryString:this.searchString,defaultField:a,defaultOperator:this.defaultOperator,fuzzify:this.fuzzify})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()}},this.setSearchText=function(a){var b=this.edge.cloneQuery();if(""!==a){var c={queryString:a,defaultOperator:this.defaultOperator,fuzzify:this.fuzzify};this.searchField&&""!==this.searchField&&(c.defaultField=this.searchField),b.setQueryString(es.newQueryString(c))}else b.removeQueryString();b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.clearSearch=function(){this.edge.reset()}},newSelectedFilters:function(a){return a||(a={}),edges.SelectedFilters.prototype=edges.newComponent(a),new edges.SelectedFilters(a)},SelectedFilters:function(a){this.fieldDisplays=edges.getParam(a.fieldDisplays,{}),this.valueMaps=edges.getParam(a.valueMaps,{}),this.valueFunctions=edges.getParam(a.valueFunctions,{}),this.rangeMaps=edges.getParam(a.rangeMaps,{}),this.rangeFunctions=edges.getParam(a.rangeFunctions,{}),this.formatUnknownRange=edges.getParam(a.formatUnknownRange,!1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newSelectedFiltersRenderer"),this.mustFilters={},this.searchString=!1,this.searchField=!1,this.synchronise=function(){if(this.mustFilters={},this.searchString=!1,this.searchField=!1,this.edge.currentQuery){for(var a=this.edge.currentQuery.listMust(),b=0;b<a.length;b++){var c=a[b];"term"===c.type_name?this._synchronise_term(c):"terms"===c.type_name?this._synchronise_terms(c):"range"===c.type_name?this._synchronise_range(c):"geo_distance_range"===c.type_name}var d=this.edge.currentQuery.getQueryString();d&&(this.searchString=d.queryString,this.searchField=d.defaultField)}},this.removeFilter=function(a,b,c,d){var e=this.edge.cloneQuery();if("term"===b){var f=es.newTermFilter({field:c,value:d});"must"===a&&e.removeMust(f)}else if("terms"===b){var f=es.newTermsFilter({field:c});if("must"===a)for(var g=e.listMust(f),h=0;h<g.length;h++)g[h].has_term(d)&&g[h].remove_term(d),g[h].has_terms()||e.removeMust(g[h])}else if("range"==b){var i={field:c};d.to&&(i.lt=d.to),d.from&&(i.gte=d.from);var f=es.newRangeFilter(i);"must"===a&&e.removeMust(f)}e.from=0,this.edge.pushQuery(e),this.edge.doQuery()},this.clearQueryString=function(){var a=this.edge.cloneQuery();a.removeQueryString(),a.from=0,this.edge.pushQuery(a),this.edge.doQuery()},this.clearSearch=function(){this.edge.reset()},this._synchronise_term=function(a){var b=this.fieldDisplays[a.field]||a.field;a.field in this.mustFilters?this.mustFilters[a.field].values.push({val:a.value,display:this._translate(a.field,a.value)}):this.mustFilters[a.field]={filter:a.type_name,display:b,values:[{val:a.value,display:this._translate(a.field,a.value)}],rel:"AND"}},this._synchronise_terms=function(a){for(var b=this.fieldDisplays[a.field]||a.field,c=[],d=0;d<a.values.length;d++){var e=a.values[d],f=this._translate(a.field,e);c.push({val:e,display:f})}this.mustFilters[a.field]={filter:a.type_name,display:b,values:c,rel:"OR"}},this._synchronise_range=function(a){var b=this.fieldDisplays[a.field]||a.field,c=a.lt;c===!1&&(c=a.lte);var d=a.gte,e=this._getRangeDef(a.field,d,c),f=[];e?f.push(e):f.push({to:c,from:d,display:this._formatUnknown(d,c)}),this.mustFilters[a.field]={filter:a.type_name,display:b,values:f}},this._translate=function(a,b){if(a in this.valueMaps){if(b in this.valueMaps[a])return this.valueMaps[a][b]}else if(a in this.valueFunctions)return this.valueFunctions[a](b);return b},this._getRangeDef=function(a,b,c){if(!this.rangeMaps[a]&&!this.rangeFunctions[a])return!1;if(this.rangeMaps[a])for(var d=0;d<this.rangeMaps[a].length;d++){var e=this.rangeMaps[a][d],f=!0,g=!0;if((b&&!e.from||!b&&e.from)&&(f=!1),(c&&!e.to||!c&&e.to)&&(g=!1),b&&e.from&&b!==e.from&&(f=!1),c&&e.to&&c!==e.to&&(g=!1),f&&g)return e}else if(this.rangeFunctions[a]){var h=this.rangeFunctions[a];return h({field:a,from:b,to:c})}return!1},this._formatUnknown=function(a,b){if(this.formatUnknownRange)return this.formatUnknownRange(a,b);if((a!==!1||b!==!1)&&a===b)return a;var c="";return c+=a!==!1?a:"< ",b!==!1?c+=a!==!1?" - "+b:b:a!==!1?c+="+":c="unknown",c}},newPager:function(a){return a||(a={}),edges.Pager.prototype=edges.newComponent(a),new edges.Pager(a)},Pager:function(a){this.defaultRenderer=a.defaultRenderer||"newPagerRenderer",this.from=!1,this.to=!1,this.total=!1,this.page=!1,this.pageSize=!1,this.totalPages=!1,this.synchronise=function(){this.from=!1,this.to=!1,this.total=!1,this.page=!1,this.pageSize=!1,this.totalPages=!1,this.edge.currentQuery&&(this.from=parseInt(this.edge.currentQuery.getFrom())+1,this.pageSize=parseInt(this.edge.currentQuery.getSize())),this.edge.result&&(this.total=this.edge.result.total()),this.from!==!1&&this.total!==!1&&(this.to=this.from+this.pageSize-1,this.page=Math.ceil((this.from-1)/this.pageSize)+1,this.totalPages=Math.ceil(this.total/this.pageSize))},this.setFrom=function(a){var b=this.edge.cloneQuery();a-=1,a<0&&(a=0),b.from=a,this.edge.pushQuery(b),this.edge.doQuery()},this.setSize=function(a){var b=this.edge.cloneQuery();b.size=a,this.edge.pushQuery(b),this.edge.doQuery()},this.decrementPage=function(){var a=this.from-this.pageSize;this.setFrom(a)},this.incrementPage=function(){var a=this.from+this.pageSize;this.setFrom(a)},this.goToPage=function(a){var b=a.page,c=(b-1)*this.pageSize+1;this.setFrom(c)}},newSearchingNotification:function(a){return a||(a={}),edges.SearchingNotification.prototype=edges.newComponent(a),new edges.SearchingNotification(a)},SearchingNotification:function(a){this.defaultRenderer=a.defaultRenderer||"newSearchingNotificationRenderer",this.searching=!1,this.init=function(a){Object.getPrototypeOf(this).init.call(this,a),a.context.on("edges:pre-query",edges.eventClosure(this,"searchingBegan")),a.context.on("edges:query-fail",edges.eventClosure(this,"searchingFinished")),a.context.on("edges:query-success",edges.eventClosure(this,"searchingFinished"))},this.draw=function(){},this.searchingBegan=function(){this.searching=!0,this.renderer.draw()},this.searchingFinished=function(){this.searching=!1,this.renderer.draw()}},newResultsDisplay:function(a){return a||(a={}),edges.ResultsDisplay.prototype=edges.newComponent(a),new edges.ResultsDisplay(a)},ResultsDisplay:function(a){this.category=a.category||"results",this.defaultRenderer=a.defaultRenderer||"newResultsDisplayRenderer",this.results=!1,this.synchronise=function(){this.results=[],this.edge.result&&(this.results=this.edge.result.results())}}}),$.extend(!0,edges,{bs3:{newNumberedPager:function(a){return a||(a={}),edges.bs3.NumberedPager.prototype=edges.newRenderer(a),new edges.bs3.NumberedPager(a)},NumberedPager:function(a){this.scroll=edges.getParam(a.scroll,!0),this.scrollSelector=edges.getParam(a.scrollSelector,"body"),this.namespace="edges-bs3-numbered-pager",this.draw=function(){if(this.component.total===!1||0===this.component.total)return void this.component.context.html("");var a=edges.css_classes(this.namespace,"container",this),b=edges.css_classes(this.namespace,"nav",this),c=edges.css_classes(this.namespace,"prev",this),d=(edges.css_classes(this.namespace,"page",this),edges.css_classes(this.namespace,"next",this)),e=edges.css_classes(this.namespace,"nav-list",this),f='<a href="#" class="'+c+'"><i class="glyphicon glyphicon-chevron-left"></i>&nbsp;Previous</a>';1===this.component.page&&(f='<span class="'+c+' disabled"><i class="glyphicon glyphicon-chevron-left"></i>&nbsp;Previous</span>'),f="<li>"+f+"</li>";var g='<a href="#" class="'+d+'">Next&nbsp;<i class="glyphicon glyphicon-chevron-right"></i></a>';this.component.page===this.component.totalPages&&(g='<span class="'+d+' disabled">Next&nbsp;<i class="glyphicon glyphicon-chevron-right"></i></a>'),g="<li>"+g+"</li>";var h="";if(this.component.totalPages<=9)for(var i=1;i<=this.component.totalPages;i++)h+="<li>"+i+"</li>";else{for(var i=1;i<=2;i++)h+=this._pageLi({pageNum:i});if(this.component.page<=5){for(var i=3;i<=7;i++)h+=this._pageLi({pageNum:i});h+="<li>...</li>";for(var i=this.component.totalPages-1;i<=this.component.totalPages;i++)h+=this._pageLi({pageNum:i})}else if(this.component.page>=this.component.totalPages-5){h+="<li>...</li>";for(var i=this.component.totalPages-6;i<=this.component.totalPages;i++)h+=this._pageLi({pageNum:i})}else{h+="<li>...</li>";for(var i=this.component.page-2;i<=this.component.page+2;i++)h+=this._pageLi({pageNum:i});h+="<li>...</li>";for(var i=this.component.totalPages-1;i<=this.component.totalPages;i++)h+=this._pageLi({pageNum:i})}}var j='<div class="'+b+'"><ul class="'+e+'">'+f+h+g+"</ul>",k='<div class="'+a+'"><div class="row"><div class="col-md-12">{{NAV}}</div></div></div>';k=k.replace(/{{NAV}}/g,j),this.component.context.html(k);var l=edges.css_class_selector(this.namespace,"prev",this),m=edges.css_class_selector(this.namespace,"next",this),n=edges.css_class_selector(this.namespace,"page",this);1!==this.component.page&&edges.on(l,"click",this,"goToPrev"),this.component.page!==this.component.totalPages&&edges.on(m,"click",this,"goToNext"),edges.on(n,"click",this,"goToPage")},this._pageLi=function(a){var b=a.pageNum,c="";if(b===this.component.page){var d=edges.css_classes(this.namespace,"current",this);c+='<li><span class="'+d+'">'+b+"</span></li>"}else{var e=edges.css_classes(this.namespace,"page",this);c+='<li><a href="#" class="'+e+'" data-page="'+b+'">'+b+"</a></li>"}return c},this.doScroll=function(){$(this.scrollSelector).animate({scrollTop:$(this.scrollSelector).offset().top},1)},this.goToPrev=function(a){this.scroll&&this.doScroll(),this.component.decrementPage()},this.goToNext=function(a){this.scroll&&this.doScroll(),this.component.incrementPage()},this.goToPage=function(a){this.scroll&&this.doScroll();var b=parseInt($(a).attr("data-page"));this.component.goToPage({page:b})}}}}),$.extend(muk,{search:{newSearchTemplate:function(a){return a||(a={}),muk.search.SearchTemplate.prototype=edges.newTemplate(a),new muk.search.SearchTemplate(a)},SearchTemplate:function(a){this.edge=!1,this.namespace="muk-search-template",this.draw=function(a){this.edge=a;for(var b=edges.css_classes(this.namespace,"container"),c=edges.css_classes(this.namespace,"search"),d=edges.css_classes(this.namespace,"facets"),e=edges.css_classes(this.namespace,"count"),f=edges.css_classes(this.namespace,"sort"),g=edges.css_classes(this.namespace,"results"),h=edges.css_classes(this.namespace,"items"),i=edges.css_classes(this.namespace,"pager"),j=edges.css_classes(this.namespace,"facet"),k=edges.css_classes(this.namespace,"searching"),l=edges.css_classes(this.namespace,"panel"),m=edges.css_classes(this.namespace,"refine"),n='<div class="'+b+'">                    <div class="row"><div class="col-md-12"><div class="'+c+'">{{SEARCH}}</div></div></div>                    <div class="row"><div class="col-md-12"><div class="'+k+'">{{SEARCHING}}</div></div></div>                    <div class="'+l+'"><div class="row">                        <div class="col-md-3"><div class="'+d+'"><div class="'+m+'">Refine</div>{{FACETS}}</div></div>                        <div class="col-md-9">                            <div class="row">                                <div class="col-md-6"><div class="'+e+'">{{RESULTCOUNT}}</div></div>                                <div class="col-md-6"><div class="'+f+'">{{SORT}}</div></div>                            </div>                            <div class="row">                                <div class="col-md-12"><div class="'+g+'">{{RESULTS}}</div></div>                            </div>                            <div class="row">                                <div class="col-md-12"><div class="'+h+'">{{ITEMSPERPAGE}}</div></div>                            </div>                            <div class="row">                                <div class="col-md-12"><div class="'+i+'">{{PAGER}}</div></div>                            </div>                        </div>                    </div></div>                </div>',o="",p=a.category("search"),q=0;q<p.length;q++)o+='<div id="'+p[q].id+'"></div>';for(var r="",s=a.category("searching-notification"),q=0;q<s.length;q++)r+='<div id="'+s[q].id+'"></div>';for(var t=a.category("facet"),u="",q=0;q<t.length;q++)u+='<div class="'+j+'"><div id="'+t[q].id+'"></div></div>';for(var v="",w=a.category("count"),q=0;q<w.length;q++)v+='<div id="'+w[q].id+'"></div>';for(var x="",y=a.category("sort"),q=0;q<y.length;q++)x+='<div id="'+y[q].id+'"></div>';for(var z="",A=a.category("results"),q=0;q<A.length;q++)z+='<div id="'+A[q].id+'"></div>';for(var B="",C=a.category("items"),q=0;q<C.length;q++)B+='<div id="'+C[q].id+'"></div>';for(var D="",E=a.category("pager"),q=0;q<E.length;q++)D+='<div id="'+E[q].id+'"></div>';n=n.replace(/{{SEARCH}}/g,o).replace(/{{SEARCHING}}/g,r).replace(/{{FACETS}}/g,u).replace(/{{RESULTCOUNT}}/g,v).replace(/{{SORT}}/g,x).replace(/{{RESULTS}}/g,z).replace(/{{ITEMSPERPAGE}}/g,B).replace(/{{PAGER}}/g,D),a.context.html(n)}},newAPCRenderer:function(a){return a||(a={}),muk.search.APCRenderer.prototype=edges.newRenderer(a),new muk.search.APCRenderer(a)},APCRenderer:function(a){this.noResultsText=edges.getParam(a.noResultsText,"No results to display"),this.namespace="muk-search-apc",this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.draw=function(){var a=this.noResultsText;this.component.results===!1&&(a="");var b=this.component.results;if(b&&b.length>0){var c=edges.css_classes(this.namespace,"record",this);a="";for(var d=0;d<b.length;d++){var e=this._renderResult(b[d]);a+='<div class="row"><div class="col-md-12"><div class="'+c+'">'+e+"</div></div></div>"}}var f=edges.css_classes(this.namespace,"container",this),g='<div class="'+f+'">'+a+"</div>";this.component.context.html(g);var h=edges.css_class_selector(this.namespace,"more-link",this);edges.on(h,"click",this,"showMore");var i=edges.css_class_selector(this.namespace,"less-link",this);edges.on(i,"click",this,"showLess")},this._renderResult=function(a){var b=edges.objVal("id",a),c=edges.css_classes(this.namespace,"title",this),d=edges.css_classes(this.namespace,"cost",this),e=edges.css_classes(this.namespace,"biblio",this),f=edges.css_classes(this.namespace,"label",this),g=edges.css_classes(this.namespace,"value",this),h=edges.css_classes(this.namespace,"more-link",this),i=edges.css_classes(this.namespace,"more-link-box",this),j=edges.css_classes(this.namespace,"less-link",this),k=edges.css_classes(this.namespace,"less-link-box",this),l=edges.css_classes(this.namespace,"more-box",this),m=edges.css_classes(this.namespace,"vat",this),n=edges.css_classes(this.namespace,"inline-label",this),o=edges.css_classes(this.namespace,"right",this),p=edges.css_classes(this.namespace,"bib-row",this),q=edges.css_classes(this.namespace,"inner-more",this),r=edges.css_classes(this.namespace,"inner-more-link",this),s=edges.css_classes(this.namespace,"inner-less-link",this),t=edges.css_id(this.namespace,"more-"+b,this),u=edges.css_id(this.namespace,"more-link-"+b,this),v=edges.css_id(this.namespace,"less-link-"+b,this),w=edges.objVal("record.dc:title",a,"Untitled"),x=edges.objVal("index.amount_inc_vat",a,!1),y=edges.objVal("record.dcterms:publisher.name",a,"Unknown"),z=edges.objVal("record.dc:source.name",a,"Unknown"),A=edges.objVal("record.jm:apc",a,[]),B=edges.objVal("record.dc:source.identifier",a,[]),C=edges.objVal("record.rioxxterms:project",a,[]),D=edges.objVal("record.ali:license_ref",a,[]);x=x!==!1?muk.toGBPIntFormat()(x):"£-";for(var E=[],F=[],G=0;G<A.length;G++){var H=edges.objVal("organisation_name",A[G],!1);H!==!1&&$.inArray(H,E)===-1&&E.push(H);for(var I=edges.objVal("fund",A[G],[]),J=0;J<I.length;J++){var K=I[J].name;K&&$.inArray(K,F)===-1&&F.push(K)}}for(var L=E.join(", "),I=F.join(", "),M=[],G=0;G<B.length;G++){var N=B[G];"issn"===N.type&&M.push(N.id)}var O="",P="10";
M.length>0&&(O='<div class="col-md-8">(<span class="'+n+'">ISSN:</span>&nbsp;<span class="'+g+'">'+edges.escapeHtml(M.join(", "))+"</span>)</div>",P="2");for(var Q=[],G=0;G<C.length;G++){var K=C[G].funder_name;K&&$.inArray(K,Q)===-1&&Q.push(K)}for(var R=Q.join(", "),S=[],G=0;G<D.length;G++){var T=D[G].type;T&&$.inArray(T,S)===-1&&S.push(T)}for(var U=S.join(", "),V='<div class="'+p+'"><div class="row">                    <div class="col-md-2"><span class="'+f+'">Publisher</span></div>                    <div class="col-md-10"><span class="'+g+'">'+edges.escapeHtml(y)+'</span></div>                </div></div>                <div class="'+p+'"><div class="row">                    <div class="col-md-2"><span class="'+f+'">Journal</span></div>                    <div class="col-md-'+P+'"><span class="'+g+'">'+edges.escapeHtml(z)+"</span></div>                    "+O+'                </div></div>                <div class="'+p+'"><div class="row">                    <div class="col-md-2"><span class="'+f+'">Organisation</span></div>                    <div class="col-md-10"><span class="'+g+'">'+edges.escapeHtml(L)+'</span></div>                </div></div>                <div class="'+p+'"><div class="row">                    <div class="col-md-2"><span class="'+f+'">Funder</span></div>                    <div class="col-md-2"><span class="'+g+'">'+edges.escapeHtml(R)+'</span></div>                    <div class="col-md-2"><span class="'+f+'">Paid from fund</span></div>                    <div class="col-md-2"><span class="'+g+'">'+edges.escapeHtml(I)+'</span></div>                    <div class="col-md-2"><span class="'+f+'">Licence</span></div>                    <div class="col-md-2"><span class="'+g+'">'+edges.escapeHtml(U)+"</span></div>                </div></div>",W="",G=0;G<A.length;G++){var X=A[G],Y=edges.objVal("organisation_name",X,"Unknown Organisation"),Z=edges.objVal("amount_inc_vat_gbp",X,!1),_=edges.objVal("date_paid",X),I=edges.objVal("fund",X,[]);Z=Z!==!1?muk.toGBPIntFormat()(Z):"Unknown Amount";for(var aa=[],J=0;J<I.length;J++){var ba=I[J],ca=edges.objVal("name",ba,"Unknown Fund");aa.push(ca)}if(_){var da=new Date(_),ea=da.getUTCDate(),fa=this.months[da.getUTCMonth()],ga=da.getUTCFullYear();_=ea+" "+fa+" "+ga}else _="Unknown Date";W+='<div class="row">                        <div class="col-md-12">                            <span class="'+g+'">'+edges.escapeHtml(Y)+'</span>                             paid                             <span class="'+g+'">'+edges.escapeHtml(Z)+'</span>                             on                             <span class="'+g+'">'+edges.escapeHtml(_)+'</span>                             from fund(s):                             <span class="'+g+'">'+edges.escapeHtml(aa.join(", "))+"</span>                         </div>                    </div>"}var ha='<div class="row">                     <div class="col-md-10"><span class="'+c+'">'+edges.escapeHtml(w)+'</span></div>                    <div class="col-md-2"><div class="'+o+'"><span class="'+d+'">'+edges.escapeHtml(x)+'</span><br>                        <span class="'+m+'">(inc VAT)</span>                    </div></div>                </div>                <div class="'+e+'"><div class="row">                     <div class="col-md-12">{{BIBLIO}}</div>                </div></div>                <div class="'+l+'" id="'+t+'"><div class="row">                     <div class="col-md-12"><div class="'+q+'">{{APCS}}</div></div>                </div></div>                <div id="'+u+'" class="'+i+'"><div class="row">                     <div class="col-md-12"><div class="'+r+'"><a href="#" class="'+h+'" data-id="'+b+'">More</a></div></div>                </div></div>                <div id="'+v+'" class="'+k+'"><div class="row">                     <div class="col-md-12"><div class="'+s+'"><a href="#" class="'+j+'" data-id="'+b+'">Less</a></div></div>                </div></div>';return ha=ha.replace(/{{BIBLIO}}/g,V).replace(/{{APCS}}/g,W)},this.showMore=function(a){var b=this.component.jq(a),c=b.attr("data-id"),d=edges.css_id_selector(this.namespace,"more-"+c,this),e=edges.css_id_selector(this.namespace,"less-link-"+c,this),f=edges.css_id_selector(this.namespace,"more-link-"+c,this);this.component.jq(f).hide(),this.component.jq(d).slideDown(200),this.component.jq(e).show()},this.showLess=function(a){var b=this.component.jq(a),c=b.attr("data-id"),d=edges.css_id_selector(this.namespace,"more-"+c,this),e=edges.css_id_selector(this.namespace,"more-link-"+c,this),f=edges.css_id_selector(this.namespace,"less-link-"+c,this);this.component.jq(f).hide(),this.component.jq(d).slideUp(200),this.component.jq(e).show()}},formatDateRange:function(a){var b=(a.field,a.from),c=a.to,d=new Date(b),e=new Date(c),f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=f[d.getUTCMonth()]+" "+d.getUTCDate()+", "+d.getUTCFullYear(),h=f[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear();return{to:c,from:b,display:"From "+g+" to "+h}},makeSearch:function(a){a||(a={});var b=edges.getParam(a.selector,"#muk_search"),c=es.newQuery();c.addSortBy(es.newSort({field:"created_date",dir:"desc"}));var d=edges.newEdge({selector:b,template:muk.search.newSearchTemplate(),search_url:octopus.config.public_query_endpoint,manageUrl:!0,openingQuery:c,components:[edges.newFullSearchController({id:"search-box",category:"search",renderer:edges.bs3.newSearchBoxRenderer({clearButton:!1,searchButton:!0,searchButtonText:"Search",searchPlaceholder:"Enter a title, journal, publisher, funder, organisation...",freetextSubmitDelay:-1})}),edges.newSelectedFilters({id:"selected-filters",category:"facet",fieldDisplays:{"record.dcterms:publisher.name.exact":"Publisher","record.dc:source.name.exact":"Journal","index.amount_inc_vat":"APC Cost","record.jm:apc.organisation_name.exact":"Institution","index.apc_count":"Multiple APCs","index.org_count":"Multiple Organisations","index.account_count":"Multiple Contributors","record.dc:source.oa_type.exact":"Journal Type","record.rioxxterms:publication_date":"Publication Date","record.jm:apc.date_applied":"APC Application","record.jm:apc.date_paid":"Date Paid"},valueMaps:{"record.dc:source.oa_type.exact":{oa:"Pure OA",hybrid:"Hybrid",unknown:"Unknown"}},rangeMaps:{"index.apc_count":[{from:2,display:"Yes"}],"index.org_count":[{from:2,display:"Yes"}],"index.account_count":[{from:2,display:"Yes"}]},rangeFunctions:{"record.rioxxterms:publication_date":muk.search.formatDateRange,"record.jm:apc.date_applied":muk.search.formatDateRange,"record.jm:apc.date_paid":muk.search.formatDateRange},renderer:edges.bs3.newCompactSelectedFiltersRenderer({header:"Refined by",openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newORTermSelector({id:"journal",field:"record.dc:source.name.exact",display:"Journal",size:1e4,category:"facet",lifecycle:"update",renderer:edges.bs3.newORTermSelectorRenderer({showCount:!0,hideEmpty:!0,openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newORTermSelector({id:"organisation",field:"record.jm:apc.organisation_name.exact",display:"Institution",size:500,category:"facet",lifecycle:"update",renderer:edges.bs3.newORTermSelectorRenderer({showCount:!0,hideEmpty:!0,openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newNumericRangeEntry({id:"apc_cost",field:"index.amount_inc_vat",display:"APC Cost",category:"facet",increment:500,renderer:edges.bs3.newNumericRangeEntryRenderer({openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newORTermSelector({id:"oa_type",field:"record.dc:source.oa_type.exact",display:"Journal Type",category:"facet",lifecycle:"update",valueMap:{oa:"Pure OA",hybrid:"Hybrid",unknown:"Unknown"},renderer:edges.bs3.newORTermSelectorRenderer({showCount:!0,hideEmpty:!1,openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newMultiDateRangeEntry({id:"date_range",category:"facet",display:"Date",fields:[{field:"record.rioxxterms:publication_date",display:"Publication Date"},{field:"record.jm:apc.date_applied",display:"APC Application"},{field:"record.jm:apc.date_paid",display:"APC Paid"}],autoLookupRange:!0,renderer:edges.bs3.newBSMultiDateRangeFacet({openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",prefix:"Show records where",ranges:muk.yearRanges({"academic year":"09-01","fiscal year":"04-01","calendar year":"01-01"},{"This ":0,"Last ":1}),open:!0})}),edges.newFilterSetter({id:"deduplicate",category:"facet",aggregations:[es.newRangeAggregation({name:"apc_count",field:"index.apc_count",ranges:[{from:2}]}),es.newRangeAggregation({name:"org_count",field:"index.org_count",ranges:[{from:2}]}),es.newRangeAggregation({name:"account_count",field:"index.account_count",ranges:[{from:2}]})],filters:[{id:"multiple_apcs",display:"More than one APC has been paid (by anyone)",must:[es.newRangeFilter({field:"index.apc_count",gte:2})],agg_name:"apc_count",bucket_field:"from",bucket_value:2},{id:"multiple_orgs",display:"More than one organisation has paid an APC",must:[es.newRangeFilter({field:"index.org_count",gte:2})],agg_name:"org_count",bucket_field:"from",bucket_value:2},{id:"multiple_accs",display:"More than one user account has reported an APC payment",must:[es.newRangeFilter({field:"index.account_count",gte:2})],agg_name:"account_count",bucket_field:"from",bucket_value:2}],renderer:edges.bs3.newFacetFilterSetterRenderer({facetTitle:"Search for duplicates",intro:"Show records where:",openIcon:"glyphicon glyphicon-chevron-down",closeIcon:"glyphicon glyphicon-chevron-up",layout:"right",open:!0})}),edges.newPager({id:"result-count",category:"count",renderer:edges.bs3.newResultCountRenderer({prefix:"Results (",suffix:")"})}),edges.newFullSearchController({id:"sort-box",category:"sort",sortOptions:[{field:"record.dc:title.exact",dir:"asc",display:"Title (A-Z)"},{field:"record.dc:title.exact",dir:"desc",display:"Title (Z-A)"},{field:"index.amount_inc_vat",dir:"asc",display:"APC Cost (Low - High)"},{field:"index.amount_inc_vat",dir:"desc",display:"APC Cost (High - Low)"},{field:"created_date",dir:"desc",display:"Most recent"}],renderer:edges.bs3.newSortRenderer({prefix:"Sort: ",dirSwitcher:!1})}),edges.newPager({id:"results-size",category:"pager",renderer:edges.bs3.newPagerRenderer({showRecordCount:!1,showPageNavigation:!1,sizePrefix:"Show ",sizeSuffix:"&nbsp;&nbsp;&nbsp;&nbsp;items per page"})}),edges.newPager({id:"page-navigation",category:"pager",renderer:edges.bs3.newNumberedPager({})}),edges.newSearchingNotification({id:"searching-notification",category:"searching-notification"}),edges.newResultsDisplay({id:"results",category:"results",renderer:muk.search.newAPCRenderer({})})]});muk.activeEdges[b]=d}}}),$.extend(!0,edges,{bs3:{newResultCountRenderer:function(a){return a||(a={}),edges.bs3.ResultCountRenderer.prototype=edges.newRenderer(a),new edges.bs3.ResultCountRenderer(a)},ResultCountRenderer:function(a){this.prefix=edges.getParam(a.prefix,""),this.suffix=edges.getParam(a.suffix,""),this.namespace="edges-bs3-result-count",this.draw=function(){var a=edges.css_classes(this.namespace,"container",this),b=edges.css_classes(this.namespace,"total",this),c=edges.css_classes(this.namespace,"prefix",this),d=edges.css_classes(this.namespace,"suffix",this),e=this.component.total;e||(e=0);var f='<span class="'+c+'">'+this.prefix+'</span><span class="'+b+'">'+e+'</span><span class="'+d+'">'+this.suffix+"</span>",g='<div class="'+a+'"><div class="row"><div class="col-md-12">{{COUNT}}</div></div></div>';g=g.replace(/{{COUNT}}/g,f),this.component.context.html(g)}}}}),$.extend(edges,{newRefiningANDTermSelector:function(a){return a||(a={}),edges.RefiningANDTermSelector.prototype=edges.newSelector(a),new edges.RefiningANDTermSelector(a)},RefiningANDTermSelector:function(a){this.size=a.size||10,this.orderBy=a.orderBy||"count",this.orderDir=a.orderDir||"desc",this.deactivateThreshold=a.deactivateThreshold||!1,this.ignoreEmptyString=a.ignoreEmptyString||!0,this.excludePreDefinedFilters=a.excludePreDefinedFilters||!0,this.valueMap=a.valueMap||!1,this.valueFunction=a.valueFunction||!1,this.inflation=a.inflation||100,this.defaultRenderer=a.defaultRenderer||"newRefiningANDTermSelectorRenderer",this.filters=[],this.values=!1,this.contrib=function(a){var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir};this.size&&(b.size=this.size),a.addAggregation(es.newTermsAggregation(b))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result){var a=this.edge.result.buckets(this.id);a.length<this.deactivateThreshold?this.active=!1:this.active=!0;var b=[];this.excludePreDefinedFilters&&this.edge.baseQuery&&(b=this.edge.baseQuery.listMust(es.TermFilter({field:this.field})));for(var c=0,d=0;d<a.length;d++){var e=a[d];if(!this.ignoreEmptyString||""!==e.key){if(this.excludePreDefinedFilters){for(var f=!1,g=0;g<b.length;g++){var h=b[g];if(e.key===h.value){f=!0;break}}if(f)continue}if(c++,c>this.size)break;var i=this._translate(e.key),j={display:i,term:e.key,count:e.doc_count};this.values.push(j)}}}for(var k=this.edge.currentQuery.listMust(es.newTermFilter({field:this.field})),d=0;d<k.length;d++){var l=k[d].value;l=this._translate(l),this.filters.push({display:l,term:k[d].value})}},this.selectTerm=function(a){var b=this.edge.cloneQuery(),c=b.removeMust(es.newTermFilter({field:this.field,value:a}));return!(c>0)&&(b.addMust(es.newTermFilter({field:this.field,value:a})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery(),!0)},this.removeFilter=function(a){var b=this.edge.cloneQuery();b.removeMust(es.newTermFilter({field:this.field,value:a})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.changeSize=function(a){this.size=a;var b=this.edge.cloneQuery(),c=b.getAggregation({name:this.id});c.size=this.size,this.edge.pushQuery(b),this.edge.doQuery()},this.changeSort=function(a,b){this.orderBy=a,this.orderDir=b;var c=this.edge.cloneQuery(),d=c.getAggregation({name:this.id});d.setOrdering(this.orderBy,this.orderDir),this.edge.pushQuery(c),this.edge.doQuery()},this._translate=function(a){if(this.valueMap){if(a in this.valueMap)return this.valueMap[a]}else if(this.valueFunction)return this.valueFunction(a);return a}},newORTermSelector:function(a){return a||(a={}),edges.ORTermSelector.prototype=edges.newSelector(a),new edges.ORTermSelector(a)},ORTermSelector:function(a){this.lifecycle=edges.getParam(a.lifecycle,"static"),this.orderBy=edges.getParam(a.orderBy,"term"),this.orderDir=edges.getParam(a.orderDir,"asc"),this.size=edges.getParam(a.size,10),this.valueMap=edges.getParam(a.valueMap,!1),this.valueFunction=edges.getParam(a.valueFunction,!1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newORTermSelectorRenderer"),this.terms=edges.getParam(a.terms,!1),this.selected=[],this.updating=!1,this.init=function(a){edges.newSelector().init.call(this,a),this.terms||this.listAll()},this.synchronise=function(){this.selected=[];for(var a=this.edge.currentQuery.listMust(es.newTermsFilter({field:this.field})),b=0;b<a.length;b++)for(var c=0;c<a[b].values.length;c++){var d=a[b].values[c];this.selected.push(d)}},this.listAll=function(){var a=this.edge.cloneBaseQuery();a.clearAggregations(),a.size=0;var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};a.addAggregation(es.newTermsAggregation(b)),es.doQuery({search_url:this.edge.search_url,queryobj:a.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"listAllQuerySuccess",["result"]),error:edges.objClosure(this,"listAllQueryFail")})},this.listAllQuerySuccess=function(a){var b=a.result;this.terms=[];for(var c=b.buckets(this.id),d=0;d<c.length;d++){var e=c[d];this.terms.push({term:e.key,display:this._translate(e.key),count:e.doc_count})}this.setupEvent(),this.draw()},this.listAllQueryFail=function(){this.terms=[]},this.setupEvent=function(){"update"===this.lifecycle&&this.edge.context.on("edges:pre-query",edges.eventClosure(this,"doUpdate"))},this.doUpdate=function(){if(!this.updating){this.udpating=!0;var a=this.edge.cloneQuery();a.removeMust(es.newTermsFilter({field:this.field})),a.clearAggregations(),a.size=0;var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};a.addAggregation(es.newTermsAggregation(b)),es.doQuery({search_url:this.edge.search_url,queryobj:a.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"doUpdateQuerySuccess",["result"]),error:edges.objClosure(this,"doUpdateQueryFail")})}},this.doUpdateQuerySuccess=function(a){for(var b=a.result,c=b.buckets(this.id),d=0;d<this.terms.length;d++){for(var e=this.terms[d],f=!1,g=0;g<c.length;g++){var h=c[g];if(e.term===h.key){e.count=h.doc_count,f=!0;break}}f||(e.count=0)}this.updating=!1,this.draw()},this.doUpdateQueryFail=function(){},this.selectTerms=function(a){var b=a.terms,c=edges.getParam(a.clearOthers,!1),d=this.edge.cloneQuery(),e=d.listMust(es.newTermsFilter({field:this.field}));if(e.length>0){var f=e[0];c&&f.clear_terms();for(var g=0,h=0;h<b.length;h++){var i=b[h];f.has_term(i)?g++:f.add_term(i)}if(f.has_terms()&&g==b.length)return!1;f.has_terms()||d.removeMust(es.newTermsFilter({field:this.field}))}else d.addMust(es.newTermsFilter({field:this.field,values:b}));return d.from=0,this.edge.pushQuery(d),this.edge.doQuery(),!0},this.selectTerm=function(a){return this.selectTerms({terms:[a]})},this.removeFilter=function(a){var b=this.edge.cloneQuery(),c=b.listMust(es.newTermsFilter({field:this.field}));if(c.length>0){var d=c[0];d.has_term(a)&&d.remove_term(a),d.has_terms()||b.removeMust(es.newTermsFilter({field:this.field}))}b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this._translate=function(a){if(this.valueMap){if(a in this.valueMap)return this.valueMap[a]}else if(this.valueFunction)return this.valueFunction(a);return a}},newBasicRangeSelector:function(a){return a||(a={}),edges.BasicRangeSelector.prototype=edges.newSelector(a),new edges.BasicRangeSelector(a)},BasicRangeSelector:function(a){this.ranges=a.ranges||[],this.formatUnknown=a.formatUnknown||!1,this.defaultRenderer=a.defaultRenderer||"newBasicRangeSelectorRenderer",this.values=[],this.filters=[],this.contrib=function(a){for(var b=[],c=0;c<this.ranges.length;c++){var d=this.ranges[c],e={};d.from&&(e.from=d.from),d.to&&(e.to=d.to),b.push(e)}a.addAggregation(es.newRangeAggregation({name:this.id,field:this.field,ranges:b}))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result)for(var a=this.edge.result.buckets(this.id),b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=this._getRangeBucket(a,c.from,c.to),e=$.extend(!0,{},c);e.count=d.doc_count,this.values.push(e)}if(this.edge.currentQuery)for(var f=this.edge.currentQuery.listMust(es.newRangeFilter({field:this.field})),b=0;b<f.length;b++){var g=f[b].lt,h=f[b].gte,c=this._getRangeDef(h,g);c?this.filters.push(c):this.filters.push({display:this._formatUnknown(h,g),from:h,to:g})}},this.selectRange=function(a,b){var c=this.edge.cloneQuery(),d={field:this.field};a&&(d.gte=a),b&&(d.lt=b),c.addMust(es.newRangeFilter(d)),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this.removeFilter=function(a,b){var c=this.edge.cloneQuery(),d={field:this.field};a&&(d.gte=a),b&&(d.lt=b),c.removeMust(es.newRangeFilter(d)),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this._getRangeDef=function(a,b){for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c],e=!0,f=!0;if((a&&!d.from||!a&&d.from)&&(e=!1),(b&&!d.to||!b&&d.to)&&(f=!1),a&&d.from&&a!==d.from&&(e=!1),b&&d.to&&b!==d.to&&(f=!1),e&&f)return d}return!1},this._getRangeBucket=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d],f=!0,g=!0;if((b&&!e.from||!b&&e.from)&&(f=!1),(c&&!e.to||!c&&e.to)&&(g=!1),b&&e.from&&b!==e.from&&(f=!1),c&&e.to&&c!==e.to&&(g=!1),f&&g)return e}return!1},this._formatUnknown=function(a,b){if(this.formatUnknown)return this.formatUnknown(a,b);var c="";return c+=a?a:"< ",b?c+=a?" - "+b:b:a?c+="+":c="unknown",c}},newBasicGeoDistanceRangeSelector:function(a){return a||(a={}),edges.BasicGeoDistanceRangeSelector.prototype=edges.newSelector(a),new edges.BasicGeoDistanceRangeSelector(a)},BasicGeoDistanceRangeSelector:function(a){this.distances=a.distances||[],this.hideEmptyDistance=a.hideEmptyDistance||!0,this.unit=a.unit||"m",this.lat=a.lat||!1,this.lon=a.lon||!1,this.values=[],this.synchronise=function(){this.values=[]}},newDateHistogramSelector:function(a){return a||(a={}),edges.BasicRangeSelector.prototype=edges.newSelector(a),new edges.BasicRangeSelector(a)},DateHistogramSelector:function(a){this.interval=a.interval||"year",this.sort=a.sort||"asc",this.hideEmptyDateBin=a.hideEmptyDateBin||!0,this.shortDisplay=a.shortDisplay||!1,this.values=[],this.synchronise=function(){this.values=[]}},newAutocompleteTermSelector:function(a){return a||(a={}),edges.AutocompleteTermSelector.prototype=edges.newComponent(a),new edges.AutocompleteTermSelector(a)},AutocompleteTermSelector:function(a){this.defaultRenderer=a.defaultRenderer||"newAutocompleteTermSelectorRenderer"}}),$.extend(!0,edges,{bs3:{newPagerRenderer:function(a){return a||(a={}),edges.bs3.PagerRenderer.prototype=edges.newRenderer(a),new edges.bs3.PagerRenderer(a)},PagerRenderer:function(a){this.scroll=edges.getParam(a.scroll,!0),this.scrollSelector=edges.getParam(a.scrollSelector,"body"),this.showSizeSelector=edges.getParam(a.showSizeSelector,!0),this.sizeOptions=edges.getParam(a.sizeOptions,[10,25,50,100]),this.sizePrefix=edges.getParam(a.sizePrefix,""),this.sizeSuffix=edges.getParam(a.sizeSuffix," per page"),this.showRecordCount=edges.getParam(a.showRecordCount,!0),this.showPageNavigation=edges.getParam(a.showPageNavigation,!0),this.namespace="edges-bs3-pager",this.draw=function(){if(this.component.total===!1||0===this.component.total)return void this.component.context.html("");var a=edges.css_classes(this.namespace,"container",this),b=edges.css_classes(this.namespace,"total",this),c=edges.css_classes(this.namespace,"nav",this),d=edges.css_classes(this.namespace,"first",this),e=edges.css_classes(this.namespace,"prev",this),f=edges.css_classes(this.namespace,"page",this),g=edges.css_classes(this.namespace,"next",this),h=edges.css_classes(this.namespace,"size",this),i="";this.showRecordCount&&(i='<span class="'+b+'">'+this.component.total+"</span> results found");var j="";if(this.showSizeSelector){var j='<div class="form-inline">'+i+this.sizePrefix+'<div class="form-group"><select class="form-control input-sm '+h+'" name="'+this.component.id+'-page-size">{{SIZES}}</select></div>'+this.sizeSuffix+"</div>",k="",l=this.sizeOptions.slice(0);$.inArray(this.component.pageSize,l)===-1&&l.push(this.component.pageSize),l.sort(function(a,b){return a-b});for(var m=0;m<l.length;m++){var n=l[m],o="";n===this.component.pageSize&&(o="selected='selected'"),k+='<option name="'+n+'" '+o+">"+n+"</option>"}j=j.replace(/{{SIZES}}/g,k)}var p="";if(this.showPageNavigation){var q='<a href="#" class="'+d+'">First</a>',r='<a href="#" class="'+e+'">Prev</a>';1===this.component.page&&(q='<span class="'+d+' disabled">First</span>',r='<span class="'+e+' disabled">Prev</span>');var s='<a href="#" class="'+g+'">Next</a>';this.component.page===this.component.totalPages&&(s='<span class="'+g+' disabled">Next</a>'),p='<div class="'+c+'">'+q+r+'<span class="'+f+'">Page '+this.component.page+" of "+this.component.totalPages+"</span>"+s+"</div>"}var t="";if(t=this.showSizeSelector&&!this.showPageNavigation?'<div class="'+a+'"><div class="row"><div class="col-md-12">{{COUNT}}</div></div></div>':!this.showSizeSelector&&this.showPageNavigation?'<div class="'+a+'"><div class="row"><div class="col-md-12">{{NAV}}</div></div></div>':'<div class="'+a+'"><div class="row"><div class="col-md-6">{{COUNT}}</div><div class="col-md-6">{{NAV}}</div></div></div>',t=t.replace(/{{COUNT}}/g,j).replace(/{{NAV}}/g,p),this.component.context.html(t),this.showPageNavigation){var u=edges.css_class_selector(this.namespace,"first",this),v=edges.css_class_selector(this.namespace,"prev",this),w=edges.css_class_selector(this.namespace,"next",this);1!==this.component.page&&(edges.on(u,"click",this,"goToFirst"),edges.on(v,"click",this,"goToPrev")),this.component.page!==this.component.totalPages&&edges.on(w,"click",this,"goToNext")}if(this.showSizeSelector){var x=edges.css_class_selector(this.namespace,"size",this);edges.on(x,"change",this,"changeSize")}},this.doScroll=function(){$(this.scrollSelector).animate({scrollTop:$(this.scrollSelector).offset().top},1)},this.goToFirst=function(a){this.scroll&&this.doScroll(),this.component.setFrom(1)},this.goToPrev=function(a){this.scroll&&this.doScroll(),this.component.decrementPage()},this.goToNext=function(a){this.scroll&&this.doScroll(),this.component.incrementPage()},this.changeSize=function(a){var b=$(a).val();this.component.setSize(b)}}}}),$.extend(!0,edges,{bs3:{newCompactSelectedFiltersRenderer:function(a){return a||(a={}),edges.bs3.CompactSelectedFiltersRenderer.prototype=edges.newRenderer(a),new edges.bs3.CompactSelectedFiltersRenderer(a)},CompactSelectedFiltersRenderer:function(a){this.showFilterField=edges.getParam(a.showFilterField,!0),this.header=edges.getParam(a.header,"Active Filters"),this.togglable=edges.getParam(a.togglable,!0),this.open=edges.getParam(a.open,!1),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.truncateSearchDisplay=edges.getParam(a.truncateSearchDisplay,100),this.namespace="edges-bs3-compact-selected-filters",this.draw=function(){for(var a=this.component,b=this.namespace,c=edges.css_classes(b,"facet",this),d=edges.css_classes(b,"header",this),e=edges.css_classes(b,"field",this),f=edges.css_classes(b,"filter-box",this),g=edges.css_classes(b,"value",this),h=edges.css_classes(b,"remove",this),i=edges.css_classes(b,"filters",this),j=edges.css_classes(b,"search-text",this),k=edges.css_classes(b,"body",this),l=edges.css_classes(b,"text",this),m=edges.css_classes(b,"label",this),n=edges.css_classes(b,"search-clear",this),o=edges.css_classes(b,"clear-all",this),p=edges.css_id(b,"toggle",this),q=edges.css_id(b,"body",this),r="",s=Object.keys(a.mustFilters),t=0;t<s.length;t++){var u=s[t],v=a.mustFilters[u];r+='<div class="'+e+'">',this.showFilterField&&(r+='<span class="'+m+'">'+v.display+":</span><br>");for(var w=0;w<v.values.length;w++){var x=v.values[w];if(r+='<div class="'+f+'"><span class="'+g+'">'+x.display+"</span>","term"==v.filter||"terms"===v.filter)r+='<a class="'+h+'" data-bool="must" data-filter="'+v.filter+'" data-field="'+u+'" data-value="'+x.val+'" alt="Remove" title="Remove" href="#">',r+='<i class="glyphicon glyphicon-black glyphicon-remove"></i>',r+="</a>";else if("range"===v.filter){var y=x.from?' data-from="'+x.from+'" ':"",z=x.to?' data-to="'+x.to+'" ':"";r+='<a class="'+h+'" data-bool="must" data-filter="'+v.filter+'" data-field="'+u+'" '+y+z+' alt="Remove" title="Remove" href="#">',r+='<i class="glyphicon glyphicon-black glyphicon-remove"></i>',r+="</a>"}r+="</div>"}r+="</div>"}var A=this.headerLayout({toggleId:p}),B="";""!==r&&(B='<div class="'+i+'">{{FILTERS}}</div>',B=B.replace(/{{FILTERS}}/g,r));var C="";if(this.component.searchString!==!1){var D=this.component.searchString;D.length>this.truncateSearchDisplay+3&&(D=D.substring(0,this.truncateSearchDisplay)+"..."),C='<div class="'+j+'">                        <span class="'+m+'">Search:</span><br>                        <div class="'+l+'"><div class="row">                            <div class="col-md-10">'+D+'</div>                            <div class="col-md-2"><a href="#" class="'+n+'"><i class="glyphicon glyphicon-black glyphicon-remove"></i></a></div>                        </div></div>                    </div>'}var E='<div class="row"><div class="col-md-12"><a href="#" class="'+o+'">clear all</a></div></div>';""===C&&""===B&&(C="No filters set",E="");var F='<div class="'+c+'">                    <div class="'+d+'"><div class="row">                         <div class="col-md-12">                            '+A+'                        </div>                    </div></div>                    <div class="'+k+'">                        <div class="row" style="display:none" id="'+q+'">                            <div class="col-md-12">                                '+C+"                                "+B+"                                "+E+"                            </div>                        </div>                    </div>                </div>";a.context.html(F),this.setUIOpen();var G=edges.css_class_selector(b,"remove",this);edges.on(G,"click",this,"removeFilter");var H=edges.css_id_selector(b,"toggle",this);edges.on(H,"click",this,"toggleOpen");var I=edges.css_class_selector(b,"search-clear",this);edges.on(I,"click",this,"clearSearch");var J=edges.css_class_selector(b,"clear-all",this);edges.on(J,"click",this,"clearAll")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d=this.header;return this.togglable&&(d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+d+"</a>"),d}if("right"===this.layout){var d="";return d=this.togglable?'<a href="#" id="'+b+'">'+this.header+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>':this.header}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"body",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.removeFilter=function(a){var b=this.component.jq(a),c=b.attr("data-field"),d=b.attr("data-filter"),e=b.attr("data-bool"),f=!1;if("terms"===d||"term"===d)f=b.attr("data-value");else if("range"===d){f={};var g=b.attr("data-from"),h=b.attr("data-to");g&&(f.from=parseInt(g)),h&&(f.to=parseInt(h))}this.component.removeFilter(e,d,c,f)},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this.clearSearch=function(a){this.component.clearQueryString()},this.clearAll=function(a){this.component.clearSearch()}}}}),$.extend(!0,edges,{bs3:{newORTermSelectorRenderer:function(a){return a||(a={}),edges.bs3.ORTermSelectorRenderer.prototype=edges.newRenderer(a),new edges.bs3.ORTermSelectorRenderer(a)},ORTermSelectorRenderer:function(a){this.open=edges.getParam(a.open,!1),this.togglable=edges.getParam(a.togglable,!0),this.showCount=edges.getParam(a.showCount,!1),this.hideEmpty=edges.getParam(a.hideEmpty,!1),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.namespace="edges-bs3-or-term-selector",this.draw=function(){var a=this.component,b=this.namespace,c=edges.css_classes(b,"result",this),d=edges.css_classes(b,"value",this),e=edges.css_classes(b,"filter-remove",this),f=edges.css_classes(b,"facet",this),g=edges.css_classes(b,"header",this),h=edges.css_classes(b,"selections",this),i=edges.css_classes(b,"body",this),j=edges.css_classes(b,"count",this),k=edges.css_id(b,"toggle",this),l=edges.css_id(b,"results",this),m="Loading...";if(a.terms.length>0){m="";for(var n=0;n<a.terms.length;n++){var o=a.terms[n];0===o.count&&this.hideEmpty||($.inArray(o.term.toString(),a.selected)!==-1?(m+='<div class="form '+c+'"><div class="form-fields__item-checkbox '+e+'" data-key="'+edges.escapeHtml(o.term)+'"><label><input type="checkbox" checked/> '+edges.escapeHtml(o.display),
this.showCount&&(m+=' <span class="'+j+'">('+o.count+")</span>"),m+="</label></div></div>"):(m+='<div class="form '+c+'"><div class="form-fields__item-checkbox '+d+'" data-key="'+edges.escapeHtml(o.term)+'"><label><input type="checkbox" /> '+edges.escapeHtml(o.display),this.showCount&&(m+=' <span class="'+j+'">('+o.count+")</span>"),m+="</label></div></div>"))}}var p=this.headerLayout({toggleId:k}),q='<div class="'+f+'"><div class="'+g+'"><div class="row"><div class="col-md-12">'+p+'</div></div></div><div class="'+i+'"><div class="row" style="display:none" id="'+l+'"><div class="col-md-12"><div class="'+h+'">{{RESULTS}}</div></div></div></div></div>';q=q.replace(/{{RESULTS}}/g,m),a.context.html(q),this.setUIOpen();var r=edges.css_class_selector(b,"value",this),s=edges.css_class_selector(b,"filter-remove",this),t=edges.css_id_selector(b,"toggle",this);edges.on(r,"click",this,"termSelected"),edges.on(t,"click",this,"toggleOpen"),edges.on(s,"click",this,"removeFilter")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d=this.component.display;return this.togglable&&(d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+d+"</a>"),d}if("right"===this.layout){var d="";return d=this.togglable?'<a href="#" id="'+b+'">'+this.component.display+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>':this.component.display}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"results",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.termSelected=function(a){var b=this.component.jq(a).attr("data-key");this.component.selectTerm(b)},this.removeFilter=function(a){var b=this.component.jq(a).attr("data-key");this.component.removeFilter(b)},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this._getFilterDef=function(a){for(var b=0;b<this.component.terms.length;b++){var c=this.component.terms[b];if(a===c.term)return c}return!1}}}}),$.extend(!0,edges,{bs3:{newNumericRangeEntryRenderer:function(a){return a||(a={}),edges.bs3.NumericRangeEntryRenderer.prototype=edges.newRenderer(a),new edges.bs3.NumericRangeEntryRenderer(a)},NumericRangeEntryRenderer:function(a){this.open=edges.getParam(a.open,!1),this.fromText=edges.getParam(a.fromText,"From"),this.toText=edges.getParam(a.toText,"To"),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.namespace="edges-bs3-numeric-range-entry",this.draw=function(){for(var a=edges.css_classes(this.namespace,"facet",this),b=edges.css_classes(this.namespace,"header",this),c=edges.css_classes(this.namespace,"label",this),d=edges.css_classes(this.namespace,"select",this),e=edges.css_classes(this.namespace,"body",this),f=edges.css_id(this.namespace,"toggle",this),g=edges.css_id(this.namespace,"form",this),h=edges.css_id(this.namespace,"from",this),i=edges.css_id(this.namespace,"to",this),j="",k=[],l=this.component.lower===!1?0:this.component.lower,m=this.component.upper===!1?0:this.component.upper,n=l;n<m;n+=this.component.increment)k.push(n);k.push(m);for(var o="",n=0;n<k.length;n++)o+='<option value="'+k[n]+'">'+k[n]+"</option>";j+='<div class="row"><div class="col-md-4"><span class="'+c+'">'+this.fromText+"</span></div>",j+='<div class="col-md-8"><select name="'+h+'" id="'+h+'" class="form-control '+d+'">'+o+"</select></div>",j+="</div>",j+='<div class="row"><div class="col-md-4"><span class="'+c+'">'+this.toText+"</span></div>",j+='<div class="col-md-8"><select name="'+i+'" id="'+i+'" class="form-control '+d+'">'+o+"</select></div>",j+="</div></div>";var p=this.headerLayout({toggleId:f}),q='<div class="'+a+'">                    <div class="'+b+'"><div class="row">                         <div class="col-md-12">                            '+p+'                        </div>                    </div></div>                    <div class="'+e+'">                        <div class="row" style="display:none" id="'+g+'">                            <div class="col-md-12">                                <form>{{THEFORM}}</form>                            </div>                        </div>                    </div>                </div>';q=q.replace(/{{THEFORM}}/g,j),this.component.context.html(q),this.setUIFrom(),this.setUITo(),this.setUIOpen();var r=edges.css_id_selector(this.namespace,"from",this),s=edges.css_id_selector(this.namespace,"to",this),t=edges.css_id_selector(this.namespace,"toggle",this);edges.on(r,"change",this,"fromChanged"),edges.on(s,"change",this,"toChanged"),edges.on(t,"click",this,"toggleOpen")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+this.component.display+"</a>";return d}if("right"===this.layout){var d='<a href="#" id="'+b+'">'+this.component.display+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>';return d}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"form",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.setUIFrom=function(){if(this.component.from){var a=edges.css_id_selector(this.namespace,"from",this),b=this.component.jq(a);b.val(this.component.from)}},this.setUITo=function(){if(this.component.to){var a=edges.css_id_selector(this.namespace,"to",this),b=this.component.jq(a);b.val(this.component.to)}},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this.fromChanged=function(a){var b=parseInt($(a).val()),c=edges.css_id_selector(this.namespace,"to",this),d=this.component.jq(c),e=parseInt(d.val());b>e&&(e=b,d.val(b)),this.component.selectRange(b,e)},this.toChanged=function(a){var b=parseInt($(a).val()),c=edges.css_id_selector(this.namespace,"from",this),d=this.component.jq(c),e=parseInt(d.val());b<e&&(e=b,d.val(b)),this.component.selectRange(e,b)}}}}),$.extend(!0,edges,{bs3:{newBSMultiDateRangeFacet:function(a){return a||(a={}),edges.bs3.BSMultiDateRangeFacet.prototype=edges.newRenderer(a),new edges.bs3.BSMultiDateRangeFacet(a)},BSMultiDateRangeFacet:function(a){this.open=edges.getParam(a.open,!1),this.togglable=edges.getParam(a.togglable,!0),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.dateFormat=edges.getParam(a.dateFormat,"MMMM D, YYYY"),this.useSelect2=edges.getParam(a.useSelect2,!1),this.ranges=edges.getParam(a.ranges,!1),this.prefix=edges.getParam(a.prefix,""),this.dre=!1,this.selectId=!1,this.rangeId=!1,this.selectJq=!1,this.rangeJq=!1,this.drp=!1,this.namespace="edges-bs3-bs-multi-date-range-facet",this.draw=function(){var a=this.component,b=edges.css_classes(this.namespace,"select",this),c=edges.css_classes(this.namespace,"input",this),d=edges.css_classes(this.namespace,"prefix",this),e=edges.css_classes(this.namespace,"facet",this),f=edges.css_classes(this.namespace,"header",this),g=edges.css_classes(this.namespace,"body",this),h=edges.css_id(this.namespace,"toggle",this),i=edges.css_id(this.namespace,"form",this),j=edges.css_id(this.namespace,"range",this),k=edges.css_id(this.namespace,a.id+"_plugin",this);this.selectId=edges.css_id(this.namespace,a.id+"_date-type",this),this.rangeId=edges.css_id(this.namespace,a.id+"_range",this);for(var l="",m=0;m<a.fields.length;m++){var n=a.fields[m],o=a.currentField==n.field?' selected="selected" ':"";l+='<option value="'+n.field+'"'+o+">"+n.display+"</option>"}var p='<div class="form-inline">';a.display&&(p+='<span class="'+d+'">'+this.prefix+"</span>"),p+='<div class="form-group"><select class="'+b+' form-control input-sm" name="'+this.selectId+'" id="'+this.selectId+'">'+l+"</select></div>",p+='<div id="'+this.rangeId+'" class="'+c+'">                    <div class="row"><div class="col-md-1"><i class="glyphicon glyphicon-calendar"></i></div>                    <div class="col-md-9"><div id="'+j+'"></div></div>                    <div class="col-md-1"><b class="caret"></b></div></div>                </div>',p+="</div>";var q=this.headerLayout({toggleId:h}),r='<div class="'+e+'">                    <div class="'+f+'"><div class="row">                         <div class="col-md-12">                            '+q+'                        </div>                    </div></div>                    <div class="'+g+'">                        <div class="row" style="display:none" id="'+i+'">                            <div class="col-md-12">                                {{FORM}}                            </div>                        </div>                    </div>                    </div></div>';r=r.replace(/{{FORM}}/g,p),a.context.html(r),this.setUIOpen();var s=edges.css_id_selector(this.namespace,"toggle",this);edges.on(s,"click",this,"toggleOpen");var t=edges.css_id_selector(this.namespace,a.id+"_date-type",this),u=edges.css_id_selector(this.namespace,a.id+"_range",this);this.selectJq=a.jq(t),this.rangeJq=a.jq(u);var v=edges.objClosure(this,"updateDateRange",["start","end"]),w={locale:{format:"DD/MM/YYYY"},opens:"right"};this.ranges&&(w.ranges=this.ranges);var x=edges.css_id_selector(this.namespace,a.id+"_plugin",this);$(x).remove(),this.rangeJq.daterangepicker(w,v),this.drp=this.rangeJq.data("daterangepicker"),this.drp.container.attr("id",k).addClass("show-calendar"),this.prepDates(),this.useSelect2&&this.selectJq.select2(),edges.on(t,"change",this,"typeChanged")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d=this.component.display;return this.togglable&&(d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+d+"</a>"),d}if("right"===this.layout){var d="";return d=this.togglable?'<a href="#" id="'+b+'">'+this.component.display+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>':this.component.display}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"form",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this.dateRangeDisplay=function(a){var b=a.start,c=a.end,d=edges.css_id_selector(this.namespace,"range",this);this.rangeJq.find(d).html("<strong>From</strong>: "+b.utc().format(this.dateFormat)+"<br><strong>To</strong>: "+c.utc().format(this.dateFormat))},this.updateDateRange=function(a){var b=a.start,c=a.end,d=null;d=this.useSelect2?this.selectJq.select2("val"):this.selectJq.val(),this.component.changeField(d),this.component.setFrom(b.toDate()),this.component.setTo(c.toDate()),this.dateRangeDisplay(a);var e=this.component.triggerSearch();e||this.prepDates()},this.typeChanged=function(a){var b=null;b=this.useSelect2?this.selectJq.select2("val"):this.selectJq.val(),this.component.changeField(b),this.component.setFrom(!1),this.component.setTo(!1);var c=this.component.triggerSearch();c||this.prepDates()},this.prepDates=function(){var a=this.component.currentEarliest(),b=this.component.currentLatest(),c=this.component.fromDate,d=this.component.toDate;a?(this.drp.minDate=moment(a),this.drp.setStartDate(moment(a))):(this.drp.minDate=moment(this.component.defaultEarliest),this.drp.setStartDate(moment(this.component.defaultEarliest))),b?(this.drp.maxDate=moment(b),this.drp.setEndDate(moment(b))):(this.drp.maxDate=moment(this.component.defaultLatest),this.drp.setEndDate(moment(this.component.defaultLatest))),c&&(c<this.drp.minDate&&(this.drp.minDate=moment(c)),c>this.drp.maxDate&&(this.drp.maxDate=moment(c)),this.drp.setStartDate(moment(c))),d&&(d<this.drp.minDate&&(this.drp.minDate=moment(d)),d>this.drp.maxDate&&(this.drp.maxDate=moment(d)),this.drp.setEndDate(moment(d))),this.dateRangeDisplay({start:this.drp.startDate,end:this.drp.endDate})}}}}),$.extend(!0,edges,{bs3:{newSearchingNotificationRenderer:function(a){return a||(a={}),edges.bs3.SearchingNotificationRenderer.prototype=edges.newRenderer(a),new edges.bs3.SearchingNotificationRenderer(a)},SearchingNotificationRenderer:function(a){this.searchingMessage=a.searchingMessage||"Loading, please wait...",this.namespace="edges-bs3-searching-notification",this.draw=function(){var a="";if(this.component.searching){var b=edges.css_classes(this.namespace,"bar",this);a='<div class="progress-bar progress-bar-info progress-bar-striped active '+b+'">                             '+this.searchingMessage+"                         </div>"}this.component.context.html(a)}}}}),$.extend(!0,edges,{bs3:{newSortRenderer:function(a){return a||(a={}),edges.bs3.SortRenderer.prototype=edges.newRenderer(a),new edges.bs3.SortRenderer(a)},SortRenderer:function(a){this.prefix=edges.getParam(a.prefix,""),this.dirSwitcher=edges.getParam(a.dirSwitcher,!0),this.namespace="edges-bs3-search-controller",this.draw=function(){var a=this.component,b="";if(a.sortOptions&&a.sortOptions.length>0){var c=edges.css_classes(this.namespace,"direction",this),d=edges.css_classes(this.namespace,"sortby",this),e=edges.css_classes(this.namespace,"prefix",this),f=edges.css_id(this.namespace,"select",this),g='<label class="'+e+'" for="'+f+'">'+this.prefix+"</label>",h="";this.dirSwitcher&&(h='<span class="input-group-btn">                             <button type="button" class="btn btn-default btn-sm '+c+'" title="" href="#"></button>                         </span>'),b='<div class="form-inline">                             <div class="form-group">                                 '+g+'                                <div class="input-group">                                     '+h+'                                     <select name="'+f+'" class="form-control input-sm '+d+'">                                         <option value="_score">Relevance</option>';for(var i=0;i<a.sortOptions.length;i++){var j=a.sortOptions[i].field,k=a.sortOptions[i].display,l=a.sortOptions[i].dir;void 0===l&&(l=""),l=" "+l,b+='<option value="'+j+l+'">'+edges.escapeHtml(k)+"</option>"}b+=" </select>                                 </div>                             </div>                         </div>"}var m='<div class="row"><div class="col-md-12">{{SORT}}</div></div>';if(m=m.replace(/{{SORT}}/g,b),a.context.html(m),a.sortOptions&&a.sortOptions.length>0&&(this.dirSwitcher&&this.setUISortDir(),this.setUISortField()),a.sortOptions&&a.sortOptions.length>0){var n=edges.css_class_selector(this.namespace,"direction",this),o=edges.css_class_selector(this.namespace,"sortby",this);edges.on(n,"click",this,"changeSortDir"),edges.on(o,"change",this,"changeSortBy")}},this.setUISortDir=function(){var a=edges.css_class_selector(this.namespace,"direction",this),b=this.component.jq(a);"asc"===this.component.sortDir?(b.html('sort <i class="glyphicon glyphicon-arrow-up"></i> by'),b.attr("title","Current order ascending. Click to change to descending")):(b.html('sort <i class="glyphicon glyphicon-arrow-down"></i> by'),b.attr("title","Current order descending. Click to change to ascending"))},this.setUISortField=function(){if(this.component.sortBy){for(var a=edges.css_class_selector(this.namespace,"sortby",this),b=this.component.jq(a),c=b.find("option"),d=[],e=0;e<c.length;e++)d.push($(c[e]).attr("value"));var f=this.component.sortBy,g=this.component.sortBy+" "+this.component.sortDir,h=!1;$.inArray(f,d)>-1?h=f:$.inArray(g,d)>-1&&(h=g),h!==!1&&b.val(h)}},this.changeSortDir=function(a){this.component.changeSortDir()},this.changeSortBy=function(a){var b=this.component.jq(a).val(),c=b.split(" "),d=c[0],e=!1;2===c.length&&(e=c[1]),this.component.setSort({field:d,dir:e})}}}});