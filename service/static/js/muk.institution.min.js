var es={specialChars:["\\","+","-","=","&&","||",">","<","!","(",")","{","}","[","]","^",'"',"~","*","?",":","/"],specialCharsSubSet:["\\","+","-","=","&&","||",">","<","!","(",")","{","}","[","]","^","~","?",":","/"],characterPairs:['"'],distanceUnits:["km","mi","miles","in","inch","yd","yards","kilometers","mm","millimeters","cm","centimeters","m","meters"],aggregationFactory:function(a,b){var c={terms:es.newTermsAggregation,range:es.newRangeAggregation,geo_distance:es.newGeoDistanceAggregation,date_histogram:es.newDateHistogramAggregation,stats:es.StatsAggregation,cardinality:es.CardinalityAggregation};if(c[a])return c[a](b)},filterFactory:function(a,b){var c={query_string:es.newQueryString,term:es.newTermFilter,terms:es.newTermsFilter,range:es.newRangeFilter,geo_distance_range:es.newGeoDistanceRangeFilter};if(c[a])return c[a](b)},newQuery:function(a){return a||(a={}),new es.Query(a)},Query:function(a){this.filtered=a.filtered||!0,this.size=void 0!==a.size&&a.size,this.from=a.from||!1,this.fields=a.fields||[],this.aggs=a.aggs||[],this.must=a.must||[],this.queryString=!1,this.sort=[],this.source=a.source||!1,this.should=a.should||[],this.mustNot=a.mustNot||[],this.partialFields=a.partialFields||!1,this.scriptFields=a.scriptFields||!1,this.minimumShouldMatch=a.minimumShouldMatch||!1,this.partialFields=a.partialFields||!1,this.scriptFields=a.scriptFields||!1,this.facets=a.facets||[],this.getSize=function(){return void 0!==this.size&&this.size!==!1?this.size:10},this.getFrom=function(){return this.from?this.from:0},this.addField=function(a){$.inArray(a,this.fields)===-1&&this.fields.push(a)},this.setQueryString=function(a){var b=a;a instanceof es.QueryString||(b=$.isPlainObject(a)?es.newQueryString(a):es.newQueryString({queryString:a})),this.queryString=b},this.getQueryString=function(){return this.queryString},this.removeQueryString=function(){this.queryString=!1},this.setSortBy=function(a){this.sort=[];var b=a;$.isArray(a)||(b=[a]);for(var c=0;c<b.length;c++)this.addSortBy(b[c])},this.addSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a));for(var c=0;c<this.sort.length;c++){var d=this.sort[c];if(d.field===b.field)return}this.sort.push(b)},this.prependSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a)),this.removeSortBy(b),this.sort.unshift(b)},this.removeSortBy=function(a){var b=a;a instanceof es.Sort||(b=es.newSort(a));for(var c=[],d=0;d<this.sort.length;d++){var e=this.sort[d];e.field===b.field&&c.push(d)}c=c.sort().reverse();for(var d=0;d<c.length;d++)this.sort.splice(c[d],1)},this.getSortBy=function(){return this.sort},this.setSource=function(a,b){},this.addFacet=function(){},this.removeFacet=function(){},this.clearFacets=function(){},this.getAggregation=function(a){for(var b=a.name,c=0;c<this.aggs.length;c++){var d=this.aggs[c];if(d.name===b)return d}},this.addAggregation=function(a,b){if(b)this.removeAggregation(a.name);else for(var c=0;c<this.aggs.length;c++)if(this.aggs[c].name===a.name)return;this.aggs.push(a)},this.removeAggregation=function(a){for(var b=[],c=0;c<this.aggs.length;c++)this.aggs[c].name===a&&b.push(c);b=b.sort().reverse();for(var c=0;c<b.length;c++)this.aggs.splice(b[c],1)},this.clearAggregations=function(){this.aggs=[]},this.listAggregations=function(){return this.aggs},this.addMust=function(a){var b=this.listMust(a);0===b.length&&this.must.push(a)},this.listMust=function(a){return this.listFilters({boolType:"must",template:a})},this.removeMust=function(a){for(var b=[],c=0;c<this.must.length;c++){var d=this.must[c];d.matches(a)&&b.push(c)}b=b.sort().reverse();for(var c=0;c<b.length;c++)this.must.splice(b[c],1);return b.length},this.clearMust=function(){},this.addShould=function(){},this.listShould=function(){},this.removeShould=function(){},this.clearShould=function(){},this.addMustNot=function(){},this.listMustNot=function(){},this.removeMustNot=function(){},this.removeMustNot=function(){},this.hasFilters=function(){return this.must.length>0||this.should.length>0||this.mustNot.length>0},this.listFilters=function(a){var b=a.boolType||"must",c=a.template||!1,d=[];if("must"===b?d=this.must:"should"===b?d=this.should:"must_not"===b&&(d=this.mustNot),!c)return d;for(var e=[],f=0;f<d.length;f++){var g=d[f];g.matches(c)&&e.push(g)}return e},this.merge=function(a){if(this.filtered=a.filtered,a.size&&(this.size=a.size),a.from&&(this.from=a.from),a.fields&&a.fields.length>0)for(var b=0;b<a.fields.length;b++)this.addField(a.fields[b]);for(var c=a.listAggregations(),b=0;b<c.length;b++)this.addAggregation(c[b],!0);for(var d=a.listMust(),b=0;b<d.length;b++)this.addMust(d[b]);a.getQueryString()&&this.setQueryString(a.getQueryString());var e=a.getSortBy();if(e&&e.length>0){e.reverse();for(var b=0;b<e.length;b++)this.prependSortBy(e[b])}},this.objectify=function(a){a||(a={});var b=void 0===a.include_query_string||a.include_query_string,c=void 0===a.include_filters||a.include_filters,d=void 0===a.include_paging||a.include_paging,e=void 0===a.include_sort||a.include_sort,f=void 0===a.include_fields||a.include_fields,g=void 0===a.include_aggregations||a.include_aggregations,h=(void 0===a.include_facets||a.include_facets,{}),i={},j={};if(this.queryString&&b&&$.extend(i,this.queryString.objectify()),c&&this.must.length>0){for(var k=[],l=0;l<this.must.length;l++){var m=this.must[l];k.push(m.objectify())}j.must=k}if(this.filtered&&this.hasFilters()?(0==Object.keys(i).length&&(i.match_all={}),h.query={filtered:{filter:{bool:j},query:i}}):(this.hasFilters()&&(i.bool=j),0==Object.keys(i).length&&(i.match_all={}),h.query=i),d&&(void 0!==this.size&&this.size!==!1&&(h.size=this.size),this.from&&(h.from=this.from)),this.sort.length>0&&e){h.sort=[];for(var l=0;l<this.sort.length;l++)h.sort.push(this.sort[l].objectify())}if(this.fields.length>0&&f&&(h.fields=this.fields),this.aggs.length>0&&g){h.aggs={};for(var l=0;l<this.aggs.length;l++){var n=this.aggs[l];$.extend(h.aggs,n.objectify())}}return h},es.Query.prototype.toString=function(){return JSON.stringify(this.objectify())},this.parse=function(a){function b(a,b){if(a.must)for(var c=0;c<a.must.length;c++){var d=Object.keys(a.must[c])[0],e=es.filterFactory(d,{raw:a.must[c]});e&&b.addMust(e)}}function c(a,b){for(var c=Object.keys(a),d=0;d<c.length;d++){var e=c[d],f=es.filterFactory(e,{raw:a[e]});f&&"query_string"===e&&b.setQueryString(f)}}if(a.query)if(a.query.filtered){this.filtered=!0;var d=a.query.filtered.filter.bool;d&&b(d,this);var e=a.query.filtered.query;c(e,this)}else{var e=a.query;c(e,this)}if(a.size&&(this.size=a.size),a.from&&(this.from=a.from),a.fields&&(this.fields=a.fields),a.sort)for(var f=0;f<a.sort.length;f++){var g=a.sort[f];this.addSortBy(es.newSort({raw:g}))}if(a.aggs||a.aggregations)for(var h=a.aggs?a.aggs:a.aggregations,i=Object.keys(h),f=0;f<i.length;f++){var j=i[f],k=h[j],l=Object.keys(k)[0],m={};m[j]=k;var n=es.aggregationFactory(l,{raw:m});n&&this.addAggregation(n)}},a.queryString&&this.setQueryString(a.queryString),a.sort&&this.setSortBy(a.sort),a.raw&&this.parse(a.raw)},newQueryString:function(a){return a||(a={}),new es.QueryString(a)},QueryString:function(a){this.queryString=a.queryString||!1,this.defaultField=a.defaultField||!1,this.defaultOperator=a.defaultOperator||"OR",this.fuzzify=a.fuzzify||!1,this.escapeSet=a.escapeSet||es.specialCharsSubSet,this.pairs=a.pairs||es.characterPairs,this.unEscapeSet=a.unEscapeSet||es.specialChars,this.objectify=function(){var a=this._escape(this._fuzzify(this.queryString)),b={query_string:{query:a}};return this.defaultOperator&&(b.query_string.default_operator=this.defaultOperator),this.defaultField&&(b.query_string.default_field=this.defaultField),b},this.parse=function(a){a.query_string&&(a=a.query_string),this.queryString=this._unescape(a.query),a.default_operator&&(this.defaultOperator=a.default_operator),a.default_field&&(this.defaultField=a.default_field)},this._fuzzify=function(a){if(!this.fuzzify||"*"!==this.fuzzify&&"~"!==this.fuzzify)return a;if(a.indexOf("*")!==-1||a.indexOf("~")!==-1||a.indexOf(":")!==-1)return a;for(var b="",c=a.split(" "),d=0;d<c.length;d++){var e=c[d];e.length>0&&(e+=this.fuzzify,"*"==this.fuzzify&&(e="*"+e),b+=e+" ")}return b},this._escapeRegExp=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},this._replaceAll=function(a,b,c){return a.replace(new RegExp(this._escapeRegExp(b),"g"),c)},this._unReplaceAll=function(a,b){return a.replace(new RegExp("\\\\("+this._escapeRegExp(b)+")","g"),"$1")},this._paired=function(a,b){var c=a.match(new RegExp(this._escapeRegExp(b),"g"))||[];return c.length%2===0},this._escape=function(a){for(var b=this.escapeSet.slice(0),c=0;c<this.pairs.length;c++){var d=this.pairs[c];this._paired(a,d)||b.push(d)}for(var c=0;c<b.length;c++){var d=b[c];a=this._replaceAll(a,d,"\\"+d)}return a},this._unescape=function(a){for(var b=0;b<this.unEscapeSet.length;b++){var c=this.unEscapeSet[b];a=this._unReplaceAll(a,c)}return a},a.raw&&this.parse(a.raw)},newSort:function(a){return a||(a={}),new es.Sort(a)},Sort:function(a){this.field=a.field||"_score",this.order=a.order||"desc",this.objectify=function(){var a={};return a[this.field]={order:this.order},a},this.parse=function(a){this.field=Object.keys(a)[0],a[this.field].order&&(this.order=a[this.field].order)},a.raw&&this.parse(a.raw)},newAggregation:function(a){return a||(a={}),new es.Aggregation(a)},Aggregation:function(a){this.name=a.name,this.aggs=a.aggs||[],this.addAggregation=function(a){for(var b=0;b<this.aggs.length;b++)if(this.aggs[b].name===a.name)return;this.aggs.push(a)},this.removeAggregation=function(){},this.clearAggregations=function(){},this._make_aggregation=function(a,b){var c={};if(c[this.name]={},c[this.name][a]=b,this.aggs.length>0){c[this.name].aggs={};for(var d=0;d<this.aggs.length;d++)$.extend(c[this.name].aggs,this.aggs[d].objectify())}return c},this._parse_wrapper=function(a,b){this.name=Object.keys(a)[0];var c=a[this.name][b],d=a[this.name].aggs?a[this.name].aggs:a[this.name].aggregations;if(d)for(var e=Object.keys(d),f=0;f<e.length;f++){var g=e[f],h=d[e[f]],i=Object.keys(h)[0],j={};j[g]=h;var k=es.aggregationFactory(i,{raw:j});k&&this.addAggregation(k)}return c}},newTermsAggregation:function(a){return a||(a={}),es.TermsAggregation.prototype=es.newAggregation(a),new es.TermsAggregation(a)},TermsAggregation:function(a){this.field=a.field||!1,this.size=a.size||10,this.orderBy="_count",a.orderBy&&(this.orderBy=a.orderBy,"_"!==this.orderBy[0]&&(this.orderBy="_"+this.orderBy)),this.orderDir=a.orderDir||"desc",this.setOrdering=function(a,b){this.orderBy=a,"_"!==this.orderBy[0]&&(this.orderBy="_"+this.orderBy),this.orderDir=b},this.objectify=function(){var a={field:this.field,size:this.size,order:{}};return a.order[this.orderBy]=this.orderDir,this._make_aggregation("terms",a)},this.parse=function(a){var b=this._parse_wrapper(a,"terms");this.field=b.field,b.size&&(this.size=b.size),b.order&&(this.orderBy=Object.keys(b.order)[0],this.orderDir=b.order[this.orderBy])},a.raw&&this.parse(a.raw)},newCardinalityAggregation:function(a){return a||(a={}),es.CardinalityAggregation.prototype=es.newAggregation(a),new es.CardinalityAggregation(a)},CardinalityAggregation:function(a){this.field=es.getParam(a.field,!1),this.objectify=function(){var a={field:this.field};return this._make_aggregation("cardinality",a)},this.parse=function(a){var b=this._parse_wrapper(a,"cardinality");this.field=b.field},a.raw&&this.parse(a.raw)},newRangeAggregation:function(a){return a||(a={}),es.RangeAggregation.prototype=es.newAggregation(a),new es.RangeAggregation(a)},RangeAggregation:function(a){this.field=a.field||!1,this.ranges=a.ranges||[],this.objectify=function(){var a={field:this.field,ranges:this.ranges};return this._make_aggregation("range",a)},this.parse=function(a){var b=this._parse_wrapper(a,"range");this.field=b.field,this.ranges=b.ranges},a.raw&&this.parse(a.raw)},newGeoDistanceAggregation:function(a){return a||(a={}),es.GeoDistanceAggregation.prototype=es.newAggregation(a),new es.GeoDistanceAggregation(a)},GeoDistanceAggregation:function(a){this.field=a.field||!1,this.lat=a.lat||!1,this.lon=a.lon||!1,this.unit=a.unit||"m",this.distance_type=a.distance_type||"sloppy_arc",this.ranges=a.ranges||[],this.objectify=function(){var a={field:this.field,origin:{lat:this.lat,lon:this.lon},unit:this.unit,distance_type:this.distance_type,ranges:this.ranges};return this._make_aggregation("geo_distance",a)},this.parse=function(a){var b=this._parse_wrapper(a,"range");this.field=b.field;var c=b.origin;c.lat&&(this.lat=c.lat),c.lon&&(this.lon=c.lon),b.unit&&(this.unit=b.unit),b.distance_type&&(this.distance_type=b.distance_type),this.ranges=b.ranges},a.raw&&this.parse(a.raw)},newStatsAggregation:function(a){return a||(a={}),es.StatsAggregation.prototype=es.newAggregation(a),new es.StatsAggregation(a)},StatsAggregation:function(a){this.field=a.field||!1,this.objectify=function(){var a={field:this.field};return this._make_aggregation("stats",a)},this.parse=function(a){},a.raw&&this.parse(a.raw)},newDateHistogramAggregation:function(a){return a||(a={}),es.DateHistogramAggregation.prototype=es.newAggregation(a),new es.DateHistogramAggregation(a)},DateHistogramAggregation:function(a){this.field=a.field||!1,this.interval=a.interval||"month",this.format=a.format||!1,this.objectify=function(){var a={field:this.field,interval:this.interval};return this.format&&(a.format=this.format),this._make_aggregation("date_histogram",a)},this.parse=function(a){var b=this._parse_wrapper(a,"date_histogram");this.field=b.field,b.interval&&(this.interval=b.interval),b.format&&(this.format=b.format)},a.raw&&this.parse(a.raw)},newFilter:function(a){return a||(a={}),new es.Filter(a)},Filter:function(a){this.field=a.field,this.type_name=a.type_name,this.matches=function(a){return a.type_name===this.type_name&&(!a.field||a.field===this.field)},this.objectify=function(){},this.parse=function(){}},newTermFilter:function(a){return a||(a={}),a.type_name="term",es.TermFilter.prototype=es.newFilter(a),new es.TermFilter(a)},TermFilter:function(a){this.value=a.value||!1,this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);return!!b&&(!a.value||a.value===this.value)},this.objectify=function(){var a={term:{}};return a.term[this.field]=this.value,a},this.parse=function(a){a.term&&(a=a.term),this.field=Object.keys(a)[0],this.value=a[this.field]},a.raw&&this.parse(a.raw)},newTermsFilter:function(a){return a||(a={}),a.type_name="terms",es.TermsFilter.prototype=es.newFilter(a),new es.TermsFilter(a)},TermsFilter:function(a){this.values=a.values||!1,this.execution=a.execution||!1,this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);if(!b)return!1;if(a.values){if(a.values.length!==this.values.length)return!1;for(var c=0;c<a.values.length;c++)if($.inArray(a.values[c],this.values)===-1)return!1}return!0},this.objectify=function(){var a=this.values||[],b={terms:{}};return b.terms[this.field]=a,this.execution&&(b.terms.execution=this.execution),b},this.parse=function(a){a.terms&&(a=a.terms),this.field=Object.keys(a)[0],this.values=a[this.field],a.execution&&(this.execution=a.execution)},this.add_term=function(a){this.values||(this.values=[]),$.inArray(a,this.values)===-1&&this.values.push(a)},this.has_term=function(a){return!!this.values&&$.inArray(a,this.values)>=0},this.remove_term=function(a){if(this.values){var b=$.inArray(a,this.values);b>=0&&this.values.splice(b,1)}},this.has_terms=function(){return this.values!==!1&&this.values.length>0},this.term_count=function(){return this.values===!1?0:this.values.length},this.clear_terms=function(){this.values=!1},a.raw&&this.parse(a.raw)},newRangeFilter:function(a){return a||(a={}),a.type_name="range",es.RangeFilter.prototype=es.newFilter(a),new es.RangeFilter(a)},RangeFilter:function(a){this.lt=es.getParam(a.lt,!1),this.lte=es.getParam(a.lte,!1),this.gte=es.getParam(a.gte,!1),this.matches=function(a){var b=Object.getPrototypeOf(this).matches.call(this,a);return!!b&&((!a.lt||a.lt===this.lt)&&((!a.lte||a.lte===this.lte)&&(!a.gte||a.gte===this.gte)))},this.objectify=function(){var a={range:{}};return a.range[this.field]={},this.lte!==!1&&(a.range[this.field].lte=this.lte),this.lt!==!1&&this.lte===!1&&(a.range[this.field].lt=this.lt),this.gte!==!1&&(a.range[this.field].gte=this.gte),a},this.parse=function(a){a.range&&(a=a.range),this.field=Object.keys(a)[0],void 0!==a[this.field].lte&&a[this.field].lte!==!1&&(this.lte=a[this.field].lte),void 0!==a[this.field].lt&&a[this.field].lt!==!1&&(this.lt=a[this.field].lt),void 0!==a[this.field].gte&&a[this.field].gte!==!1&&(this.gte=a[this.field].gte)},a.raw&&this.parse(a.raw)},newGeoDistanceRangeFilter:function(a){return a||(a={}),a.type_name="geo_distance_range",es.GeoDistanceRangeFilter.prototype=es.newFilter(a),new es.GeoDistanceRangeFilter(a)},GeoDistanceRangeFilter:function(a){this.lt=a.lt||!1,this.gte=a.gte||!1,this.lat=a.lat||!1,this.lon=a.lon||!1,this.unit=a.unit||"m",this.objectify=function(){var a={geo_distance_range:{}};return a.geo_distance_range[this.field]={lat:this.lat,lon:this.lon},this.lt&&(a.geo_distance_range.lt=this.lt+this.unit),this.gte&&(a.geo_distance_range.gte=this.gte+this.unit),a},this.parse=function(a){function b(a,b){return a.indexOf(b,a.length-b.length)!==-1}function c(a){for(var c=!1,d=0;d<es.distanceUnits.length;d++){var e=es.distanceUnits[d];b(a,e)&&(a=a.substring(0,a.length-e.length),c=a.substring(a.length-e.length))}return[a,c]}a.geo_distance_range&&(a=a.geo_distance_range),this.field=Object.keys(a)[0],this.lat=a[this.field].lat,this.lon=a[this.field].lon;var d=a[this.field].lt,e=a[this.field].gte;if(d){d=d.trim();var f=c(d);this.lt=f[0],this.unit=f[1]}if(e){e=e.trim();var f=c(e);this.gte=f[0],this.unit=f[1]}},a.raw&&this.parse(a.raw)},newResult:function(a){return a||(a={}),new es.Result(a)},Result:function(a){this.data=a.raw,this.buckets=function(a){return this.data.aggregations[a].buckets},this.aggregation=function(a){return this.data.aggregations[a]},this.results=function(){var a=[];if(this.data.hits&&this.data.hits.hits)for(var b=0;b<this.data.hits.hits.length;b++){var c=this.data.hits.hits[b];"_source"in c?a.push(c._source):"fields"in c&&a.push(c.fields)}return a},this.total=function(){return!(!this.data.hits||!this.data.hits.total)&&parseInt(this.data.hits.total)}},doQuery:function(a){var b=a.success,c=a.complete,d=a.search_url,e=a.queryobj,f=a.datatype,g=JSON.stringify(e);$.ajax({type:"get",url:d,data:{source:g},dataType:f,success:es.querySuccess(b),complete:c})},querySuccess:function(a){return function(b){var c=es.newResult({raw:b});a(c)}},getParam:function(a,b){return void 0!==a?a:b}};!function(a){a.fn.bindWithDelay=function(b,c,d,e,f){function g(){var b=a.extend(!0,{},arguments[0]),c=function(){h=null,d.apply(i,[b])};f||clearTimeout(h),f&&h||(h=setTimeout(c,e))}var h=null,i=this;return a.isFunction(c)&&(f=e,e=d,d=c,c=void 0),this.bind(b,c,g)}}(jQuery);var muk={activeEdges:{},yearRanges:function(a,b){for(var c=Object.keys(a),d=moment(),e={},f=0;f<c.length;f++){var g=c[f],h=a[g],i=moment(d.year()+"-"+h,"YYYY-MM-DD"),j=!1,k=!1;d<=i?(j=moment(i).subtract(1,"day"),k=moment(i).subtract(1,"year")):(j=moment(i).add(1,"year").subtract(1,"day"),k=moment(i));for(var l=Object.keys(b),m=0;m<l.length;m++){var n=l[m],o=b[n],p=n+g;0===o?e[p]=[k,j]:e[p]=[moment(k).subtract(o,"year"),moment(j).subtract(o,"year")]}}return e},toIntFormat:function(){return edges.numFormat({decimalPlaces:0,thousandsSeparator:","})},toGBPIntFormat:function(){return edges.numFormat({prefix:"£",decimalPlaces:0,thousandsSeparator:","})}},edges={newEdge:function(a){return a||(a={}),new edges.Edge(a)},Edge:function(a){this.selector=a.selector||"body",this.search_url=edges.getParam(a.search_url,!1),this.datatype=a.datatype||"jsonp",this.preflightQueries=edges.getParam(a.preflightQueries,!1),this.baseQuery=a.baseQuery||!1,this.openingQuery=a.openingQuery||es.newQuery(),this.secondaryQueries=edges.getParam(a.secondaryQueries,!1),this.initialSearch=edges.getParam(a.initialSearch,!0),this.staticFiles=edges.getParam(a.staticFiles,[]),this.manageUrl=a.manageUrl||!1,this.urlQuerySource=a.urlQuerySource||"source",this.template=a.template||!1,this.components=a.components||[],this.renderPacks=a.renderPacks||[edges.bs3,edges.nvd3,edges.highcharts,edges.google,edges.d3],this.urlQuery=!1,this.urlParams={},this.shortUrl=!1,this.currentQuery=!1,this.result=!1,this.preflightResults={},this.realisedSecondaryQueries={},this.secondaryResults={},this.searching=!1,this.context=!1,this.static={},this.resources={},this.errorLoadingStatic=[],this.startup=function(){if(this.context=$(this.selector),this.context.trigger("edges:pre-init"),this.manageUrl){var a=this.getUrlParams();this.urlQuerySource in a&&(this.urlQuery=es.newQuery({raw:a[this.urlQuerySource]}),delete a[this.urlQuerySource]),this.urlParams=a}this.template&&this.template.draw(this);for(var b=0;b<this.components.length;b++){var c=this.components[b];c.init(this)}this.draw();var d=edges.objClosure(this,"startupPart2");this.loadStaticsAsync(d)},this.startupPart2=function(){var a=edges.objClosure(this,"startupPart3");this.runPreflightQueries(a)},this.startupPart3=function(){var a=this.openingQuery;this.urlQuery&&(a=this.urlQuery,this.urlQuery=!1);for(var b=0;b<this.components.length;b++){var c=this.components[b];c.contrib(a)}this.pushQuery(a),this.context.trigger("edges:post-init"),this.cycle()},this.doQuery=function(){this.cycle()},this.cycle=function(){if(!this.searching)if(this.searching=!0,this.shortUrl=!1,this.context.trigger("edges:pre-query"),this.manageUrl&&this.updateUrl(),this.search_url){var a=edges.objClosure(this,"cyclePart2");this.doPrimaryQuery(a)}else this.cyclePart2()},this.cyclePart2=function(){var a=edges.objClosure(this,"cyclePart3");this.runSecondaryQueries(a)},this.cyclePart3=function(){this.synchronise(),this.context.trigger("edges:pre-render"),this.draw(),this.context.trigger("edges:post-render"),this.searching=!1},this.synchronise=function(){for(var a=0;a<this.components.length;a++){var b=this.components[a];b.synchronise()}},this.draw=function(){for(var a=0;a<this.components.length;a++){var b=this.components[a];b.draw(this)}},this.reset=function(){this.context.trigger("edges:pre-reset");for(var a=this.cloneOpeningQuery(),b=0;b<this.components.length;b++){var c=this.components[b];c.contrib(a)}this.pushQuery(a),this.context.trigger("edges:post-reset"),this.cycle()},this.cloneQuery=function(){return!!this.currentQuery&&$.extend(!0,{},this.currentQuery)},this.pushQuery=function(a){this.baseQuery&&a.merge(this.baseQuery),this.currentQuery=a},this.cloneBaseQuery=function(){return this.baseQuery?$.extend(!0,{},this.baseQuery):es.newQuery()},this.cloneOpeningQuery=function(){return this.openingQuery?$.extend(!0,{},this.openingQuery):es.newQuery()},this.doPrimaryQuery=function(a){var b={callback:a};es.doQuery({search_url:this.search_url,queryobj:this.currentQuery.objectify(),datatype:this.datatype,success:edges.objClosure(this,"querySuccess",["result"],b),error:edges.objClosure(this,"queryFail",b)})},this.queryFail=function(a){var b=a.context;this.context.trigger("edges:query-fail"),b()},this.querySuccess=function(a){this.result=a.result;var b=a.callback;this.context.trigger("edges:query-success"),b()},this.runPreflightQueries=function(a){if(!this.preflightQueries||0==Object.keys(this.preflightQueries).length)return void a();this.context.trigger("edges:pre-preflight");for(var b=[],c=Object.keys(this.preflightQueries),d=0;d<c.length;d++){var e=c[d];b.push({id:e,query:this.preflightQueries[e]})}var f=this,g=edges.newAsyncGroup({list:b,action:function(a){var b=a.entry,c=a.success_callback,d=a.error_callback;es.doQuery({search_url:f.search_url,queryobj:b.query.objectify(),datatype:f.datatype,success:c,error:d})},successCallbackArgs:["result"],success:function(a){var b=a.result,c=a.entry;f.preflightResults[c.id]=b},errorCallbackArgs:["result"],error:function(a){f.context.trigger("edges:error-preflight")},carryOn:function(){f.context.trigger("edges:post-preflight"),a()}});g.process()},this.runSecondaryQueries=function(a){if(this.realisedSecondaryQueries={},!this.secondaryQueries||0==Object.keys(this.secondaryQueries).length)return void a();var b=[];for(var c in this.secondaryQueries){var d={};d.query=this.secondaryQueries[c](this),d.id=c,b.push(d),this.realisedSecondaryQueries[c]=d.query}var e=this,f=edges.newAsyncGroup({list:b,action:function(a){var b=a.entry,c=a.success_callback;a.error_callback;es.doQuery({search_url:e.search_url,queryobj:b.query.objectify(),datatype:e.datatype,success:c,complete:!1})},successCallbackArgs:["result"],success:function(a){var b=a.result,c=a.entry;e.secondaryResults[c.id]=b},errorCallbackArgs:["result"],error:function(a){},carryOn:function(){a()}});f.process()},this.getComponent=function(a){for(var b=a.id,c=0;c<this.components.length;c++){var d=this.components[c];if(d.id===b)return d}return!1},this.category=function(a){for(var b=[],c=0;c<this.components.length;c++){var d=this.components[c];d.category===a&&b.push(d)}return b},this.getRenderPackObject=function(a,b){for(var c=0;c<this.renderPacks.length;c++){var d=this.renderPacks[c];if(d&&d.hasOwnProperty(a))return d[a](b)}},this.jq=function(a){return $(a,this.context)},this.getUrlParams=function(){var a={},b=window.location.href,c=!1;b.indexOf("#")>-1&&(c=b.slice(b.indexOf("#")),b=b.substring(0,b.indexOf("#")));for(var d=b.slice(b.indexOf("?")+1).split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(2===f.length){var g=decodeURIComponent(f[1]);"["!=g[0]&&"{"!=g[0]||(g=g.replace(/^"/,"").replace(/"$/,""),g=JSON.parse(g)),a[f[0]]=g}}return c&&(a["#"]=c),a},this.urlQueryArg=function(a){a||(a={include_query_string:!0,include_filters:!0,include_paging:!0,include_sort:!0,include_fields:!1,include_aggregations:!1,include_facets:!1});var b=JSON.stringify(this.currentQuery.objectify(a)),c={};return c[this.urlQuerySource]=encodeURIComponent(b),c},this.fullQueryArgs=function(){var a=$.extend(!0,{},this.urlParams);return $.extend(a,this.urlQueryArg()),a},this.fullUrlQueryString=function(){return this._makeUrlQuery(this.fullQueryArgs())},this._makeUrlQuery=function(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++){var e=b[d],f=a[e];c.push(e+"="+f)}return c.join("&")},this.fullUrl=function(){var a=this.fullQueryArgs(),b="";a["#"]&&(b="#"+a["#"],delete a["#"]);var c=window.location.toString(),d=c.split("?"),e=d[0]+"?"+this._makeUrlQuery(a)+b;return e},this.updateUrl=function(){if("pushState"in window.history){var a="?"+this.fullUrlQueryString();window.history.pushState("","",a)}},this.loadStaticsAsync=function(a){if(!this.staticFiles||0==this.staticFiles.length)return this.context.trigger("edges:post-load-static"),void a();var b=this,c=edges.newAsyncGroup({list:this.staticFiles,action:function(a){var b=a.entry,c=a.success_callback,d=a.error_callback,e=(b.id,b.url),f=edges.getParam(b.datatype,"text");$.ajax({type:"get",url:e,dataType:f,success:c,error:d})},successCallbackArgs:["data"],success:function(a){var c=a.data,d=a.entry;if(d.processor){var e=d.processor({data:c});b.resources[d.id]=e,d.opening&&d.opening({resource:e})}b.static[d.id]=c},errorCallbackArgs:["data"],error:function(a){b.errorLoadingStatic.push(a.entry.id),b.context.trigger("edges:error-load-static")},carryOn:function(){b.context.trigger("edges:post-load-static"),a()}});c.process()},this.startup()},newAsyncGroup:function(a){return a||(a={}),new edges.AsyncGroup(a)},AsyncGroup:function(a){this.list=a.list,this.successCallbackArgs=a.successCallbackArgs,this.errorCallbackArgs=a.errorCallbackArgs;var b=a.action,c=a.success,d=a.carryOn,e=a.error;this.functions={action:b,success:c,carryOn:d,error:e},this.checkList=[],this.finished=!1,this.construct=function(a){for(var b=0;b<this.list.length;b++)this.checkList.push(0)},this.process=function(a){0==this.list.length&&this.functions.carryOn();for(var b=0;b<this.list.length;b++){var c={index:b},d=edges.objClosure(this,"_actionSuccess",this.successCallbackArgs,c),e=edges.objClosure(this,"_actionError",this.successCallbackArgs,c),f=!1;this.functions.action({entry:this.list[b],success_callback:d,error_callback:e,complete_callback:f})}},this._actionSuccess=function(a){var b=a.index;delete a.index,a.entry=this.list[b],this.functions.success(a),this.checkList[b]=1,this._isComplete()&&this._finalise()},this._actionError=function(a){var b=a.index;delete a.index,a.entry=this.list[b],this.functions.error(a),this.checkList[b]=-1,this._isComplete()&&this._finalise()},this._actionComplete=function(a){},this._isComplete=function(){return $.inArray(0,this.checkList)===-1},this._finalise=function(){this.finished||(this.finished=!0,this.functions.carryOn())},this.construct()},newRenderer:function(a){return a||(a={}),new edges.Renderer(a)},Renderer:function(a){this.component=a.component||!1,this.init=function(a){this.component=a},this.draw=function(a){}},newComponent:function(a){return a||(a={}),new edges.Component(a)},Component:function(a){this.id=a.id,this.renderer=a.renderer,this.category=a.category||"none",this.defaultRenderer=a.defaultRenderer||"newRenderer",this.init=function(a){this.edge=a,this.context=this.edge.jq("#"+this.id),this.renderer||(this.renderer=this.edge.getRenderPackObject(this.defaultRenderer)),this.renderer&&this.renderer.init(this)},this.draw=function(){this.renderer&&this.renderer.draw()},this.contrib=function(a){},this.synchronise=function(){},this.jq=function(a){return this.edge.jq(a)}},newSelector:function(a){return a||(a={}),edges.Selector.prototype=edges.newComponent(a),new edges.Selector(a)},Selector:function(a){this.field=a.field,this.display=a.display||this.field,this.active=a.active||!0,this.disabled=a.disabled||!1,this.category=a.category||"selector"},newTemplate:function(a){return a||(a={}),new edges.Template(a)},Template:function(a){this.draw=function(a){}},objClosure:function(a,b,c,d){return function(){if(c){for(var e={},f=0;f<c.length;f++)arguments.length>f&&(e[c[f]]=arguments[f]);d&&(e=$.extend(e,d)),a[b](e)}else{var g=Array.prototype.slice,h=g.apply(arguments);d&&h.push(d),a[b].apply(a,h)}}},eventClosure:function(a,b,c){return function(d){c&&!c(d)||(d.preventDefault(),a[b](this))}},css_classes:function(a,b,c){var d=a+"-"+b;return c&&(d+=" "+d+"-"+c.component.id),d},css_class_selector:function(a,b,c){var d="."+a+"-"+b;return c&&(d+=d+"-"+c.component.id),d},css_id:function(a,b,c){var d=a+"-"+b;return c&&(d+="-"+c.component.id),d},css_id_selector:function(a,b,c){return"#"+edges.css_id(a,b,c)},on:function(a,b,c,d,e,f){c.component&&c.component.id?b=b+"."+c.component.id:c.namespace&&(b=b+"."+c.namespace);var g=edges.eventClosure(c,d,f);e?c.component?c.component.jq(a).bindWithDelay(b,g,e):c.edge?c.edge.jq(a).bindWithDelay(b,g,e):console.log("attempt to bindWithDelay on caller which has neither inner component or edge"):c.component?c.component.jq(a).on(b,g):c.edge?c.edge.jq(a).on(b,g):console.log("attempt to bindWithDelay on caller which has neither inner component or edge")},escapeHtml:function(a,b){if(void 0===b&&(b=""),void 0===a||null==a)return b;try{return"function"!=typeof a.replace?a:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}catch(a){return b}},objVal:function(a,b,c){void 0===c&&(c=!1);for(var d=a.split("."),e=b,f=0;f<d.length;f++){var g=d[f];if(!(g in e))return c;e=e[g]}return e},getParam:function(a,b){return void 0!==a?a:b},safeId:function(a){return a.replace(/&/g,"_").replace(/</g,"_").replace(/>/g,"_").replace(/"/g,"_").replace(/'/g,"_").replace(/\./gi,"_").replace(/\:/gi,"_").replace(/\s/gi,"_")},numFormat:function(a){var b=edges.getParam(a.prefix,""),c=edges.getParam(a.zeroPadding,!1),d=edges.getParam(a.decimalPlaces,!1),e=edges.getParam(a.thousandsSeparator,!1),f=edges.getParam(a.decimalSeparator,"."),g=edges.getParam(a.suffix,"");return function(a){a=parseFloat(a),a=d!==!1?a.toFixed(d):a.toString();var h=a.split(".");if(c!==!1){for(var i=c-h[0].length,j="",k=0;k<i;k++)j+="0";h[0]=j+h[0]}return e!==!1&&(h[0]=h[0].replace(/\B(?=(\d{3})+(?!\d))/g,e)),
1==h.length?b+h[0]+g:b+h[0]+f+h[1]+g}}};$.extend(edges,{newNumericRangeEntry:function(a){return a||(a={}),edges.NumericRangeEntry.prototype=edges.newSelector(a),new edges.NumericRangeEntry(a)},NumericRangeEntry:function(a){this.lower=edges.getParam(a.lower,!1),this.upper=edges.getParam(a.upper,!1),this.increment=edges.getParam(a.increment,1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newNumericRangeEntryRenderer"),this.from=!1,this.to=!1,this.init=function(a){if(edges.newSelector().init.call(this,a),!this.lower||!this.upper){var b=this.edge.cloneBaseQuery();b.clearAggregations(),b.size=0,b.addAggregation(es.newStatsAggregation({name:this.id,field:this.field})),es.doQuery({search_url:this.edge.search_url,queryobj:b.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"querySuccess",["result"]),error:edges.objClosure(this,"queryFail")})}},this.synchronise=function(){if(this.from=this.lower,this.to=this.upper,this.edge.currentQuery)for(var a=this.edge.currentQuery.listMust(es.newRangeFilter({field:this.field})),b=0;b<a.length;b++)this.to=a[b].lte,this.from=a[b].gte},this.querySuccess=function(a){var b=a.result,c=b.aggregation(this.id);this.lower===!1&&(this.lower=c.min),this.upper===!1&&(this.upper=c.max),this.draw()},this.queryFail=function(a){this.lower===!1&&(this.lower=0),this.upper===!1&&(this.upper=0)},this.selectRange=function(a,b){var c=this.edge.cloneQuery();c.removeMust(es.newRangeFilter({field:this.field})),a===this.lower&&b===this.upper||c.addMust(es.newRangeFilter({field:this.field,gte:a,lte:b})),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()}},newMultiDateRangeEntry:function(a){return a||(a={}),edges.MultiDateRangeEntry.prototype=edges.newComponent(a),new edges.MultiDateRangeEntry(a)},MultiDateRangeEntry:function(a){this.display=edges.getParam(a.display,!1),this.fields=edges.getParam(a.fields,[]),this.earliest=edges.getParam(a.earliest,{}),this.latest=edges.getParam(a.latest,{}),this.autoLookupRange=edges.getParam(a.autoLookupRange,!1),this.category=edges.getParam(a.category,"selector"),this.defaultEarliest=edges.getParam(a.defaultEarliest,new Date(0)),this.defaultLatest=edges.getParam(a.defaultLatest,new Date),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newMultiDateRangeRenderer"),this.currentField=!1,this.fromDate=!1,this.toDate=!1,this.touched=!1,this.dateOptions={},this.init=function(a){Object.getPrototypeOf(this).init.call(this,a),this.currentField=this.fields[0].field,this.lastField=!1,this.autoLookupRange?(a.secondaryQueries===!1&&(a.secondaryQueries={}),a.secondaryQueries["multidaterange_"+this.id]=this.getSecondaryQueryFunction()):this.loadDates()},this.synchronise=function(){if(this.currentField=!1,this.fromDate=!1,this.toDate=!1,this.autoLookupRange)for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,c=this.edge.secondaryResults["multidaterange_"+this.id].aggregation(b),d=this.defaultEarliest,e=this.defaultLatest;null!==c.min&&(d=new Date(c.min)),null!==c.max&&(e=new Date(c.max)),this.dateOptions[b]={earliest:d,latest:e}}for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,f=this.edge.currentQuery.listMust(es.newRangeFilter({field:b}));if(f.length>0){this.currentField=b;var g=f[0];this.fromDate=g.gte,this.toDate=g.lt}}!this.currentField&&this.fields.length>0&&(this.currentField=this.fields[0].field)},this.currentEarliest=function(){return!!this.currentField&&(this.dateOptions[this.currentField]?this.dateOptions[this.currentField].earliest:void 0)},this.currentLatest=function(){return!!this.currentField&&(this.dateOptions[this.currentField]?this.dateOptions[this.currentField].latest:void 0)},this.changeField=function(a){this.lastField=this.currentField,a!==this.currentField&&(this.touched=!0,this.currentField=a)},this.setFrom=function(a){a!==this.fromDate&&(this.touched=!0,this.fromDate=a)},this.setTo=function(a){a!==this.toDate&&(this.touched=!0,this.toDate=a)},this.triggerSearch=function(){if(this.touched){this.touched=!1;for(var a=this.edge.cloneQuery(),b=0,c=0;c<this.fields.length;c++){var d=this.fields[c].field;b+=a.removeMust(es.newRangeFilter({field:d}))}var e=this.currentField&&(this.toDate||this.fromDate),f=b>0||e;if(!f)return!1;if(e){var g={field:this.currentField};this.toDate&&(g.lt=this.toDate),this.fromDate&&(g.gte=this.fromDate),a.addMust(es.newRangeFilter(g))}return this.edge.pushQuery(a),this.edge.doQuery(),!0}},this.loadDates=function(){for(var a=0;a<this.fields.length;a++){var b=this.fields[a].field,c=this.defaultEarliest,d=this.defaultLatest,e=this.earliest[b],f=this.latest[b];e&&(c=e()),f&&(d=f()),this.dateOptions[b]={earliest:c,latest:d}}},this.getSecondaryQueryFunction=function(){var a=this;return function(b){for(var c=b.cloneQuery(),d=0;d<a.fields.length;d++){var e=a.fields[d];c.removeMust(es.newRangeFilter({field:e.field}))}c.clearAggregations();for(var d=0;d<a.fields.length;d++){var e=a.fields[d].field;c.addAggregation(es.newStatsAggregation({name:e,field:e}))}return c.size=0,c.from=0,c}}}}),$.extend(edges,{nvd3:{DataSeriesConversions:{toXY:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e={};e.key=d.key,e.values=[];for(var f=0;f<d.values.length;f++){var g=d.values[f];e.values.push({x:g.label,y:g.value})}b.push(e)}return b}},tools:{persistingPieColour:function(a,b){a||(a=["#ea6ccb","#8fc8b0","#a9cf85","#d90d4c","#6c537e","#64d54f","#ecc7c4","#f1712b"]),b||(b={});var c=0;return function(d,e){if(d.label in b)return b[d.label];var f=a[c%(a.length-1)];return c++,b[d.label]=f,f}}},newPieChartRenderer:function(a){return a||(a={}),edges.nvd3.PieChartRenderer.prototype=edges.newRenderer(a),new edges.nvd3.PieChartRenderer(a)},PieChartRenderer:function(a){this.showLabels=edges.getParam(a.showLabels,!0),this.donut=edges.getParam(a.donut,!1),this.labelThreshold=a.labelThreshold||.05,this.transitionDuration=a.transitionDuration||500,this.noDataMessage=a.noDataMessage||!1,this.color=a.color||!1,this.legendPosition=a.legendPosition||"top",this.labelsOutside=edges.getParam(a.labelsOutside,!1),this.valueFormat=a.valueFormat||!1,this.marginTop=a.marginTop||30,this.marginRight=a.marginRight||30,this.marginBottom=a.marginBottom||30,this.marginLeft=a.marginLeft||30,this.namespace="edges-nvd3-pie",this.draw=function(){var a=edges.css_classes(this.namespace,"display",this),b="";this.component.display&&(b='<span class="'+a+'">'+this.component.display+"</span><br>");var c=edges.css_id(this.namespace,"svg",this),d=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(b+'<svg id="'+c+'"></svg>');var e=this.component.dataSeries;e||(e=[]),e=e.length>0?e[0].values:[];var f=this;nv.addGraph(function(){var a=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(f.showLabels).legendPosition(f.legendPosition).labelsOutside(f.labelsOutside).margin({left:f.marginLeft,right:f.marginRight,top:f.marginTop,bottom:f.marginBottom});return f.noDataMessage&&a.noData(f.noDataMessage),f.color&&a.color(f.color),f.valueFormat&&a.valueFormat(f.valueFormat),d3.select(d).datum(e).transition().duration(f.transitionDuration).call(a),a})}},newHorizontalMultibarRenderer:function(a){return a||(a={}),edges.nvd3.HorizontalMultibarRenderer.prototype=edges.newRenderer(a),new edges.nvd3.HorizontalMultibarRenderer(a)},HorizontalMultibarRenderer:function(a){this.showValues=edges.getParam(a.showValues,!0),this.toolTips=edges.getParam(a.toolTips,!0),this.controls=edges.getParam(a.controls,!1),this.stacked=edges.getParam(a.stacked,!1),this.legend=edges.getParam(a.legend,!0),this.color=a.color||!1,this.noDataMessage=edges.getParam(a.noDataMessage,!1),this.transitionDuration=a.transitionDuration||500,this.marginTop=a.marginTop||30,this.marginRight=a.marginRight||50,this.marginBottom=a.marginBottom||50,this.marginLeft=a.marginLeft||200,this.yTickFormat=edges.getParam(a.yTickFormat,",.0f"),this.xTickFormat=edges.getParam(a.xTickFormat,!1),this.valueFormat=edges.getParam(a.valueFormat,!1),this.xAxisLabel=edges.getParam(a.xAxisLabel,!1),this.yAxisLabel=edges.getParam(a.yAxisLabel,!1),this.tooltipGenerator=edges.getParam(a.tooltipGenerator,!1),this.namespace="edges-nvd3-horizontal-multibar",this.draw=function(){$(".nvtooltip").remove();var a=edges.css_id(this.namespace,"svg",this),b=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html('<svg id="'+a+'"></svg>');var c=this.component.dataSeries;c||(c=[]);var d=this;nv.addGraph(function(){var a=nv.models.multiBarHorizontalChart().x(function(a){return a.label}).y(function(a){return a.value}).margin({top:d.marginTop,right:d.marginRight,bottom:d.marginBottom,left:d.marginLeft}).showValues(d.showValues).tooltips(d.toolTips).showControls(d.controls).showLegend(d.legend);if(d.stacked&&a.multibar.stacked(d.stacked),d.yTickFormat){var e=d.yTickFormat;"string"==typeof d.yTickFormat&&(e=d3.format(d.yTickFormat)),a.yAxis.tickFormat(e)}if(d.yAxisLabel&&a.yAxis.axisLabel(d.yAxisLabel),d.xTickFormat){var e=d.xTickFormat;"string"==typeof d.xTickFormat&&(e=d3.format(d.xTickFormat)),a.xAxis.tickFormat(e)}if(d.xAxisLabel&&a.xAxis.axisLabel(d.xAxisLabel),d.valueFormat){var e=d.valueFormat;"string"==typeof d.valueFormat&&(e=d3.format(d.xTickFormat)),a.valueFormat(e)}return d.noDataMessage&&a.noData(d.noDataMessage),d.color&&a.color(d.color),d.tooltipGenerator&&a.tooltip.contentGenerator(d.tooltipGenerator),d3.select(b).datum(c).transition().duration(d.transitionDuration).call(a),nv.utils.windowResize(a.update),a})}},newMultibarRenderer:function(a){return a||(a={}),edges.nvd3.MultibarRenderer.prototype=edges.newRenderer(a),new edges.nvd3.MultibarRenderer(a)},MultibarRenderer:function(a){this.xTickFormat=a.xTickFormat||",.2f",this.yTickFormat=a.yTickFormat||",.2f",this.transitionDuration=a.transitionDuration||500,this.controls=edges.getParam(a.controls,!1),this.barColor=a.barColor||!1,this.showLegend=edges.getParam(a.showLegend,!0),this.xAxisLabel=a.xAxisLabel||"",this.yAxisLabel=a.yAxisLabel||"",this.namespace="edges-nvd3-multibar",this.draw=function(){var a=edges.css_classes(this.namespace,"display",this),b="";this.component.display&&(b='<span class="'+a+'">'+this.component.display+"</span><br>");var c=edges.css_id(this.namespace,"svg",this),d=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(b+'<svg id="'+c+'"></svg>');var e=this.component.dataSeries;e||(e=[]),e=edges.nvd3.DataSeriesConversions.toXY(this.component.dataSeries);var f=this;nv.addGraph(function(){var a=nv.models.multiBarChart().showControls(f.controls);return a.xAxis.axisLabel(f.xAxisLabel).tickFormat(d3.format(f.xTickFormat)),a.yAxis.axisLabel(f.yAxisLabel).tickFormat(d3.format(f.yTickFormat)),f.barColor&&a.barColor(f.barColor),a.showLegend(f.showLegend),d3.select(d).datum(e).transition().duration(f.transitionDuration).call(a),nv.utils.windowResize(a.update),a})}},newSimpleLineChartRenderer:function(a){return a||(a={}),edges.nvd3.SimpleLineChartRenderer.prototype=edges.newRenderer(a),new edges.nvd3.SimpleLineChartRenderer(a)},SimpleLineChartRenderer:function(a){this.interactiveGuideline=a.interactiveGuideline||!0,this.xTickFormat=a.xTickFormat||",.2f",this.yTickFormat=a.yTickFormat||",.2f",this.transitionDuration=a.transitionDuration||500,this.lineColor=a.lineColor||!1,this.includeOnY=a.includeOnY||!1,this.showLegend=edges.getParam(a.showLegend,!0),this.xAxisLabel=a.xAxisLabel||"",this.yAxisLabel=a.yAxisLabel||"",this.namespace="edges-nvd3-simple-line-chart",this.draw=function(){var a=edges.css_classes(this.namespace,"display",this),b="";this.component.display&&(b='<span class="'+a+'">'+this.component.display+"</span><br>");var c=edges.css_id(this.namespace,"svg",this),d=edges.css_id_selector(this.namespace,"svg",this);this.component.context.html(b+'<svg id="'+c+'"></svg>');var e=this.component.dataSeries;e||(e=[]);var f=edges.nvd3.DataSeriesConversions.toXY(e),g=this;nv.addGraph(function(){var a=nv.models.lineChart().useInteractiveGuideline(g.interactiveGuideline);return a.xAxis.axisLabel(g.xAxisLabel).tickFormat(d3.format(g.xTickFormat)),g.lineColor&&a.color(g.lineColor),g.includeOnY&&a.forceY(g.includeOnY),a.yAxis.axisLabel(g.yAxisLabel).tickFormat(d3.format(g.yTickFormat)),a.showLegend(g.showLegend),d3.select(d).datum(f).transition().duration(g.transitionDuration).call(a),nv.utils.windowResize(a.update),a})}}}}),$.extend(edges,{newFilterSetter:function(a){return a||(a={}),edges.FilterSetter.prototype=edges.newComponent(a),new edges.FilterSetter(a)},FilterSetter:function(a){this.filters=edges.getParam(a.filters,[]),this.aggregations=edges.getParam(a.aggregations,[]),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newFilterSetterRenderer"),this.filter_counts={},this.active_filters={},this.contrib=function(a){for(var b=0;b<this.aggregations.length;b++)a.addAggregation(this.aggregations[b])},this.synchronise=function(){for(var a=0;a<this.filters.length;a++){var b=this.filters[a];if(b.agg_name&&b.bucket_field&&b.bucket_value){var c=this.edge.result.aggregation(b.agg_name);if(c){for(var d=b.bucket_field,e=b.bucket_value,f=0,g=c.buckets,h=0;h<g.length;h++){var i=g[h];if(i[d]&&i[d]==e){f=i.doc_count;break}}this.filter_counts[b.id]=f}}}for(var a=0;a<this.filters.length;a++){var b=this.filters[a];if(b.must){for(var j=b.must.length,k=0,l=0;l<b.must.length;l++){var m=b.must[l],n=this.edge.currentQuery.listMust(m);n.length>0&&(k+=1)}k===j?this.active_filters[b.id]=!0:this.active_filters[b.id]=!1}}},this.addFilter=function(a){for(var b=!1,c=0;c<this.filters.length;c++)if(this.filters[c].id===a){b=this.filters[c];break}if(b&&b.must){for(var d=this.edge.cloneQuery(),c=0;c<b.must.length;c++){var e=b.must[c];d.addMust(e)}d.from=0,this.edge.pushQuery(d),this.edge.doQuery()}},this.removeFilter=function(a){for(var b=!1,c=0;c<this.filters.length;c++)if(this.filters[c].id===a){b=this.filters[c];break}if(b&&b.must){for(var d=this.edge.cloneQuery(),c=0;c<b.must.length;c++){var e=b.must[c];d.removeMust(e)}d.from=0,this.edge.pushQuery(d),this.edge.doQuery()}}},newFullSearchController:function(a){return a||(a={}),edges.FullSearchController.prototype=edges.newComponent(a),new edges.FullSearchController(a)},FullSearchController:function(a){this.fuzzify=a.fuzzify||!1,this.sortOptions=a.sortOptions||!1,this.fieldOptions=a.fieldOptions||!1,this.urlShortener=a.urlShortener||!1,this.defaultOperator=a.defaultOperator||"OR",this.defaultRenderer=a.defaultRenderer||"newFullSearchControllerRenderer",this.searchField=!1,this.searchString=!1,this.sortBy=!1,this.sortDir="desc",this.shortUrl=!1,this.synchronise=function(){if(this.searchString=!1,this.searchField=!1,this.sortBy=!1,this.sortDir="desc",this.edge.currentQuery){var a=this.edge.currentQuery.getQueryString();a&&(this.searchString=a.queryString,this.searchField=a.defaultField);var b=this.edge.currentQuery.getSortBy();b.length>0&&(this.sortBy=b[0].field,this.sortDir=b[0].order)}},this.setSort=function(a){var b=a.dir,c=a.field;void 0!==b&&b!==!1||(b="desc");var d=this.edge.cloneQuery();d.setSortBy(es.newSort({field:c,order:b})),d.from=0,this.edge.pushQuery(d),this.edge.doQuery()},this.changeSortDir=function(){var a="asc"===this.sortDir?"desc":"asc",b=this.sortBy?this.sortBy:"_score",c=this.edge.cloneQuery();c.setSortBy(es.newSort({field:b,order:a})),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this.setSortBy=function(a){var b=this.edge.cloneQuery();a&&""!==a||(a="_score"),b.setSortBy(es.newSort({field:a,order:this.sortDir})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.setSearchField=function(a){if(this.searchField=a,this.searchString&&""!==this.searchString){var b=this.edge.cloneQuery();b.setQueryString(es.newQueryString({queryString:this.searchString,defaultField:a,defaultOperator:this.defaultOperator,fuzzify:this.fuzzify})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()}},this.setSearchText=function(a){var b=this.edge.cloneQuery();if(""!==a){var c={queryString:a,defaultOperator:this.defaultOperator,fuzzify:this.fuzzify};this.searchField&&""!==this.searchField&&(c.defaultField=this.searchField),b.setQueryString(es.newQueryString(c))}else b.removeQueryString();b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.clearSearch=function(){this.edge.reset()}},newSelectedFilters:function(a){return a||(a={}),edges.SelectedFilters.prototype=edges.newComponent(a),new edges.SelectedFilters(a)},SelectedFilters:function(a){this.fieldDisplays=edges.getParam(a.fieldDisplays,{}),this.valueMaps=edges.getParam(a.valueMaps,{}),this.valueFunctions=edges.getParam(a.valueFunctions,{}),this.rangeMaps=edges.getParam(a.rangeMaps,{}),this.rangeFunctions=edges.getParam(a.rangeFunctions,{}),this.formatUnknownRange=edges.getParam(a.formatUnknownRange,!1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newSelectedFiltersRenderer"),this.mustFilters={},this.searchString=!1,this.searchField=!1,this.synchronise=function(){if(this.mustFilters={},this.searchString=!1,this.searchField=!1,this.edge.currentQuery){for(var a=this.edge.currentQuery.listMust(),b=0;b<a.length;b++){var c=a[b];"term"===c.type_name?this._synchronise_term(c):"terms"===c.type_name?this._synchronise_terms(c):"range"===c.type_name?this._synchronise_range(c):"geo_distance_range"===c.type_name}var d=this.edge.currentQuery.getQueryString();d&&(this.searchString=d.queryString,this.searchField=d.defaultField)}},this.removeFilter=function(a,b,c,d){var e=this.edge.cloneQuery();if("term"===b){var f=es.newTermFilter({field:c,value:d});"must"===a&&e.removeMust(f)}else if("terms"===b){var f=es.newTermsFilter({field:c});if("must"===a)for(var g=e.listMust(f),h=0;h<g.length;h++)g[h].has_term(d)&&g[h].remove_term(d),g[h].has_terms()||e.removeMust(g[h])}else if("range"==b){var i={field:c};d.to&&(i.lt=d.to),d.from&&(i.gte=d.from);var f=es.newRangeFilter(i);"must"===a&&e.removeMust(f)}e.from=0,this.edge.pushQuery(e),this.edge.doQuery()},this.clearQueryString=function(){var a=this.edge.cloneQuery();a.removeQueryString(),a.from=0,this.edge.pushQuery(a),this.edge.doQuery()},this.clearSearch=function(){this.edge.reset()},this._synchronise_term=function(a){var b=this.fieldDisplays[a.field]||a.field;a.field in this.mustFilters?this.mustFilters[a.field].values.push({val:a.value,display:this._translate(a.field,a.value)}):this.mustFilters[a.field]={filter:a.type_name,display:b,values:[{val:a.value,display:this._translate(a.field,a.value)}],rel:"AND"}},this._synchronise_terms=function(a){for(var b=this.fieldDisplays[a.field]||a.field,c=[],d=0;d<a.values.length;d++){var e=a.values[d],f=this._translate(a.field,e);c.push({val:e,display:f})}this.mustFilters[a.field]={filter:a.type_name,display:b,values:c,rel:"OR"}},this._synchronise_range=function(a){var b=this.fieldDisplays[a.field]||a.field,c=a.lt;c===!1&&(c=a.lte);var d=a.gte,e=this._getRangeDef(a.field,d,c),f=[];e?f.push(e):f.push({to:c,from:d,display:this._formatUnknown(d,c)}),this.mustFilters[a.field]={filter:a.type_name,display:b,values:f}},this._translate=function(a,b){if(a in this.valueMaps){if(b in this.valueMaps[a])return this.valueMaps[a][b]}else if(a in this.valueFunctions)return this.valueFunctions[a](b);return b},this._getRangeDef=function(a,b,c){if(!this.rangeMaps[a]&&!this.rangeFunctions[a])return!1;if(this.rangeMaps[a])for(var d=0;d<this.rangeMaps[a].length;d++){var e=this.rangeMaps[a][d],f=!0,g=!0;if((b&&!e.from||!b&&e.from)&&(f=!1),(c&&!e.to||!c&&e.to)&&(g=!1),b&&e.from&&b!==e.from&&(f=!1),c&&e.to&&c!==e.to&&(g=!1),f&&g)return e}else if(this.rangeFunctions[a]){var h=this.rangeFunctions[a];return h({field:a,from:b,to:c})}return!1},this._formatUnknown=function(a,b){if(this.formatUnknownRange)return this.formatUnknownRange(a,b);if((a!==!1||b!==!1)&&a===b)return a;var c="";return c+=a!==!1?a:"< ",b!==!1?c+=a!==!1?" - "+b:b:a!==!1?c+="+":c="unknown",c}},newPager:function(a){return a||(a={}),edges.Pager.prototype=edges.newComponent(a),new edges.Pager(a)},Pager:function(a){this.defaultRenderer=a.defaultRenderer||"newPagerRenderer",this.from=!1,this.to=!1,this.total=!1,this.page=!1,this.pageSize=!1,this.totalPages=!1,this.synchronise=function(){this.from=!1,this.to=!1,this.total=!1,this.page=!1,this.pageSize=!1,this.totalPages=!1,this.edge.currentQuery&&(this.from=parseInt(this.edge.currentQuery.getFrom())+1,this.pageSize=parseInt(this.edge.currentQuery.getSize())),this.edge.result&&(this.total=this.edge.result.total()),this.from!==!1&&this.total!==!1&&(this.to=this.from+this.pageSize-1,this.page=Math.ceil((this.from-1)/this.pageSize)+1,this.totalPages=Math.ceil(this.total/this.pageSize))},this.setFrom=function(a){var b=this.edge.cloneQuery();a-=1,a<0&&(a=0),b.from=a,this.edge.pushQuery(b),this.edge.doQuery()},this.setSize=function(a){var b=this.edge.cloneQuery();b.size=a,this.edge.pushQuery(b),this.edge.doQuery()},this.decrementPage=function(){var a=this.from-this.pageSize;this.setFrom(a)},this.incrementPage=function(){var a=this.from+this.pageSize;this.setFrom(a)},this.goToPage=function(a){var b=a.page,c=(b-1)*this.pageSize+1;this.setFrom(c)}},newSearchingNotification:function(a){return a||(a={}),edges.SearchingNotification.prototype=edges.newComponent(a),new edges.SearchingNotification(a)},SearchingNotification:function(a){this.defaultRenderer=a.defaultRenderer||"newSearchingNotificationRenderer",this.searching=!1,this.init=function(a){Object.getPrototypeOf(this).init.call(this,a),a.context.on("edges:pre-query",edges.eventClosure(this,"searchingBegan")),a.context.on("edges:query-fail",edges.eventClosure(this,"searchingFinished")),a.context.on("edges:query-success",edges.eventClosure(this,"searchingFinished"))},this.draw=function(){},this.searchingBegan=function(){this.searching=!0,this.renderer.draw()},this.searchingFinished=function(){this.searching=!1,this.renderer.draw()}},newResultsDisplay:function(a){return a||(a={}),edges.ResultsDisplay.prototype=edges.newComponent(a),new edges.ResultsDisplay(a)},ResultsDisplay:function(a){this.category=a.category||"results",this.defaultRenderer=a.defaultRenderer||"newResultsDisplayRenderer",this.results=!1,this.synchronise=function(){this.results=[],this.edge.result&&(this.results=this.edge.result.results())}}}),$.extend(edges,{newChart:function(a){return a||(a={}),edges.Chart.prototype=edges.newComponent(a),new edges.Chart(a)},Chart:function(a){this.category=a.category||"chart",this.display=a.display||"",this.dataSeries=a.dataSeries||!1,this.dataFunction=a.dataFunction||!1,this.dataFunctionClosure=a.dataFunctionClosure||!1,this.aggregations=a.aggregations||[],this.dfArgs=a.dfArgs||{useAggregations:[],seriesKeys:{}},this.defaultRenderer=a.defaultRenderer||"newMultibarRenderer",this.init=function(a){edges.newComponent().init.call(this,a);for(var b=0;b<this.aggregations.length;b++){var c=this.aggregations[b];$.inArray(c.name,this.dfArgs.useAggregations)===-1&&this.dfArgs.useAggregations.push(c.name)}this.aggregations.length>0&&this.dataFunctionClosure&&(this.dataFunction=this.dataFunctionClosure(this.dfArgs))},this.contrib=function(a){for(var b=0;b<this.aggregations.length;b++)a.addAggregation(this.aggregations[b])},this.synchronise=function(){this.dataFunction&&(this.dataSeries=this.dataFunction(this))}},ChartDataFunctions:{terms:function(a){var b=a.useAggregations||[],c=a.seriesKeys||{};return function(a){var d=[];if(!a.edge.result)return d;for(var e=0;e<b.length;e++){var f=b[e],g=a.edge.result.data.aggregations[f].buckets,h={};h.key=c[f],h.values=[];for(var i=0;i<g.length;i++){var j=g[i].doc_count,k=g[i].key;h.values.push({label:k,value:j})}d.push(h)}return d}},termsStats:function(a){var b=a.useAggregations||[],c=a.seriesKeys||{},d=a.seriesFor||[];return function(a){var e=[];if(!a.edge.result)return e;for(var f=0;f<b.length;f++)for(var g=b[f],h=g.split(" "),i=0;i<d.length;i++){var j=d[i],k={};k.key=c[g+" "+j],k.values=[];for(var l=a.edge.result.data.aggregations[h[0]].buckets,m=0;m<l.length;m++){var n=l[m][h[1]],o=l[m].key,p=n[j];k.values.push({label:o,value:p})}e.push(k)}return e}},recordsXY:function(a){var b=a.x,c=void 0===a.x_default?0:a.x_default,d=a.y,e=void 0===a.y_default?0:a.y_default,f=a.key;return function(a){var g=[];if(!a.edge.result)return g;var h={};h.key=f,h.values=[];for(var i=a.edge.result.results(),j=0;j<i.length;j++){var k=i[j],l=edges.objVal(b,k,c),m=edges.objVal(d,k,e);h.values.push({label:l,value:m})}return g.push(h),g}},cumulativeXY:function(a){var b=a.x,c=void 0===a.x_default?0:a.x_default,d=a.y,e=void 0===a.y_default?0:a.y_default,f=a.key,g=a.accumulate||"y";return function(a){var h=[];if(!a.edge.result)return h;var i={};i.key=f,i.values=[];for(var j=0,k=a.edge.result.results(),l=0;l<k.length;l++){var m=k[l],n=edges.objVal(b,m,c),o=edges.objVal(d,m,e);"x"===g?(j+=n,i.values.push({label:j,value:o})):"y"===g&&(j+=o,i.values.push({label:n,value:j}))}return h.push(i),h}},totalledList:function(a){var b=a.listPath||"",c=a.seriesKey||"",d=a.keyField||!1,e=a.valueField||!1;return function(a){var f=[];if(!a.edge.result)return f;var g={};g.key=c,g.values=[];for(var h={},i=a.edge.result.results(),j=0;j<i.length;j++)for(var k=i[j],l=edges.objVal(b,k,[]),m=0;m<l.length;m++){var n=l[m],o=edges.objVal(d,n,!1),p=edges.objVal(e,n,0);o in h?h[o]+=p:h[o]=p}for(o in h){var q=h[o];g.values.push({label:o,value:q})}return f.push(g),f}}},newPieChart:function(a){return a||(a={}),edges.PieChart.prototype=edges.newChart(a),new edges.PieChart(a)},PieChart:function(a){this.defaultRenderer=a.defaultRenderer||"newPieChartRenderer"},newHorizontalMultibar:function(a){return a||(a={}),edges.HorizontalMultibar.prototype=edges.newChart(a),new edges.HorizontalMultibar(a)},HorizontalMultibar:function(a){this.defaultRenderer=a.defaultRenderer||"newHorizontalMultibarRenderer"},newMultibar:function(a){return a||(a={}),edges.Multibar.prototype=edges.newChart(a),new edges.Multibar(a)},Multibar:function(a){this.defaultRenderer=a.defaultRenderer||"newMultibarRenderer"},newSimpleLineChart:function(a){return a||(a={}),edges.SimpleLineChart.prototype=edges.newChart(a),new edges.SimpleLineChart(a)},SimpleLineChart:function(a){this.xAxisLabel=a.xAxisLabel||"",this.yAxisLabel=a.yAxisLabel||"",this.defaultRenderer=a.defaultRenderer||"newSimpleLineChartRenderer"},newChartsTable:function(a){return a||(a={}),edges.ChartsTable.prototype=edges.newComponent(a),new edges.ChartsTable(a)},ChartsTable:function(a){this.chartComponents=edges.getParam(a.chartComponents,!1),this.tabularise=edges.getParam(a.tabularise,!1),this.defaultRenderer=a.defaultRenderer||"newChartsTableRenderer",this.results=[],this.synchronise=function(){if(this.results=[],this.chartComponents){for(var a=[],b=0;b<this.edge.components.length;b++){var c=this.edge.components[b];$.inArray(c.id,this.chartComponents)>-1&&a.push(c)}this.tabularise&&(this.results=this.tabularise(a))}}}}),$.extend(edges,{newRefiningANDTermSelector:function(a){return a||(a={}),edges.RefiningANDTermSelector.prototype=edges.newSelector(a),new edges.RefiningANDTermSelector(a)},RefiningANDTermSelector:function(a){this.size=a.size||10,this.orderBy=a.orderBy||"count",this.orderDir=a.orderDir||"desc",this.deactivateThreshold=a.deactivateThreshold||!1,this.ignoreEmptyString=a.ignoreEmptyString||!0,this.excludePreDefinedFilters=a.excludePreDefinedFilters||!0,this.valueMap=a.valueMap||!1,this.valueFunction=a.valueFunction||!1,this.inflation=a.inflation||100,this.defaultRenderer=a.defaultRenderer||"newRefiningANDTermSelectorRenderer",this.filters=[],this.values=!1,this.contrib=function(a){var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir};this.size&&(b.size=this.size),a.addAggregation(es.newTermsAggregation(b))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result){var a=this.edge.result.buckets(this.id);a.length<this.deactivateThreshold?this.active=!1:this.active=!0;var b=[];this.excludePreDefinedFilters&&this.edge.baseQuery&&(b=this.edge.baseQuery.listMust(es.TermFilter({field:this.field})));for(var c=0,d=0;d<a.length;d++){var e=a[d];if(!this.ignoreEmptyString||""!==e.key){if(this.excludePreDefinedFilters){for(var f=!1,g=0;g<b.length;g++){var h=b[g];if(e.key===h.value){f=!0;break}}if(f)continue}if(c++,c>this.size)break;var i=this._translate(e.key),j={display:i,term:e.key,count:e.doc_count};this.values.push(j)}}}for(var k=this.edge.currentQuery.listMust(es.newTermFilter({field:this.field})),d=0;d<k.length;d++){var l=k[d].value;l=this._translate(l),this.filters.push({display:l,term:k[d].value})}},this.selectTerm=function(a){var b=this.edge.cloneQuery(),c=b.removeMust(es.newTermFilter({field:this.field,value:a}));return!(c>0)&&(b.addMust(es.newTermFilter({field:this.field,value:a})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery(),!0)},this.removeFilter=function(a){var b=this.edge.cloneQuery();b.removeMust(es.newTermFilter({field:this.field,value:a})),b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this.changeSize=function(a){this.size=a;var b=this.edge.cloneQuery(),c=b.getAggregation({name:this.id});c.size=this.size,this.edge.pushQuery(b),this.edge.doQuery()},this.changeSort=function(a,b){this.orderBy=a,this.orderDir=b;var c=this.edge.cloneQuery(),d=c.getAggregation({name:this.id});d.setOrdering(this.orderBy,this.orderDir),this.edge.pushQuery(c),this.edge.doQuery()},this._translate=function(a){if(this.valueMap){if(a in this.valueMap)return this.valueMap[a]}else if(this.valueFunction)return this.valueFunction(a);return a}},newORTermSelector:function(a){return a||(a={}),edges.ORTermSelector.prototype=edges.newSelector(a),new edges.ORTermSelector(a)},ORTermSelector:function(a){this.lifecycle=edges.getParam(a.lifecycle,"static"),this.orderBy=edges.getParam(a.orderBy,"term"),this.orderDir=edges.getParam(a.orderDir,"asc"),this.size=edges.getParam(a.size,10),this.valueMap=edges.getParam(a.valueMap,!1),this.valueFunction=edges.getParam(a.valueFunction,!1),this.defaultRenderer=edges.getParam(a.defaultRenderer,"newORTermSelectorRenderer"),this.terms=edges.getParam(a.terms,!1),this.selected=[],this.updating=!1,this.init=function(a){edges.newSelector().init.call(this,a),this.terms||this.listAll()},this.synchronise=function(){this.selected=[];for(var a=this.edge.currentQuery.listMust(es.newTermsFilter({field:this.field})),b=0;b<a.length;b++)for(var c=0;c<a[b].values.length;c++){var d=a[b].values[c];this.selected.push(d)}},this.listAll=function(){var a=this.edge.cloneBaseQuery();a.clearAggregations(),a.size=0;var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};a.addAggregation(es.newTermsAggregation(b)),es.doQuery({search_url:this.edge.search_url,queryobj:a.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"listAllQuerySuccess",["result"]),error:edges.objClosure(this,"listAllQueryFail")})},this.listAllQuerySuccess=function(a){var b=a.result;this.terms=[];for(var c=b.buckets(this.id),d=0;d<c.length;d++){var e=c[d];this.terms.push({term:e.key,display:this._translate(e.key),count:e.doc_count})}this.setupEvent(),this.draw()},this.listAllQueryFail=function(){this.terms=[]},this.setupEvent=function(){"update"===this.lifecycle&&this.edge.context.on("edges:pre-query",edges.eventClosure(this,"doUpdate"))},this.doUpdate=function(){if(!this.updating){this.udpating=!0;var a=this.edge.cloneQuery();a.removeMust(es.newTermsFilter({field:this.field})),a.clearAggregations(),a.size=0;var b={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};a.addAggregation(es.newTermsAggregation(b)),es.doQuery({search_url:this.edge.search_url,queryobj:a.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"doUpdateQuerySuccess",["result"]),error:edges.objClosure(this,"doUpdateQueryFail")})}},this.doUpdateQuerySuccess=function(a){for(var b=a.result,c=b.buckets(this.id),d=0;d<this.terms.length;d++){for(var e=this.terms[d],f=!1,g=0;g<c.length;g++){var h=c[g];if(e.term===h.key){e.count=h.doc_count,f=!0;break}}f||(e.count=0)}this.updating=!1,this.draw()},this.doUpdateQueryFail=function(){},this.selectTerms=function(a){var b=a.terms,c=edges.getParam(a.clearOthers,!1),d=this.edge.cloneQuery(),e=d.listMust(es.newTermsFilter({field:this.field
}));if(e.length>0){var f=e[0];c&&f.clear_terms();for(var g=0,h=0;h<b.length;h++){var i=b[h];f.has_term(i)?g++:f.add_term(i)}if(f.has_terms()&&g==b.length)return!1;f.has_terms()||d.removeMust(es.newTermsFilter({field:this.field}))}else d.addMust(es.newTermsFilter({field:this.field,values:b}));return d.from=0,this.edge.pushQuery(d),this.edge.doQuery(),!0},this.selectTerm=function(a){return this.selectTerms({terms:[a]})},this.removeFilter=function(a){var b=this.edge.cloneQuery(),c=b.listMust(es.newTermsFilter({field:this.field}));if(c.length>0){var d=c[0];d.has_term(a)&&d.remove_term(a),d.has_terms()||b.removeMust(es.newTermsFilter({field:this.field}))}b.from=0,this.edge.pushQuery(b),this.edge.doQuery()},this._translate=function(a){if(this.valueMap){if(a in this.valueMap)return this.valueMap[a]}else if(this.valueFunction)return this.valueFunction(a);return a}},newBasicRangeSelector:function(a){return a||(a={}),edges.BasicRangeSelector.prototype=edges.newSelector(a),new edges.BasicRangeSelector(a)},BasicRangeSelector:function(a){this.ranges=a.ranges||[],this.formatUnknown=a.formatUnknown||!1,this.defaultRenderer=a.defaultRenderer||"newBasicRangeSelectorRenderer",this.values=[],this.filters=[],this.contrib=function(a){for(var b=[],c=0;c<this.ranges.length;c++){var d=this.ranges[c],e={};d.from&&(e.from=d.from),d.to&&(e.to=d.to),b.push(e)}a.addAggregation(es.newRangeAggregation({name:this.id,field:this.field,ranges:b}))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result)for(var a=this.edge.result.buckets(this.id),b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=this._getRangeBucket(a,c.from,c.to),e=$.extend(!0,{},c);e.count=d.doc_count,this.values.push(e)}if(this.edge.currentQuery)for(var f=this.edge.currentQuery.listMust(es.newRangeFilter({field:this.field})),b=0;b<f.length;b++){var g=f[b].lt,h=f[b].gte,c=this._getRangeDef(h,g);c?this.filters.push(c):this.filters.push({display:this._formatUnknown(h,g),from:h,to:g})}},this.selectRange=function(a,b){var c=this.edge.cloneQuery(),d={field:this.field};a&&(d.gte=a),b&&(d.lt=b),c.addMust(es.newRangeFilter(d)),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this.removeFilter=function(a,b){var c=this.edge.cloneQuery(),d={field:this.field};a&&(d.gte=a),b&&(d.lt=b),c.removeMust(es.newRangeFilter(d)),c.from=0,this.edge.pushQuery(c),this.edge.doQuery()},this._getRangeDef=function(a,b){for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c],e=!0,f=!0;if((a&&!d.from||!a&&d.from)&&(e=!1),(b&&!d.to||!b&&d.to)&&(f=!1),a&&d.from&&a!==d.from&&(e=!1),b&&d.to&&b!==d.to&&(f=!1),e&&f)return d}return!1},this._getRangeBucket=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d],f=!0,g=!0;if((b&&!e.from||!b&&e.from)&&(f=!1),(c&&!e.to||!c&&e.to)&&(g=!1),b&&e.from&&b!==e.from&&(f=!1),c&&e.to&&c!==e.to&&(g=!1),f&&g)return e}return!1},this._formatUnknown=function(a,b){if(this.formatUnknown)return this.formatUnknown(a,b);var c="";return c+=a?a:"< ",b?c+=a?" - "+b:b:a?c+="+":c="unknown",c}},newBasicGeoDistanceRangeSelector:function(a){return a||(a={}),edges.BasicGeoDistanceRangeSelector.prototype=edges.newSelector(a),new edges.BasicGeoDistanceRangeSelector(a)},BasicGeoDistanceRangeSelector:function(a){this.distances=a.distances||[],this.hideEmptyDistance=a.hideEmptyDistance||!0,this.unit=a.unit||"m",this.lat=a.lat||!1,this.lon=a.lon||!1,this.values=[],this.synchronise=function(){this.values=[]}},newDateHistogramSelector:function(a){return a||(a={}),edges.BasicRangeSelector.prototype=edges.newSelector(a),new edges.BasicRangeSelector(a)},DateHistogramSelector:function(a){this.interval=a.interval||"year",this.sort=a.sort||"asc",this.hideEmptyDateBin=a.hideEmptyDateBin||!0,this.shortDisplay=a.shortDisplay||!1,this.values=[],this.synchronise=function(){this.values=[]}},newAutocompleteTermSelector:function(a){return a||(a={}),edges.AutocompleteTermSelector.prototype=edges.newComponent(a),new edges.AutocompleteTermSelector(a)},AutocompleteTermSelector:function(a){this.defaultRenderer=a.defaultRenderer||"newAutocompleteTermSelectorRenderer"}}),$.extend(muk,{institution:{newInstitutionReportTemplate:function(a){return a||(a={}),muk.institution.InstitutionReportTemplate.prototype=edges.newTemplate(a),new muk.institution.InstitutionReportTemplate(a)},InstitutionReportTemplate:function(a){this.edge=!1,this.hidden={},this.tabIds=[],this.namespace="muk-institution-report-template",this.draw=function(a){this.edge=a;var b="See the amount of APCs, total APC expenditure, or average APC cost for several institutions for a given period. Filter by publisher or journal type. Examples of how to use this report:                <ul>                    <li>Compare the number of APCs paid by similar institutions</li>                    <li>See overall expenditure with a specific publisher for a group of institutions</li>                    <li>Compare average APC to see how an institution benefits from offsetting deals</li>                </ul>",c=edges.css_classes(this.namespace,"panel"),d=edges.css_classes(this.namespace,"top"),e=edges.css_classes(this.namespace,"filters"),f=edges.css_classes(this.namespace,"filter"),g=edges.css_classes(this.namespace,"tabview"),h=edges.css_classes(this.namespace,"tab-container"),i=edges.css_classes(this.namespace,"tab-bar"),j=edges.css_classes(this.namespace,"tab"),k=edges.css_classes(this.namespace,"stories"),l=edges.css_classes(this.namespace,"data"),m=edges.css_classes(this.namespace,"filter-header"),n=edges.css_classes(this.namespace,"loading"),o=a.category("loading"),p="";if(o.length>0)for(var q=0;q<o.length;q++)p+='<div class="row"><div class="col-md-12"><div id="'+o[q].id+'"></div></div></div>';var r=a.category("top-right"),s="";if(r.length>0)for(var q=0;q<r.length;q++)s+='<div class="row"><div class="col-md-12"><div id="'+r[q].id+'"></div></div></div>';s='<div class="row"><div class="col-md-8 report-intro-text">'+b+'</div><div class="col-md-4">'+s+"</div></div>";for(var t=a.category("lhs"),u="",q=0;q<t.length;q++)u+='<div class="'+f+'" id="'+t[q].id+'"></div>';for(var v=a.category("tab"),w="",x="",q=0;q<v.length;q++){var y=v[q],z=edges.css_id(this.namespace,"tab-"+y.id),A=edges.css_id(this.namespace,"link-"+y.id);this.tabIds.push(y.id),w+='<li><a href="#" id="'+A+'" data-id="'+y.id+'">'+y.display+"</a></li>",x+='<div class="'+h+'" id="'+z+'">                            <div class="row">                                <div class="col-md-12">                                     <div class="'+j+'" id="'+y.id+'"></div>                                </div>                             </div>                        </div>'}w='Show:&nbsp;&nbsp;<ul class="nav nav-tabs navbar-right">'+w+"</ul>";var B=a.category("story"),C="";if(B.length>0)for(var q=0;q<B.length;q++)C+='<div class="row"><div class="col-md-12"><div id="'+B[q].id+'"></div></div></div>';var D=a.category("data"),E="";if(D.length>0)for(var q=0;q<D.length;q++)E+='<div class="row"><div class="col-md-12"><div id="'+D[q].id+'"></div></div></div>';var F='<div class="'+m+'"><div class="row"><div class="col-md-12"><span class="glyphicon glyphicon-filter"></span>&nbsp;FILTER</div></div></div>',G='<div class="'+c+'">                     <div class="'+n+'">'+p+'</div>                    <div class="'+d+'">'+s+'</div>                    <div class="row">                        <div class="col-md-3">                            <div class="'+e+'">'+F+u+'</div>                        </div>                        <div class="col-md-9">                            <div class="'+g+'">                                <div class="'+i+'"><div class="row"><div class="col-md-12">'+w+"</div></div></div>                                "+x+'                            </div>                        </div>                    </div>                    <div class="'+k+'">'+C+'</div>                    <div class="'+l+'">'+E+"</div>                </div>";a.context.html(G);for(var q=0;q<this.tabIds.length;q++){var H=edges.css_id_selector(this.namespace,"tab-"+this.tabIds[q]);this.hideOffScreen(H)}var I=this.tabIds[0];this.activateTab(I);for(var q=0;q<this.tabIds.length;q++){var J=edges.css_id_selector(this.namespace,"link-"+this.tabIds[q]);edges.on(J,"click",this,"tabClicked")}},this.hideOffScreen=function(a){if(!(a in this.hidden)){var b=this.edge.jq(a);this.hidden[a]={position:b.css("position"),margin:b.css("margin-left")},b.css("position","absolute").css("margin-left",-9999)}},this.bringIn=function(a){if(this.hidden[a]){var b=this.hidden[a].position,c=this.hidden[a].margin,d=this.edge.jq(a);d.css("position",b).css("margin-left",c),delete this.hidden[a]}},this.activateTab=function(a){for(var b=this.edge.category("tab"),c=0;c<b.length;c++){var d=b[c],e=edges.css_id_selector(this.namespace,"tab-"+d.id),f=edges.css_id_selector(this.namespace,"link-"+d.id);d.id===a?(this.bringIn(e),this.edge.jq(f).parent().addClass("active")):(this.hideOffScreen(e),this.edge.jq(f).parent().removeClass("active"))}},this.tabClicked=function(a){var b=$(a).attr("data-id");this.activateTab(b)}},newStory:function(a){return a||(a={}),muk.institution.Story.prototype=edges.newComponent(a),new muk.institution.Story(a)},Story:function(a){this.countMax=!1,this.countAvg=!1,this.totalMin=!1,this.totalMax=!1,this.totalAvg=!1,this.avgMin=!1,this.avgMax=!1,this.avgAvg=!1,this.synchronise=function(){this.countMax=!1,this.countAvg=!1,this.totalMin=!1,this.totalMax=!1,this.totalAvg=!1,this.avgMin=!1,this.avgMax=!1,this.avgAvg=!1;var a=this.edge.secondaryResults.avg,b=a.aggregation("inst_count"),c=a.buckets("institutions"),d=a.aggregation("general_stats");c.length>0?this.countMax=c[0].doc_count:this.countMax=0,b.value>0?(this.countAvg=a.total()/b.value,this.totalAvg=d.sum/b.value):(this.countAvg=0,this.totalAvg=0);for(var e=0;e<c.length;e++){var f=c[e],g=f.inst_stats.sum,h=f.inst_stats.avg;(this.totalMin===!1||g<this.totalMin)&&(this.totalMin=g),(this.totalMax===!1||g>this.totalMax)&&(this.totalMax=g),(this.avgMin===!1||h<this.avgMin)&&(this.avgMin=h),(this.avgMax===!1||h>this.avgMax)&&(this.avgMax=h)}this.avgAvg=d.avg},this.draw=function(){if(this.countMax===!1||this.countAvg===!1||this.totalMin===!1||this.totalMax===!1||this.totalAvg===!1||this.avgMin===!1||this.avgMax===!1||this.avgAvg===!1)return void this.context.html("");var a="<p>In this time period, an institution may have up to <strong>{{a}}</strong> APCs, with the average being <strong>{{b}}</strong></p>";a+="<p>The least amount spent by any institution was <strong>£{{c}}</strong>, the most was <strong>£{{d}}</strong>, with the average being <strong>£{{e}}</strong></p>",a+="<p>The smallest average APC for an institution was <strong>£{{f}}</strong>, the largest average was <strong>£{{g}}</strong>, and the overall average APC cost is <strong>£{{h}}</strong></p>";var b=muk.toIntFormat();a=a.replace(/{{a}}/g,b(this.countMax)).replace(/{{b}}/g,b(this.countAvg)).replace(/{{c}}/g,b(this.totalMin)).replace(/{{d}}/g,b(this.totalMax)).replace(/{{e}}/g,b(this.totalAvg)).replace(/{{f}}/g,b(this.avgMin)).replace(/{{g}}/g,b(this.avgMax)).replace(/{{h}}/g,b(this.avgAvg)),this.context.html(a)}},averagesQuery:function(a){var b=a.cloneQuery();return b.removeMust(es.newTermsFilter({field:"record.jm:apc.organisation_name.exact"})),b.clearAggregations(),b.addAggregation(es.newTermsAggregation({name:"institutions",field:"record.jm:apc.organisation_name.exact",size:1e4,orderBy:"count",orderDir:"desc",aggs:[es.newStatsAggregation({name:"inst_stats",field:"index.amount_inc_vat"})]})),b.addAggregation(es.newCardinalityAggregation({name:"inst_count",field:"record.jm:apc.organisation_name.exact"})),b.addAggregation(es.newStatsAggregation({name:"general_stats",field:"index.amount_inc_vat"})),b.size=0,b.from=0,b},reportDF:function(a){var b=a.chart,c=a.valueFunction,d=a.seriesKey,e=0,f=[];if(!b.edge.result)return f;var g=b.edge.currentQuery.listMust(es.newTermsFilter({field:"record.jm:apc.organisation_name.exact"}));0==g.length&&(e=10);var h={};h.key=d,h.values=[];for(var i=[],j=b.edge.result.buckets("institution"),k=0;k<j.length&&!(e>0&&k>=e);k++){for(var l=j[k],m=l.key,n=!1,o=0;o<g.length;o++){var p=g[o];if(!p.has_term(m)){n=!0;break}}if(!n){var q=c(l);h.values.push({label:m,value:q}),i.push(m)}}for(var k=0;k<g.length;k++)for(var p=g[k],o=0;o<p.values.length;o++){var r=p.values[o];$.inArray(r,i)===-1&&h.values.push({label:r,value:0})}return f.push(h),f},apcCountDF:function(a){return muk.institution.reportDF({chart:a,seriesKey:"Number of APCs",valueFunction:function(a){return a.doc_count}})},apcExpenditureDF:function(a){return muk.institution.reportDF({chart:a,seriesKey:"Total expenditure",valueFunction:function(a){return a.institution_stats.sum}})},avgAPCDF:function(a){return muk.institution.reportDF({chart:a,seriesKey:"Average APC Cost",valueFunction:function(a){return a.institution_stats.avg}})},tableData:function(a){for(var b={apc_count:"APC Count",total_expenditure:"Total expenditure",mean:"Average APC cost"},c=muk.toIntFormat(),d={},e=0;e<a.length;e++){var f=a[e];if(f.dataSeries)for(var g=f.dataSeries,h=0;h<g.length;h++)for(var i=g[h],j=0;j<i.values.length;j++){var k=i.values[j],l=k.label,m=k.value,n={};l in d&&(n=d[l]);var o=b[f.id];n[o]=c(m),d[l]=n}}var p=Object.keys(d);p.sort();for(var q=[],e=0;e<p.length;e++){var r=d[p[e]];r.Institution=p[e],q.push(r)}return q},makeInstitutionReport:function(a){a||(a={});var b=es.newQuery();b.addMust(es.newTermsFilter({field:"record.jm:apc.organisation_name.exact",values:[myInstituion]})),b.size=0,es.doQuery({search_url:octopus.config.public_query_endpoint,queryobj:b.objectify(),success:function(b){0==b.total()&&(myInstituion=!1),muk.institution.makeInstitutionReport2(a)},error:function(){myInstituion=!1,muk.institution.makeInstitutionReport2(a)}})},makeInstitutionReport2:function(a){a||(a={});var b=edges.getParam(a.selector,"#muk_institution"),c=es.newQuery({size:0});c.addAggregation(es.newTermsAggregation({name:"institution",field:"record.jm:apc.organisation_name.exact",size:1e3,aggs:[es.newStatsAggregation({name:"institution_stats",field:"index.amount_inc_vat"}),es.newTermsAggregation({name:"oa_type",field:"record.dc:source.oa_type.exact",size:10})]}));var d=es.newQuery();myInstituion&&""!=myInstituion&&d.addMust(es.newTermsFilter({field:"record.jm:apc.organisation_name.exact",values:[myInstituion]}));var e=edges.newEdge({selector:b,template:muk.institution.newInstitutionReportTemplate(),search_url:octopus.config.public_query_endpoint,baseQuery:c,openingQuery:d,secondaryQueries:{avg:muk.institution.averagesQuery},components:[edges.newMultiDateRangeEntry({id:"date_range",display:"REPORT PERIOD:<br>",fields:[{field:"record.rioxxterms:publication_date",display:"Publication Date"},{field:"record.jm:apc.date_applied",display:"APC Application"},{field:"record.jm:apc.date_paid",display:"APC Paid"}],autoLookupRange:!0,category:"top-right",renderer:edges.bs3.newBSMultiDateRange({ranges:muk.yearRanges({"academic year":"09-01","fiscal year":"04-01","calendar year":"01-01"},{"This ":0,"Last ":1})})}),edges.newORTermSelector({id:"institution",field:"record.jm:apc.organisation_name.exact",display:"Compare Institutions",lifecycle:"static",size:1e4,category:"lhs",renderer:edges.bs3.newORTermSelectorRenderer({open:!0,togglable:!1,showCount:!0,hideEmpty:!0})}),edges.newRefiningANDTermSelector({id:"publisher",field:"record.dcterms:publisher.name.exact",display:"Publisher",size:1e4,category:"lhs",orderBy:"term",orderDir:"asc",renderer:edges.bs3.newRefiningANDTermSelectorRenderer({hideInactive:!0,open:!0,togglable:!1,controls:!1})}),edges.newRefiningANDTermSelector({id:"oa_type",field:"record.dc:source.oa_type.exact",display:"Journal type",category:"lhs",valueMap:{oa:"Pure OA",hybrid:"Hybrid",unknown:"Unknown"},renderer:edges.bs3.newRefiningANDTermSelectorRenderer({open:!0,togglable:!1,controls:!1})}),edges.newHorizontalMultibar({id:"apc_count",display:"Number of APCs",dataFunction:muk.institution.apcCountDF,category:"tab",renderer:edges.nvd3.newHorizontalMultibarRenderer({noDataMessage:"No results match your filter criteria - try changing the date range",legend:!1,valueFormat:muk.toIntFormat(),yAxisLabel:"Number of APCs"})}),edges.newHorizontalMultibar({id:"total_expenditure",display:"Total expenditure",dataFunction:muk.institution.apcExpenditureDF,category:"tab",renderer:edges.nvd3.newHorizontalMultibarRenderer({noDataMessage:"No results match your filter criteria - try changing the date range",legend:!1,valueFormat:muk.toGBPIntFormat(),yTickFormat:muk.toGBPIntFormat(),yAxisLabel:"Total expenditure"})}),edges.newHorizontalMultibar({id:"mean",display:"Average APC Cost",dataFunction:muk.institution.avgAPCDF,category:"tab",renderer:edges.nvd3.newHorizontalMultibarRenderer({noDataMessage:"No results match your filter criteria - try changing the date range",legend:!1,valueFormat:muk.toGBPIntFormat(),yTickFormat:muk.toGBPIntFormat(),yAxisLabel:"Average APC Cost"})}),muk.institution.newStory({id:"story",category:"story"}),edges.newChartsTable({id:"data_table",display:"Raw Data",category:"data",chartComponents:["apc_count","total_expenditure","mean"],tabularise:muk.institution.tableData,renderer:edges.bs3.newTabularResultsRenderer({fieldDisplay:[{field:"Institution",display:"Institution"}],displayListedOnly:!1,download:!0,downloadText:"download as csv"})}),edges.newSearchingNotification({id:"loading-bar",category:"loading"})]});muk.activeEdges[b]=e}}}),$.extend(!0,edges,{bs3:{newRefiningANDTermSelectorRenderer:function(a){return a||(a={}),edges.bs3.RefiningANDTermSelectorRenderer.prototype=edges.newRenderer(a),new edges.bs3.RefiningANDTermSelectorRenderer(a)},RefiningANDTermSelectorRenderer:function(a){this.hideInactive=edges.getParam(a.hideInactive,!1),this.controls=edges.getParam(a.controls,!0),this.open=edges.getParam(a.open,!1),this.togglable=edges.getParam(a.togglable,!0),this.showSelected=edges.getParam(a.showSelected,!0),this.sortCycle=edges.getParam(a.sortCycle,["count desc","count asc","term desc","term asc"]),this.namespace="edges-bs3-refiningand-term-selector",this.draw=function(){var a=this.component,b=this.namespace,c=edges.css_classes(b,"results-list",this),d=edges.css_classes(b,"result",this),e=edges.css_classes(b,"value",this),f=edges.css_classes(b,"controls",this),g=edges.css_classes(b,"filter-remove",this),h=edges.css_classes(b,"facet",this),i=edges.css_classes(b,"header",this),j=edges.css_classes(b,"selected",this),k=edges.css_id(b,"controls",this),l=edges.css_id(b,"size",this),m=edges.css_id(b,"order",this),n=edges.css_id(b,"toggle",this),o=edges.css_id(b,"results",this),p=edges.css_classes(b,"count",this),q="Loading...";if(a.values!==!1&&(q="No data available"),a.values&&a.values.length>0){q="";for(var r=[],s=0;s<a.filters.length;s++)r.push(a.filters[s].term.toString());for(var s=0;s<a.values.length;s++){var t=a.values[s];$.inArray(t.term.toString(),r)===-1&&(q+='<div class="form '+d+'"><div class="form-fields__item-checkbox '+e+'" data-key="'+edges.escapeHtml(t.term)+'"><label><input type="checkbox" /> '+edges.escapeHtml(t.display),q+=' <span class="'+p+'">('+t.count+")</span>",q+="</label></div></div>")}}var u="";if(this.controls){u='<div class="'+f+'" style="display:none" id="'+k+'"><div class="row">                         <div class="col-md-12">                            <div class="btn-group">                                <button type="button" class="btn btn-default btn-sm" id="'+l+'" title="List Size" href="#">0</button>                                 <button type="button" class="btn btn-default btn-sm" id="'+m+'" title="List Order" href="#"></button>                             </div>                        </div>                    </div></div>'}var v="";if(a.filters.length>0&&this.showSelected)for(var s=0;s<a.filters.length;s++){var w=a.filters[s];q+='<div class="form '+d+'"><div class="form-fields__item-checkbox '+g+'" data-key="'+edges.escapeHtml(w.term)+'"><label><input type="checkbox" checked/> '+edges.escapeHtml(w.display),q+="</label></div></div>"}var x=a.display;this.togglable&&(x='<a href="#" id="'+n+'"><i class="glyphicon glyphicon-plus"></i>&nbsp;'+x+"</a>");var y='<div class="'+h+'">                        <div class="'+i+'"><div class="row">                             <div class="col-md-12">                                '+x+'                            </div>                        </div></div>                        {{CONTROLS}}                        <div class="row" style="display:none" id="'+o+'">                            <div class="col-md-12">                                <div class="'+j+'">{{SELECTED}}</div>                                <div class="'+c+'">{{RESULTS}}</div>                            </div>                        </div></div>';y=y.replace(/{{RESULTS}}/g,q).replace(/{{CONTROLS}}/g,u).replace(/{{SELECTED}}/g,v),a.context.html(y),this.setUISize(),this.setUISort(),this.setUIOpen();var z=edges.css_class_selector(b,"value",this),A=edges.css_class_selector(b,"filter-remove",this),B=edges.css_id_selector(b,"toggle",this),C=edges.css_id_selector(b,"size",this),D=edges.css_id_selector(b,"order",this);edges.on(z,"click",this,"termSelected"),edges.on(B,"click",this,"toggleOpen"),edges.on(A,"click",this,"removeFilter"),edges.on(C,"click",this,"changeSize"),edges.on(D,"click",this,"changeSort")},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"results",this),b=edges.css_id_selector(this.namespace,"controls",this),c=edges.css_id_selector(this.namespace,"toggle",this),d=this.component.jq(a),e=this.component.jq(b),f=this.component.jq(c);this.open?(f.find("i").removeClass("glyphicon-plus").addClass("glyphicon-minus"),e.show(),d.show()):(f.find("i").removeClass("glyphicon-minus").addClass("glyphicon-plus"),e.hide(),d.hide())},this.setUISize=function(){var a=edges.css_id_selector(this.namespace,"size",this);this.component.jq(a).html(this.component.size)},this.setUISort=function(){var a=edges.css_id_selector(this.namespace,"order",this),b=this.component.jq(a);"count"===this.component.orderBy?"asc"===this.component.orderDir?b.html('count <i class="glyphicon glyphicon-arrow-down"></i>'):"desc"===this.component.orderDir&&b.html('count <i class="glyphicon glyphicon-arrow-up"></i>'):"term"===this.component.orderBy&&("asc"===this.component.orderDir?b.html('a-z <i class="glyphicon glyphicon-arrow-down"></i>'):"desc"===this.component.orderDir&&b.html('a-z <i class="glyphicon glyphicon-arrow-up"></i>'))},this.termSelected=function(a){var b=this.component.jq(a).attr("data-key");this.component.selectTerm(b)},this.removeFilter=function(a){var b=this.component.jq(a).attr("data-key");this.component.removeFilter(b)},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this.changeSize=function(a){var b=prompt("Currently displaying "+this.component.size+" results per page. How many would you like instead?");b&&this.component.changeSize(parseInt(b))},this.changeSort=function(a){var b=this.component.orderBy+" "+this.component.orderDir,c=$.inArray(b,this.sortCycle),d=this.sortCycle[(c+1)%4],e=d.split(" ");this.component.changeSort(e[0],e[1])}}}}),$.extend(!0,edges,{bs3:{newORTermSelectorRenderer:function(a){return a||(a={}),edges.bs3.ORTermSelectorRenderer.prototype=edges.newRenderer(a),new edges.bs3.ORTermSelectorRenderer(a)},ORTermSelectorRenderer:function(a){this.open=edges.getParam(a.open,!1),this.togglable=edges.getParam(a.togglable,!0),this.showCount=edges.getParam(a.showCount,!1),this.hideEmpty=edges.getParam(a.hideEmpty,!1),this.openIcon=edges.getParam(a.openIcon,"glyphicon glyphicon-plus"),this.closeIcon=edges.getParam(a.closeIcon,"glyphicon glyphicon-minus"),this.layout=edges.getParam(a.layout,"left"),this.namespace="edges-bs3-or-term-selector",this.draw=function(){var b=this.component,c=this.namespace,d=edges.css_classes(c,"result",this),e=edges.css_classes(c,"value",this),f=edges.css_classes(c,"filter-remove",this),g=edges.css_classes(c,"facet",this),h=edges.css_classes(c,"header",this),i=edges.css_classes(c,"selections",this),j=edges.css_classes(c,"body",this),k=edges.css_classes(c,"count",this),l=edges.css_id(c,"toggle",this),m=edges.css_id(c,"results",this);this.showCount=edges.getParam(a.showCount,!1);var n="Loading...";if(b.terms.length>0){n="";for(var o=0;o<b.terms.length;o++){var p=b.terms[o];0===p.count&&this.hideEmpty||($.inArray(p.term.toString(),b.selected)!==-1?(n+='<div class="form '+d+'"><div class="form-fields__item-checkbox '+f+'" data-key="'+edges.escapeHtml(p.term)+'"><label><input type="checkbox" checked/> '+edges.escapeHtml(p.display),this.showCount&&(n+=' <span class="'+k+'">('+p.count+")</span>"),n+="</label></div></div>"):(n+='<div class="form '+d+'"><div class="form-fields__item-checkbox '+e+'" data-key="'+edges.escapeHtml(p.term)+'"><label><input type="checkbox" /> '+edges.escapeHtml(p.display),this.showCount&&(n+=' <span class="'+k+'">('+p.count+")</span>"),n+="</label></div></div>"))}}var q=this.headerLayout({toggleId:l}),r='<div class="'+g+'">                        <div class="'+h+'"><div class="row">                             <div class="col-md-12">                                '+q+'                            </div>                        </div></div>                        <div class="'+j+'">                            <div class="row" style="display:none" id="'+m+'">                                                                <div class="col-md-12"><div class="'+i+'">                                    {{RESULTS}}                                </div>                            </div>                        </div>                        </div></div>';r=r.replace(/{{RESULTS}}/g,n),b.context.html(r),this.setUIOpen();var s=edges.css_class_selector(c,"value",this),t=edges.css_class_selector(c,"filter-remove",this),u=edges.css_id_selector(c,"toggle",this);edges.on(s,"click",this,"termSelected"),edges.on(u,"click",this,"toggleOpen"),edges.on(t,"click",this,"removeFilter")},this.headerLayout=function(a){var b=a.toggleId,c=edges.css_classes(this.namespace,"icon",this);if("left"===this.layout){var d=this.component.display;return this.togglable&&(d='<a href="#" id="'+b+'"><i class="'+this.openIcon+'"></i>&nbsp;'+d+"</a>"),d}if("right"===this.layout){var d="";return d=this.togglable?'<a href="#" id="'+b+'">'+this.component.display+'&nbsp;<i class="'+this.openIcon+" "+c+'"></i></a>':this.component.display}},this.setUIOpen=function(){var a=edges.css_id_selector(this.namespace,"results",this),b=edges.css_id_selector(this.namespace,"toggle",this),c=this.component.jq(a),d=this.component.jq(b),e=this.openIcon.split(" "),f=this.closeIcon.split(" ");if(this.open){for(var g=d.find("i"),h=0;h<e.length;h++)g.removeClass(e[h]);for(var h=0;h<f.length;h++)g.addClass(f[h]);c.show()}else{for(var g=d.find("i"),h=0;h<f.length;h++)g.removeClass(f[h]);for(var h=0;h<e.length;h++)g.addClass(e[h]);c.hide()}},this.termSelected=function(a){var b=this.component.jq(a).attr("data-key");this.component.selectTerm(b)},this.removeFilter=function(a){var b=this.component.jq(a).attr("data-key");this.component.removeFilter(b)},this.toggleOpen=function(a){this.open=!this.open,this.setUIOpen()},this._getFilterDef=function(a){for(var b=0;b<this.component.terms.length;b++){var c=this.component.terms[b];if(a===c.term)return c}return!1}}}}),$.extend(edges,{csv:{serialise:function(a){var b=a.data;return Papa.unparse(b,{newline:"\n"})},newObjectByRow:function(a){return a||(a={}),new edges.csv.ObjectByRow(a)},ObjectByRow:function(a){this.sheet=!1,this.filters=[],this.parse=function(a){var b=a.data.replace(/\r\n/g,"\n");this.sheet=Papa.parse(b,{header:!0,newline:"\n",skipEmptyLines:!0})},this.add_filter=function(a){var b=a.filter;this.filters.push(b)},this.clear_filter=function(a){for(var b=a.filter,c=!1,d=0;d<this.filters.length;d++){var e=this.filters[d],f=b.field===e.field,g=b.type===e.type||void 0===b.type,h=void 0===b.value||b.value.toString()===e.value.toString();if(f&&g&&h){c=d;break}}c!==!1&&this.filters.splice(c,1)},this.iterator=function(a){a||(a={});var b=edges.getParam(a.filtered,!0),c=0,d=this;return{next:function(){if(d.sheet.data.length<=c)return!1;for(var a=c;a<d.sheet.data.length;a++){var e=d.sheet.data[a],f=!1;if(f=!b||d._filterMatch({record:e}))return c=a+1,e}return!1}}},this.aggregation=function(a){var b=a.agg,c=Object.keys(b)[0],d=b[c],e=edges.getParam(a.filtered,!0);return"terms"===c?this._termsAggregation({field:d,filtered:e}):[]},this._termsAggregation=function(a){for(var b=a.field,c=edges.getParam(a.filtered,!0),d=[],e={},f=this.iterator({filtered:c}),g=f.next();g;){if(g.hasOwnProperty(b)){var h=g[b];if(h in e)d[e[h]].count++;else{var i=d.length;d.push({term:h,count:1}),e[h]=i}}g=f.next()}return d},this._filterMatch=function(a){for(var b=a.record,c=0;c<this.filters.length;c++){var d=this.filters[c];if("exact"!==d.type)return!1;if(!this._exactFilterMatch({filter:d,record:b}))return!1}return!0},this._exactFilterMatch=function(a){var b=a.filter,c=a.record,d=b.field,e=b.value;return c[d]===e},this.parse(a)}}}),$.extend(!0,edges,{bs3:{newTabularResultsRenderer:function(a){return a||(a={}),edges.bs3.TabularResultsRenderer.prototype=edges.newRenderer(a),new edges.bs3.TabularResultsRenderer(a)},TabularResultsRenderer:function(a){this.noResultsText=a.noResultsText||"No results to display",this.defaultCellContent=a.defaultCellContent||"-",this.fieldDisplay=a.fieldDisplay||[],this.displayListedOnly=edges.getParam(a.displayListedOnly,!0),this.headerOrderingFunction=edges.getParam(a.headerOrderingFunction,!1),this.download=edges.getParam(a.download,!1),this.downloadText=edges.getParam(a.downloadText,"download"),this.downloadPrefix=edges.getParam(a.downloadPrefix,"download"),this.namespace="edges-bs3-tabular-results",this.draw=function(){var a=this.noResultsText;this.component.results===!1&&(a="");var b=this.component.results;if(b&&b.length>0){var c=this._getHeaderRow(),d=edges.css_classes(this.namespace,"table",this),e=edges.css_classes(this.namespace,"header",this),f=edges.css_classes(this.namespace,"cell",this),g=edges.css_classes(this.namespace,"download",this),h=edges.css_classes(this.namespace,"tablediv",this),i=edges.css_id(this.namespace,"download",this),j="";this.download&&(j='<div class="row"><div class="col-md-12"><div class="'+g+'"><a href="#" id="'+i+'">'+edges.escapeHtml(this.downloadText)+"</a></div></div></div>");var a='<div class="table-responsive '+h+'">';a+='<table class="'+d+'"><thead><tr>_HEADERS_</tr></thead><tbody>';for(var k=[],l=0;l<c.length;l++){for(var m=!1,n=0;n<this.fieldDisplay.length;n++){var o=this._getFieldDisplay(c[l]);if(o){k.push(o.display),m=!0;break}}m||k.push(c[l])}for(var p="",l=0;l<k.length;l++){var q=k[l];p+='<th class="'+e+'">'+q+"</th>"}a=a.replace(/_HEADERS_/g,p);for(var l=0;l<b.length;l++){var r=b[l];a+="<tr>";for(var n=0;n<c.length;n++){var s=c[n],t=this.defaultCellContent,o=this._getFieldDisplay(s);o&&(t=o.default);var u=edges.objVal(s,r,t),v=edges.css_classes(this.namespace,"cell-"+edges.safeId(s),this);a+='<td class="'+f+" "+v+'">'+edges.escapeHtml(u)+"</td>"}a+="</tr>"}a+="</tbody></table></div>"+j}if(this.component.context.html(a),this.download){var w=edges.css_id_selector(this.namespace,"download",this);edges.on(w,"click",this,"doDownload")}},this.doDownload=function(a){if(this.download){var b=this._downloadData(),c=new Blob([b.data],{type:b.fileType}),d=window.URL.createObjectURL(c),e=document.createElement("a");document.body.appendChild(e),e.style="display: none",e.href=d,e.download=b.fileName,e.click(),window.URL.revokeObjectURL(d)}},this._downloadData=function(){if(!this.download)return!1;var a=[],b=this.component.results;if(b&&b.length>0){for(var c=this._getHeaderRow(),d=[],e=0;e<c.length;e++){for(var f=!1,g=0;g<this.fieldDisplay.length;g++){var h=this._getFieldDisplay(c[e]);if(h){d.push(h.display),f=!0;break}}f||d.push(c[e])}a.push(d);for(var e=0;e<b.length;e++){for(var i=b[e],j=[],g=0;g<c.length;g++){var k=c[g],l=edges.objVal(k,i,"");j.push(l)}a.push(j)}}var m=edges.csv.serialise({data:a}),n="text/csv;charset=UTF-8",o="csv",p=(new Date).getTime(),q=this.downloadPrefix+"_"+p+"."+o;
return{data:m,fileType:n,fileName:q}},this._getFieldDisplay=function(a){for(var b=0;b<this.fieldDisplay.length;b++)if(this.fieldDisplay[b].field==a)return this.fieldDisplay[b];return!1},this._getHeaderRow=function(){if(this.headerOrderingFunction)return this.headerOrderingFunction(this);var a=this.component.results,b=a!==!1&&a.length>0;if(!b||0==this.fieldDisplay.length&&this.displayListedOnly)return[];var c=[];if(this.fieldDisplay.length>0)for(var d=0;d<this.fieldDisplay.length;d++)c.push(this.fieldDisplay[d].field);if(!this.displayListedOnly){for(var e={},d=0;d<a.length;d++)for(var f=Object.keys(a[d]),g=0;g<f.length;g++)f[g]in e||(e[f[g]]=!0);var h=Object.keys(e);h.sort();for(var d=0;d<h.length;d++)$.inArray(h[d],c)==-1&&c.push(h[d])}return c}}}}),$.extend(!0,edges,{bs3:{newBSMultiDateRange:function(a){return a||(a={}),edges.bs3.BSMultiDateRange.prototype=edges.newRenderer(a),new edges.bs3.BSMultiDateRange(a)},BSMultiDateRange:function(a){this.dateFormat=edges.getParam(a.dateFormat,"MMMM D, YYYY"),this.useSelect2=edges.getParam(a.useSelect2,!1),this.ranges=edges.getParam(a.ranges,!1),this.dre=!1,this.selectId=!1,this.rangeId=!1,this.selectJq=!1,this.rangeJq=!1,this.drp=!1,this.namespace="edges-bs3-bs-multi-date-range",this.draw=function(){var a=this.component,b=edges.css_classes(this.namespace,"select",this),c=edges.css_classes(this.namespace,"input",this),d=edges.css_classes(this.namespace,"prefix",this);this.selectId=edges.css_id(this.namespace,a.id+"_date-type",this),this.rangeId=edges.css_id(this.namespace,a.id+"_range",this);for(var e=edges.css_id(this.namespace,a.id+"_plugin",this),f="",g=0;g<a.fields.length;g++){var h=a.fields[g],i=a.currentField==h.field?' selected="selected" ':"";f+='<option value="'+h.field+'"'+i+">"+h.display+"</option>"}var j='<div class="form-inline">';a.display&&(j+='<span class="'+d+'">'+a.display+"</span>"),j+='<div class="form-group"><select class="'+b+' form-control" name="'+this.selectId+'" id="'+this.selectId+'">'+f+"</select></div>",j+='<div id="'+this.rangeId+'" class="'+c+' form-control">                    <i class="glyphicon glyphicon-calendar"></i>&nbsp;                    <span></span> <b class="caret"></b>                </div>',j+="</div>",a.context.html(j);var k=edges.css_id_selector(this.namespace,a.id+"_date-type",this),l=edges.css_id_selector(this.namespace,a.id+"_range",this);this.selectJq=a.jq(k),this.rangeJq=a.jq(l);var m=edges.objClosure(this,"updateDateRange",["start","end"]),n={locale:{format:"DD/MM/YYYY"},opens:"left"};this.ranges&&(n.ranges=this.ranges);var o=edges.css_id_selector(this.namespace,a.id+"_plugin",this);$(o).remove(),this.rangeJq.daterangepicker(n,m),this.drp=this.rangeJq.data("daterangepicker"),this.drp.container.attr("id",e).addClass("show-calendar"),this.prepDates(),this.useSelect2&&this.selectJq.select2(),edges.on(k,"change",this,"typeChanged")},this.dateRangeDisplay=function(a){var b=a.start,c=a.end;this.rangeJq.find("span").html(b.utc().format(this.dateFormat)+" - "+c.utc().format(this.dateFormat))},this.updateDateRange=function(a){var b=a.start,c=a.end,d=null;d=this.useSelect2?this.selectJq.select2("val"):this.selectJq.val(),this.component.changeField(d),this.component.setFrom(b.toDate()),this.component.setTo(c.toDate()),this.dateRangeDisplay(a);var e=this.component.triggerSearch();e||this.prepDates()},this.typeChanged=function(a){var b=null;b=this.useSelect2?this.selectJq.select2("val"):this.selectJq.val(),this.component.changeField(b),this.component.setFrom(!1),this.component.setTo(!1);var c=this.component.triggerSearch();c||this.prepDates()},this.prepDates=function(){var a=this.component.currentEarliest(),b=this.component.currentLatest(),c=this.component.fromDate,d=this.component.toDate;a?(this.drp.minDate=moment(a),this.drp.setStartDate(moment(a))):(this.drp.minDate=moment(this.component.defaultEarliest),this.drp.setStartDate(moment(this.component.defaultEarliest))),b?(this.drp.maxDate=moment(b),this.drp.setEndDate(moment(b))):(this.drp.maxDate=moment(this.component.defaultLatest),this.drp.setEndDate(moment(this.component.defaultLatest))),c&&(c<this.drp.minDate&&(this.drp.minDate=moment(c)),c>this.drp.maxDate&&(this.drp.maxDate=moment(c)),this.drp.setStartDate(moment(c))),d&&(d<this.drp.minDate&&(this.drp.minDate=moment(d)),d>this.drp.maxDate&&(this.drp.maxDate=moment(d)),this.drp.setEndDate(moment(d))),this.dateRangeDisplay({start:this.drp.startDate,end:this.drp.endDate})}}}}),$.extend(!0,edges,{bs3:{newSearchingNotificationRenderer:function(a){return a||(a={}),edges.bs3.SearchingNotificationRenderer.prototype=edges.newRenderer(a),new edges.bs3.SearchingNotificationRenderer(a)},SearchingNotificationRenderer:function(a){this.searchingMessage=a.searchingMessage||"Loading, please wait...",this.namespace="edges-bs3-searching-notification",this.draw=function(){var a="";if(this.component.searching){var b=edges.css_classes(this.namespace,"bar",this);a='<div class="progress-bar progress-bar-info progress-bar-striped active '+b+'">                             '+this.searchingMessage+"                         </div>"}this.component.context.html(a)}}}});