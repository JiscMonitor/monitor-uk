<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: muk.search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: muk.search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>$.extend(muk, {
    /** @namespace muk.search */
    search : {

        newSearchTemplate: function (params) {
            if (!params) { params = {} }
            muk.search.SearchTemplate.prototype = edges.newTemplate(params);
            return new muk.search.SearchTemplate(params);
        },
        SearchTemplate: function (params) {
            // later we'll store the edge instance here
            this.edge = false;

            this.namespace = "muk-search-template";

            this.draw = function (edge) {
                this.edge = edge;

                // the classes we're going to need
                var containerClass = edges.css_classes(this.namespace, "container");
                var searchClass = edges.css_classes(this.namespace, "search");
                var facetsClass = edges.css_classes(this.namespace, "facets");
                var countClass = edges.css_classes(this.namespace, "count");
                var sortClass = edges.css_classes(this.namespace, "sort");
                var resultsClass = edges.css_classes(this.namespace, "results");
                var itemsClass = edges.css_classes(this.namespace, "items");
                var pagerClass = edges.css_classes(this.namespace, "pager");
                var facetClass = edges.css_classes(this.namespace, "facet");
                var searchingClass = edges.css_classes(this.namespace, "searching");
                var panelClass = edges.css_classes(this.namespace, "panel");
                var refineClass = edges.css_classes(this.namespace, "refine");

                var frag = '&lt;div class="' + containerClass + '">\
                    &lt;div class="row">&lt;div class="col-md-12">&lt;div class="' + searchClass + '">{{SEARCH}}&lt;/div>&lt;/div>&lt;/div>\
                    &lt;div class="row">&lt;div class="col-md-12">&lt;div class="' + searchingClass + '">{{SEARCHING}}&lt;/div>&lt;/div>&lt;/div>\
                    &lt;div class="' + panelClass + '">&lt;div class="row">\
                        &lt;div class="col-md-3">&lt;div class="' + facetsClass + '">&lt;div class="' + refineClass + '">Refine&lt;/div>{{FACETS}}&lt;/div>&lt;/div>\
                        &lt;div class="col-md-9">\
                            &lt;div class="row">\
                                &lt;div class="col-md-6">&lt;div class="' + countClass + '">{{RESULTCOUNT}}&lt;/div>&lt;/div>\
                                &lt;div class="col-md-6">&lt;div class="' + sortClass + '">{{SORT}}&lt;/div>&lt;/div>\
                            &lt;/div>\
                            &lt;div class="row">\
                                &lt;div class="col-md-12">&lt;div class="' + resultsClass + '">{{RESULTS}}&lt;/div>&lt;/div>\
                            &lt;/div>\
                            &lt;div class="row">\
                                &lt;div class="col-md-12">&lt;div class="' + itemsClass + '">{{ITEMSPERPAGE}}&lt;/div>&lt;/div>\
                            &lt;/div>\
                            &lt;div class="row">\
                                &lt;div class="col-md-12">&lt;div class="' + pagerClass + '">{{PAGER}}&lt;/div>&lt;/div>\
                            &lt;/div>\
                        &lt;/div>\
                    &lt;/div>&lt;/div>\
                &lt;/div>';

                var searchFrag = "";
                var searches = edge.category("search");
                for (var i = 0; i &lt; searches.length; i++) {
                    searchFrag += '&lt;div id="' + searches[i].id + '">&lt;/div>';
                }

                var searchingFrag = "";
                var searchings = edge.category("searching-notification");
                for (var i = 0; i &lt; searchings.length; i++) {
                    searchingFrag += '&lt;div id="' + searchings[i].id + '">&lt;/div>';
                }

                var facets = edge.category("facet");
                var facetsFrag = "";
                for (var i = 0; i &lt; facets.length; i++) {
                    facetsFrag += '&lt;div class="' + facetClass + '">&lt;div id="' + facets[i].id + '">&lt;/div>&lt;/div>';
                }

                var countFrag = "";
                var counts = edge.category("count");
                for (var i = 0; i &lt; counts.length; i++) {
                    countFrag += '&lt;div id="' + counts[i].id + '">&lt;/div>';
                }

                var sortFrag = "";
                var sorts = edge.category("sort");
                for (var i = 0; i &lt; sorts.length; i++) {
                    sortFrag += '&lt;div id="' + sorts[i].id + '">&lt;/div>';
                }

                var resultsFrag = "";
                var results = edge.category("results");
                for (var i = 0; i &lt; results.length; i++) {
                    resultsFrag += '&lt;div id="' + results[i].id + '">&lt;/div>';
                }

                var itemsFrag = "";
                var items = edge.category("items");
                for (var i = 0; i &lt; items.length; i++) {
                    itemsFrag += '&lt;div id="' + items[i].id + '">&lt;/div>';
                }

                var pagerFrag = "";
                var pagers = edge.category("pager");
                for (var i = 0; i &lt; pagers.length; i++) {
                    pagerFrag += '&lt;div id="' + pagers[i].id + '">&lt;/div>';
                }

                frag = frag.replace(/{{SEARCH}}/g, searchFrag)
                            .replace(/{{SEARCHING}}/g, searchingFrag)
                            .replace(/{{FACETS}}/g, facetsFrag)
                            .replace(/{{RESULTCOUNT}}/g, countFrag)
                            .replace(/{{SORT}}/g, sortFrag)
                            .replace(/{{RESULTS}}/g, resultsFrag)
                            .replace(/{{ITEMSPERPAGE}}/g, itemsFrag)
                            .replace(/{{PAGER}}/g, pagerFrag);

                edge.context.html(frag);
            };
        },

        newAPCRenderer : function(params) {
            if (!params) { params = {} }
            muk.search.APCRenderer.prototype = edges.newRenderer(params);
            return new muk.search.APCRenderer(params);
        },
        APCRenderer : function(params) {
            //////////////////////////////////////////////
            // parameters that can be passed in

            // what to display when there are no results
            this.noResultsText = params.noResultsText || "No results to display";

            //////////////////////////////////////////////
            // variables for internal state

            this.namespace = "muk-search-apc";

            this.months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            this.draw = function() {
                var frag = this.noResultsText;
                if (this.component.results === false) {
                    frag = "";
                }

                var results = this.component.results;
                if (results &amp;&amp; results.length > 0) {
                    // list the css classes we'll require
                    var recordClasses = edges.css_classes(this.namespace, "record", this);

                    // now call the result renderer on each result to build the records
                    frag = "";
                    for (var i = 0; i &lt; results.length; i++) {
                        var rec = this._renderResult(results[i]);
                        frag += '&lt;div class="row">&lt;div class="col-md-12">&lt;div class="' + recordClasses + '">' + rec + '&lt;/div>&lt;/div>&lt;/div>';
                    }
                }

                // finally stick it all together into the container
                var containerClasses = edges.css_classes(this.namespace, "container", this);
                var container = '&lt;div class="' + containerClasses + '">' + frag + '&lt;/div>';
                this.component.context.html(container);

                // now bind the "more"/"less" buttons
                var moreSelector = edges.css_class_selector(this.namespace, "more-link", this);
                edges.on(moreSelector, "click", this, "showMore");

                var lessSelector = edges.css_class_selector(this.namespace, "less-link", this);
                edges.on(lessSelector, "click", this, "showLess");
            };

            this._renderResult = function(res) {
                var id = edges.objVal("id", res);

                var titleClass = edges.css_classes(this.namespace, "title", this);
                var costClass = edges.css_classes(this.namespace, "cost", this);
                var biblioClass = edges.css_classes(this.namespace, "biblio", this);
                var labelClass = edges.css_classes(this.namespace, "label", this);
                var valueClass = edges.css_classes(this.namespace, "value", this);
                var moreLinkClass = edges.css_classes(this.namespace, "more-link", this);
                var moreLinkBoxClass = edges.css_classes(this.namespace, "more-link-box", this);
                var lessLinkClass = edges.css_classes(this.namespace, "less-link", this);
                var lessLinkBoxClass = edges.css_classes(this.namespace, "less-link-box", this);
                var moreBoxClass = edges.css_classes(this.namespace, "more-box", this);
                var vatClass = edges.css_classes(this.namespace, "vat", this);
                var inlineLabelClass = edges.css_classes(this.namespace, "inline-label", this);
                var rightClass = edges.css_classes(this.namespace, "right", this);
                var biblioRowClass = edges.css_classes(this.namespace, "bib-row", this);
                var innerMoreClass = edges.css_classes(this.namespace, "inner-more", this);
                var innerMoreLinkClass = edges.css_classes(this.namespace, "inner-more-link", this);
                var innerLessLinkClass = edges.css_classes(this.namespace, "inner-less-link", this);

                var moreBoxId = edges.css_id(this.namespace, "more-" + id, this);
                var moreLinkBoxId = edges.css_id(this.namespace, "more-link-" + id, this);
                var lessLinkBoxId = edges.css_id(this.namespace, "less-link-" + id, this);

                // get the values out of the object
                var title = edges.objVal("record.dc:title", res, "Untitled");
                var cost = edges.objVal("index.amount_inc_vat", res, false);
                var publisher = edges.objVal("record.dcterms:publisher.name", res, "Unknown");
                var journal = edges.objVal("record.dc:source.name", res, "Unknown");
                var apcs = edges.objVal("record.jm:apc", res, []);
                var journal_ids = edges.objVal("record.dc:source.identifier", res, []);
                var projects = edges.objVal("record.rioxxterms:project", res, []);
                var license_ref = edges.objVal("record.ali:license_ref", res, []);

                // make any display changes required to the values
                if (cost !== false) {
                    cost = muk.toGBPIntFormat()(cost);
                } else {
                    cost = "£-"
                }

                var orgList = [];
                var fundList = [];
                for (var i = 0; i &lt; apcs.length; i++) {
                    var org = edges.objVal("organisation_name", apcs[i], false);
                    if (org !== false &amp;&amp; $.inArray(org, orgList) === -1) {
                        orgList.push(org);
                    }
                    var funds = edges.objVal("fund", apcs[i], []);
                    for (var j = 0; j &lt; funds.length; j++) {
                        var fname = funds[j].name;
                        if (fname &amp;&amp; $.inArray(fname, fundList) === -1) {
                            fundList.push(fname);
                        }
                    }
                }
                var orgs = orgList.join(", ");
                var funds = fundList.join(", ");

                var issnList = [];
                for (var i = 0; i &lt; journal_ids.length; i++) {
                    var jid = journal_ids[i];
                    if (jid.type === "issn") {
                        issnList.push(jid.id);
                    }
                }
                var issnFrag = "";
                var journalWidth = "10";
                if (issnList.length > 0) {
                    issnFrag = '&lt;div class="col-md-8">(&lt;span class="' + inlineLabelClass + '">ISSN:&lt;/span>&amp;nbsp;&lt;span class="' + valueClass + '">' + edges.escapeHtml(issnList.join(", ")) + '&lt;/span>)&lt;/div>';
                    journalWidth = "2";
                }

                var funderList = [];
                for (var i = 0; i &lt; projects.length; i++) {
                    var fname = projects[i].funder_name;
                    if (fname &amp;&amp; $.inArray(fname, funderList) === -1) {
                        funderList.push(fname);
                    }
                }
                var funders = funderList.join(", ");

                var licenceList = [];
                for (var i = 0; i &lt; license_ref.length; i++) {
                    var lname = license_ref[i].type;
                    if (lname &amp;&amp; $.inArray(lname, licenceList) === -1) {
                        licenceList.push(lname);
                    }
                }
                var licences = licenceList.join(", ");

                // the body of the bibliographic records
                var biblio = '&lt;div class="' + biblioRowClass + '">&lt;div class="row">\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Publisher&lt;/span>&lt;/div>\
                    &lt;div class="col-md-10">&lt;span class="' + valueClass + '">' + edges.escapeHtml(publisher) + '&lt;/span>&lt;/div>\
                &lt;/div>&lt;/div>\
                &lt;div class="' + biblioRowClass + '">&lt;div class="row">\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Journal&lt;/span>&lt;/div>\
                    &lt;div class="col-md-' + journalWidth + '">&lt;span class="' + valueClass + '">' + edges.escapeHtml(journal) + '&lt;/span>&lt;/div>\
                    ' + issnFrag + '\
                &lt;/div>&lt;/div>\
                &lt;div class="' + biblioRowClass + '">&lt;div class="row">\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Organisation&lt;/span>&lt;/div>\
                    &lt;div class="col-md-10">&lt;span class="' + valueClass + '">' + edges.escapeHtml(orgs) + '&lt;/span>&lt;/div>\
                &lt;/div>&lt;/div>\
                &lt;div class="' + biblioRowClass + '">&lt;div class="row">\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Funder&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;span class="' + valueClass + '">' + edges.escapeHtml(funders) + '&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Paid from fund&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;span class="' + valueClass + '">' + edges.escapeHtml(funds) + '&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;span class="' + labelClass + '">Licence&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;span class="' + valueClass + '">' + edges.escapeHtml(licences) + '&lt;/span>&lt;/div>\
                &lt;/div>&lt;/div>';

                // details about the individual apcs
                var apc = "";
                for (var i = 0; i &lt; apcs.length; i++) {
                    var apc_record = apcs[i];
                    var inst = edges.objVal("organisation_name", apc_record, "Unknown Organisation");
                    var total = edges.objVal("amount_inc_vat_gbp", apc_record, false);
                    var date = edges.objVal("date_paid", apc_record);
                    var funds = edges.objVal("fund", apc_record, []);

                    if (total !== false) {
                        total = muk.toGBPIntFormat()(total);
                    } else {
                        total = "Unknown Amount";
                    }

                    var fund_names = [];
                    for (var j = 0; j &lt; funds.length; j++) {
                        var fund = funds[j];
                        var fund_name = edges.objVal("name", fund, "Unknown Fund");
                        fund_names.push(fund_name);
                    }

                    if (date) {
                        var dobj = new Date(date);
                        var day = dobj.getUTCDate();
                        var month = this.months[dobj.getUTCMonth()];
                        var year = dobj.getUTCFullYear();
                        date = day + " " + month + " " + year;
                    }

                    apc += '&lt;div class="row">\
                        &lt;div class="col-md-12">\
                            &lt;span class="' + valueClass + '">' + edges.escapeHtml(inst) + '&lt;/span> \
                            paid \
                            &lt;span class="' + valueClass + '">' + edges.escapeHtml(total) + '&lt;/span> \
                            on \
                            &lt;span class="' + valueClass + '">' + edges.escapeHtml(date) + '&lt;/span> \
                            from fund(s): \
                            &lt;span class="' + valueClass + '">' + edges.escapeHtml(fund_names.join(", ")) + '&lt;/span> \
                        &lt;/div>\
                    &lt;/div>';
                }


                // the main layout template, and all the extra bells and whistles
                var frag = '&lt;div class="row"> \
                    &lt;div class="col-md-10">&lt;span class="' + titleClass + '">' + edges.escapeHtml(title) + '&lt;/span>&lt;/div>\
                    &lt;div class="col-md-2">&lt;div class="' + rightClass + '">&lt;span class="' + costClass + '">' + edges.escapeHtml(cost) + '&lt;/span>&lt;br>\
                        &lt;span class="' + vatClass + '">(inc VAT)&lt;/span>\
                    &lt;/div>&lt;/div>\
                &lt;/div>\
                &lt;div class="' + biblioClass + '">&lt;div class="row"> \
                    &lt;div class="col-md-12">{{BIBLIO}}&lt;/div>\
                &lt;/div>&lt;/div>\
                &lt;div class="' + moreBoxClass + '" id="' + moreBoxId + '">&lt;div class="row"> \
                    &lt;div class="col-md-12">&lt;div class="' + innerMoreClass + '">{{APCS}}&lt;/div>&lt;/div>\
                &lt;/div>&lt;/div>\
                &lt;div id="' + moreLinkBoxId + '" class="' + moreLinkBoxClass + '">&lt;div class="row"> \
                    &lt;div class="col-md-12">&lt;div class="' + innerMoreLinkClass + '">&lt;a href="#" class="' + moreLinkClass + '" data-id="' + id + '">More&lt;/a>&lt;/div>&lt;/div>\
                &lt;/div>&lt;/div>\
                &lt;div id="' + lessLinkBoxId + '" class="' + lessLinkBoxClass + '">&lt;div class="row"> \
                    &lt;div class="col-md-12">&lt;div class="' + innerLessLinkClass + '">&lt;a href="#" class="' + lessLinkClass + '" data-id="' + id + '">Less&lt;/a>&lt;/div>&lt;/div>\
                &lt;/div>&lt;/div>';

                frag = frag.replace(/{{BIBLIO}}/g, biblio)
                    .replace(/{{APCS}}/g, apc);

                return frag;
            };

            this.showMore = function(element) {
                var e = this.component.jq(element);
                var id = e.attr("data-id");

                var moreBoxSelector = edges.css_id_selector(this.namespace, "more-" + id, this);
                var lessLinkBoxSelector = edges.css_id_selector(this.namespace, "less-link-" + id, this);
                var moreLinkBoxSelector = edges.css_id_selector(this.namespace, "more-link-" + id, this);

                this.component.jq(moreLinkBoxSelector).hide();
                this.component.jq(moreBoxSelector).slideDown(200);
                this.component.jq(lessLinkBoxSelector).show();
            };

            this.showLess = function(element) {
                var e = this.component.jq(element);
                var id = e.attr("data-id");

                var moreBoxSelector = edges.css_id_selector(this.namespace, "more-" + id, this);
                var moreLinkBoxSelector = edges.css_id_selector(this.namespace, "more-link-" + id, this);
                var lessLinkBoxSelector = edges.css_id_selector(this.namespace, "less-link-" + id, this);

                this.component.jq(lessLinkBoxSelector).hide();
                this.component.jq(moreBoxSelector).slideUp(200);
                this.component.jq(moreLinkBoxSelector).show();
            }
        },

        formatDateRange : function(params) {
            var field = params.field;
            var from = params.from;
            var to = params.to;

            var fd = new Date(from);
            var td = new Date(to);

            var months = [
                "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"
            ];

            var fs = months[fd.getUTCMonth()] + " " + fd.getUTCDate() + ", " + fd.getUTCFullYear();
            var ts = months[td.getUTCMonth()] + " " + td.getUTCDate() + ", " + td.getUTCFullYear();

            return {to: to, from: from, display: "From " + fs + " to " + ts };
        },

        makeSearch : function(params) {
            if (!params) { params = {} }
            var selector = edges.getParam(params.selector, "#muk_search");

            var opening_query = es.newQuery();
            opening_query.addSortBy(es.newSort({
                field: "created_date",
                dir : "desc"
            }));

            var e = edges.newEdge({
                selector: selector,
                template: muk.search.newSearchTemplate(),
                search_url: octopus.config.public_query_endpoint, // "http://localhost:9200/muk/public/_search",
                manageUrl : true,
                openingQuery: opening_query,
                components : [
                    edges.newFullSearchController({
                        id: "search-box",
                        category: "search",
                        renderer : edges.bs3.newSearchBoxRenderer({
                            clearButton: false,
                            searchButton: true,
                            searchButtonText: "Search",
                            searchPlaceholder: "Enter a title, journal, publisher, funder, organisation...",
                            freetextSubmitDelay: -1
                        })
                    }),
                    edges.newSelectedFilters({
                        id: "selected-filters",
                        category: "facet",
                        fieldDisplays : {
                            "record.dcterms:publisher.name.exact" : "Publisher",
                            "record.dc:source.name.exact" : "Journal",
                            "index.amount_inc_vat" : "APC Cost",
                            "record.jm:apc.organisation_name.exact" : "Institution",
                            "index.apc_count" : "Multiple APCs",
                            "index.org_count" : "Multiple Organisations",
                            "index.account_count" : "Multiple Contributors",
                            "record.dc:source.oa_type.exact" : "Journal Type",
                            "record.rioxxterms:publication_date" : "Publication Date",
                            "record.jm:apc.date_applied" : "APC Application",
                            "record.jm:apc.date_paid" : "Date Paid"
                        },
                        valueMaps : {
                            "record.dc:source.oa_type.exact" : {
                                "oa" : "Pure OA",
                                "hybrid" : "Hybrid",
                                "unknown" : "Unknown"
                            }
                        },
                        rangeMaps : {
                            "index.apc_count" : [{from : 2, display: "Yes"}],
                            "index.org_count" : [{from : 2, display: "Yes"}],
                            "index.account_count" : [{from : 2, display: "Yes"}]
                        },
                        rangeFunctions : {
                            "record.rioxxterms:publication_date" : muk.search.formatDateRange,
                            "record.jm:apc.date_applied" : muk.search.formatDateRange,
                            "record.jm:apc.date_paid" : muk.search.formatDateRange
                        },
                        renderer : edges.bs3.newCompactSelectedFiltersRenderer({
                            header: "Refined by",
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newORTermSelector({
                        id: "journal",
                        field: "record.dc:source.name.exact",
                        display: "Journal",
                        size: 10000,
                        category: "facet",
                        lifecycle: "update",
                        renderer : edges.bs3.newORTermSelectorRenderer({
                            showCount: true,
                            hideEmpty: true,
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newORTermSelector({
                        id: "organisation",
                        field: "record.jm:apc.organisation_name.exact",
                        display: "Institution",
                        size: 500,
                        category: "facet",
                        lifecycle: "update",
                        renderer : edges.bs3.newORTermSelectorRenderer({
                            showCount: true,
                            hideEmpty: true,
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newNumericRangeEntry({
                        id: "apc_cost",
                        field: "index.amount_inc_vat",
                        display: "APC Cost",
                        category: "facet",
                        increment: 500,
                        renderer : edges.bs3.newNumericRangeEntryRenderer({
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newORTermSelector({
                        id: "oa_type",
                        field: "record.dc:source.oa_type.exact",
                        display: "Journal Type",
                        category: "facet",
                        lifecycle: "update",
                        valueMap : {
                            "oa" : "Pure OA",
                            "hybrid" : "Hybrid",
                            "unknown" : "Unknown"
                        },
                        renderer : edges.bs3.newORTermSelectorRenderer({
                            showCount: true,
                            hideEmpty: false,
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newMultiDateRangeEntry({
                        id : "date_range",
                        category : "facet",
                        display: "Date",
                        fields : [
                            {field : "record.rioxxterms:publication_date", display: "Publication Date"},
                            {field : "record.jm:apc.date_applied", display: "APC Application"},
                            {field : "record.jm:apc.date_paid", display: "APC Paid"}
                        ],
                        autoLookupRange: true,
                        renderer : edges.bs3.newBSMultiDateRangeFacet({
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            prefix: "Show records where",
                            ranges : muk.yearRanges({
                                    "academic year" : "09-01",
                                    "fiscal year" : "04-01",
                                    "calendar year" : "01-01"
                                },
                                {"This " : 0, "Last " : 1}
                            ),
                            open: true
                        })
                    }),
                    edges.newFilterSetter({
                        id : "deduplicate",
                        category: "facet",
                        aggregations : [
                            es.newRangeAggregation({
                                name: "apc_count",
                                field: "index.apc_count",
                                ranges: [{from : 2}]
                            }),
                            es.newRangeAggregation({
                                name: "org_count",
                                field: "index.org_count",
                                ranges: [{from : 2}]
                            }),
                            es.newRangeAggregation({
                                name: "account_count",
                                field: "index.account_count",
                                ranges: [{from : 2}]
                            })
                        ],
                        filters : [
                            {
                                id: "multiple_apcs",
                                display: "More than one APC has been paid (by anyone)",
                                must : [
                                    es.newRangeFilter({
                                        field: "index.apc_count",
                                        gte: 2
                                    })
                                ],
                                agg_name: "apc_count",
                                bucket_field: "from",
                                bucket_value: 2
                            },
                            {
                                id : "multiple_orgs",
                                display: "More than one organisation has paid an APC",
                                must : [
                                    es.newRangeFilter({
                                        field: "index.org_count",
                                        gte: 2
                                    })
                                ],
                                agg_name: "org_count",
                                bucket_field: "from",
                                bucket_value: 2
                            },
                            {
                                id : "multiple_accs",
                                display: "More than one user account has reported an APC payment",
                                must : [
                                    es.newRangeFilter({
                                        field: "index.account_count",
                                        gte: 2
                                    })
                                ],
                                agg_name: "account_count",
                                bucket_field: "from",
                                bucket_value: 2
                            }
                        ],
                        renderer : edges.bs3.newFacetFilterSetterRenderer({
                            facetTitle : "Search for duplicates",
                            intro: "Show records where:",
                            openIcon: "glyphicon glyphicon-chevron-down",
                            closeIcon: "glyphicon glyphicon-chevron-up",
                            layout: "right",
                            open: true
                        })
                    }),
                    edges.newPager({
                        id: "result-count",
                        category: "count",
                        renderer : edges.bs3.newResultCountRenderer({
                            prefix: "Results (",
                            suffix: ")"
                        })
                    }),
                    edges.newFullSearchController({
                        id: "sort-box",
                        category: "sort",
                        sortOptions : [
                            {field : "record.dc:title.exact", dir: "asc", display: "Title (A-Z)"},
                            {field : "record.dc:title.exact", dir: "desc", display: "Title (Z-A)"},
                            {field : "index.amount_inc_vat", dir: "asc", display: "APC Cost (Low - High)"},
                            {field : "index.amount_inc_vat", dir: "desc", display: "APC Cost (High - Low)"},
                            {field : "created_date", dir: "desc", display : "Most recent"}
                        ],
                        renderer : edges.bs3.newSortRenderer({
                            prefix: "Sort: ",
                            dirSwitcher: false
                        })
                    }),
                    edges.newPager({
                        id: "results-size",
                        category: "pager",
                        renderer : edges.bs3.newPagerRenderer({
                            showRecordCount: false,
                            showPageNavigation: false,
                            sizePrefix: "Show ",
                            sizeSuffix: "&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;items per page"
                        })
                    }),
                    edges.newPager({
                        id: "page-navigation",
                        category: "pager",
                        renderer : edges.bs3.newNumberedPager({

                        })
                    }),
                    edges.newSearchingNotification({
                        id: "searching-notification",
                        category: "searching-notification"
                    }),
                    edges.newResultsDisplay({
                        id: "results",
                        category: "results",
                        renderer : muk.search.newAPCRenderer({})
                    })
                ]
            });

            muk.activeEdges[selector] = e;
        }
    }
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="muk.funder.FunderReportTemplate.html">FunderReportTemplate</a></li><li><a href="muk.funder.Story.html">Story</a></li><li><a href="muk.institution.InstitutionReportTemplate.html">InstitutionReportTemplate</a></li><li><a href="muk.institution.Story.html">Story</a></li><li><a href="muk.publisher.PublisherReportTemplate.html">PublisherReportTemplate</a></li><li><a href="muk.publisher.Story.html">Story</a></li></ul><h3>Namespaces</h3><ul><li><a href="muk.html">muk</a></li><li><a href="muk.funder.html">funder</a></li><li><a href="muk.institution.html">institution</a></li><li><a href="muk.publisher.html">publisher</a></li><li><a href="muk.search.html">search</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Sep 01 2016 18:28:42 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
